<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{$resourceDetails[0].resource_name}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script src="__PUBLIC__/js/rem.js"></script>
	<script src="http://apps.bdimg.com/libs/jquery/1.10.1/jquery.js" type="text/javascript"></script>
	<script src='__PUBLIC__/js/external/polyvplayer.min.js'></script>
	<script src="https://lkme.cc/js/linkedme.min.js" ></script>

	<link href="__PUBLIC__/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.config.js?v=1"></script>
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/umeditor/lang/zh-cn/zh-cn.js"></script>

</head>
<style>
	*{
		margin: 0;
		padding: 0;
	}
	html,body{
		width: 100%;

	}
	.recommend .res_a{
		color: #30b753;
		display: block;
		font-size: 16px;
		line-height: 26px;

	}
	.p20{
		padding: 10px 20px;
	}
	.icon{
		width: 18px;
		margin-right: 5px;
	}
	.book{
		width: 105px;
		height: 105px;
	}
	.left{
		float: left;
	}
	ul,li{
		list-style: none
	}
	p{
		font-size: 16px;
		line-height: 20px;
		color: #666
	}
	.left p{
		text-indent: 15px;
		line-height: 34px;
		display: block;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		color: #333;
		width: 180px;
	}
	.of{
		overflow: hidden;

	}
	.right {
		float: right;
	}
	.pl10{
		padding-left: 10px;
	}
	.res_list{
		padding:10px 0;
		border-top:1px solid #ccc
	}
	.relevant,.name,.introduction{
		padding: 5px 10px;
		line-height: 26px;
	}
	.brccc{
		border: 1px solid #ccc;
		padding: 5px 10px
	}
	.next{
		width: 13px;
		height: 20px;
		margin-right: 10px;
		margin-top: 3px;
	}
	.cang,.xiang{
		width: 20px;
		height: 20px;

	}
	.mr10{
		margin-right: 10px;
	}
	.f14{
		font-size: 14px;
	}
	.text-center{
		text-align: center;
	}
	.iconbtn{

		border-bottom: 10px solid #ededed;
	}
	.pre{
		width: 20px;
		margin-right: 10px;
		margin-top: 4px;
	}
	.introduction_div{
		display: none;
	}
	.introduction{
		border-bottom: 1px solid #ccc;

	}
	.w50{
		width: 50%;
		display: inline-block;
		float: left;
	}
	.introduction_div p{
		line-height: 26px;
		color: #333;
		word-break: break-all;
	}
	.favor{
		position: relative;
		top:3px
	}
	#resourceMask{
		position: fixed;
		top:0;
		left: 0;
		width:100%;
		height:40%;
		z-index:2;
		opacity: 1
	}
	#content,#buylink{
		position: fixed;
		top:0;
		left: 0;
		width:100%;
		height:40%;
		z-index:1;
	}

	#content {
		background: #fff;
	}

	#content img{
		width: auto;
		height: 100%;
		max-width: 100%;
		max-height: 100%;
		display: block;
		margin: 0 auto;
	}

	.footer{
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		line-height: 49px;
		background: #fff;
		font-size: 14px;
		border-top: 1px solid #ededed;
	}
	.footer img{
		vertical-align: middle;
		margin-right: 8px;
		position: relative;
		top: -1px
	}
	.green{
		background: #22c67e;
		color: #fff
	}
	.content{
		margin-bottom: 60px
	}
	.w20{
		width: 20px
	}
	.cache_icon{
		width: 1.3rem;
		margin-left: 2rem

	}
	.lh24{
		line-height: 24px
	}
	.smallfz{
		font-size: 1rem;
		color: gray
	}
	.fullscreen {
		display: none;
		width: 100%;
		height: 100%;
		background: rgba(0,0,0,0.3);
		position: fixed;
		top: 0;
		left: 0;
		z-index: 3;
	}

	.notifyBox {
		display: none;
		width: 280px;
		height: 200px;
		background: #fff;
		border-radius: 10px;
		position: fixed;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		margin: auto;
		z-index: 4;
	}

	.notifyTitle {
		text-align: center;
		font-size: 2rem;
		line-height: 70px
	}

	.btnBox {
		text-align: center;
	}

	.notifyBtn {
		display: inline-block;
		background-color: #28D0C1;
		border: 1px solid transparent;
		border-radius: 6px;
		color: white;
		font-size: 16px;
		padding: 6px 22px;
	}

	.notifyMain {

		text-align: center;
		font-size: 16px;
margin-top: 20px;
margin-bottom: 30px;
	}
	#enteredjby,
	#enteredjbytwo {

		text-align: center;
		margin-top : 5rem
	}

	#enteredjby a,
	#enteredjbytwo a {
		background: #46cfdd;
		color: #fff;
		margin: 3rem auto;
		padding: 1rem 2rem;
		border-radius: 10px;
		text-decoration: none
	}
	.border_left60,.border_left80{
		width: 60px;
		border-left: 1px solid #eee;
		margin-bottom: 10px
	}
	.border_left80{
		width: 80px
	}

	@media(min-width:600px) {
		.left.leftInfo {
			width: 80%;/*写给不支持calc()的浏览器*/ 
			width: -moz-calc(100% - 150px); 
			width: -webkit-calc(100% - 150px); 
			width: calc(100% - 150px);
		}

		.left.leftInfo p {
			width: 100%;
		}
	}

	.color999 {
		color: #999 !important
	}
</style>
<body>
<?php if($isShare == 1) :?>
<div id="resourceMask">

</div>
<?php endif ; ?>
<div id="content">
	<switch name="resourceDetails[0].file_type">
		<case value="video">
			<div id="polyMedia" style="display:block;height:100%" ></div>
		</case>
		<case value="audio">
			<div id="polyMedia" style="display:block;height:100%"></div>
		</case>
		<case value="image">
			<img src="{$oss_path}{$contactInfo[0]['resource_path']}" width="100%" id="videoAudioImageId" style="background:#fff" controls></img>
		</case>
		<case value="condensed">
			手机暂不支持压缩包的查看,请登录PC版京版云查看该资源
		</case>
		<case value="swf">
			手机暂不支持FLASH的查看,请登录PC版京版云查看该资源
		</case>
		<case value="pdf|word|ppt">
			<div id="pdfViewer" style="height:100%">

			</div>
		</case>
	</switch>
</div>
<div id="buylink" style="display:none">
	<a href="javascript:">
		<img alt="" src="__PUBLIC__/img/sinology/payphone.png" style="width: 640px; height: 340px;" />
	</a>
</div>
<if condition="(($resourceDetails[0]['file_type'] neq 'ppt') AND ($resourceDetails[0]['file_type'] neq 'word') AND ($resourceDetails[0]['file_type'] neq 'pdf') OR $isShare eq 1) ">
	<div class="of iconbtn">
       <?php if($isShare == 0) : ?>
		<div class="right text-center border_left80">
			<?php if($resourceDetails[0]['iscollect'] == 'no') : ?>
			<img src="__PUBLIC__/img/resource/icon_shoucang_before.png" alt="" class="cang">
			<p  class="f14 favorText cang" style="width:auto;height:auto">值得收藏</p>
			<?php else : ?>
			<img src="__PUBLIC__/img/resource/icon_shoucang.png" alt="" class="cang">
			<p  class="f14 favorText cang" style="width:auto;height:auto">您已收藏</p>
			<?php endif ; ?>

		</div>

		<div class="right text-center border_left60 ">

			<img src="__PUBLIC__/img/resource/icon_fenxiang_before.png" alt="" class="xiang"  onclick="share()">
			<p class="f14 shareButton" onclick="share()">分享</p>
		</div>

		<?php if($resourceDetails[0]['is_allowed_app_download'] == 1) : ?>
		<div class="right text-center  border_left60">
			<img src="__PUBLIC__/img/sinology/icon_xiazai.png" alt="" class="xiang"  onclick="downloadClick()">
			<p class="f14 downButton" onclick="downloadClick()">下载</p>
		</div>
		<?php endif ; ?>
		<?php endif ; ?>
	</div>
</if>
<div class="content">
	<div class="recommend_div">
		<p class="name">
			{$resourceDetails[0].resource_name}
			<if condition="($resourceDetails[0].file_type neq 'ppt') AND ($resourceDetails[0].file_type neq 'word') AND ($resourceDetails[0].file_type neq 'pdf') ">
			<img src="__PUBLIC__/img/resource/icon_chakan.png" alt="" class="next right">
			<else/>
			<img src="__PUBLIC__/img/resource/icon_guanbi.png" alt="" class="pre right">
			</if>
		</p>
		<div class="recommend">
			<div class="brccc">
				<volist name="contactInfo" id="contactInfo">
					<a href="javascript:void(0);" trail="{$contactInfo.trial_status}" charge={$contactInfo.charge_status} size="{$contactInfo.vid_fullsize}" vid="{$contactInfo.vid}" class="res_a"  attr_path="<?php
					  if($contactInfo['flag'] == 2 && ($resourceDetails[0]['file_type'] == 'ppt' || $resourceDetails[0]['file_type'] == 'word') )
                       {
                       $path = explode('.',basename($contactInfo['resource_path']));
                       $path=$path[0].'.pdf';
                       $path = 'bjresource/' .$resourceDetails[0]['id'].'/'.$contactInfo['id'] .'/' .$path;
                       echo $oss_path.$path;
                       }
                      else if($resourceDetails[0]['file_type'] == 'pdf' || $resourceDetails[0]['file_type'] == 'image')
                      {
                       echo $oss_path.$contactInfo['resource_path'];
                      }
					?>">{$key+1}.{$contactInfo.file_name}</a>
				</volist>
			</div>
			<?php if($isShare == 0) : ?>
			<p class="relevant">相关推荐</p>
			<div >
				<ul>
					<volist name="recommendInfo" id="recommendInfo">
						<li class="res_list">
							<a href="__URL__/resourceDetails?id={$recommendInfo.id}&userId={$userId}&role={$role}" attr_id="{$recommendInfo.id}">
								<div class="of pl10">
									<div class="left">
										<switch name="recommendInfo.file_type">
											<case value="swf"><img src="__PUBLIC__/img/resource/s_swf.png" alt="" class="icon left"></case>
											<case value="video"><img src="__PUBLIC__/img/resource/shipin.png" alt="" class="icon left"></case>
											<case value="image"><img src="__PUBLIC__/img/resource/tupian.png" alt="" class="icon left"></case>
											<case value="word"><img src="__PUBLIC__/img/resource/word.png" alt="" class="icon left"></case>
											<case value="condensed"><img src="__PUBLIC__/img/resource/yasuo.png" alt="" class="icon left"></case>
											<case value="audio"><img src="__PUBLIC__/img/resource/yinyue.png" alt="" class="icon left"></case>
											<case value="pdf"><img src="__PUBLIC__/img/resource/pdf.png" alt="" class="icon left"></case>
											<case value="ppt"><img src="__PUBLIC__/img/resource/ppt.png" alt="" class="icon left"></case>
											<case value="html"><img src="__PUBLIC__/img/app/icon_html.png" alt="" class="icon left"></case>
										</switch>
										<img src="<?php if(false === strpos($recommendInfo['mobile_cover'],'http://')) echo $oss_path; ?>{$recommendInfo.mobile_cover}" alt="" class="book">
									</div>
									<div class="left leftInfo">
										<p>{$recommendInfo.name}</p>
										<p>来源:{$recommendInfo.chinesesource}  <?php if(strpos($recommend_item['course'],'传统文化') === false) : ?>创作者:{$recommendInfo.author}<?php endif; ?></p>
										<p>学科:{$recommendInfo.course} <?php if(strpos($recommend_item['course'],'传统文化') === false) : ?>{$recommendInfo.grade}{$recommendInfo.term}<?php endif; ?></p>
									</div>
								</div>
							</a>
						</li>
					</volist>
				</ul>
			</div>
			<?php else : ?>
			<div id="enteredjby">
				<a href="javascript:" class="openadd linkedme">打开京版云</a>
				<input type="hidden" value="{$urldata}" class="url">
			</div>
			<?php endif ; ?>
		</div>
	</div>
	<div class="introduction_div">
		<p class="introduction"><b>简介</b>
			<img src="__PUBLIC__/img/resource/icon_guanbi.png" alt="" class="pre right">
		</p>
		<div class="p20">
			<p><span class="color999">名称：</span><b>{$resourceDetails[0].resource_name}</b>
				<?php if((($resourceDetails[0]['file_type'] == 'ppt' || $resourceDetails[0]['file_type'] == 'word' || $resourceDetails[0]['file_type'] == 'pdf') && 0 == $isShare) ) : ?>
				<?php if($resourceDetails[0]['iscollect'] == 'no') : ?>
				<img src="__PUBLIC__/img/resource/icon_shoucang_before.png" alt="" class="cang right">
			    <?php else : ?>
			    <img src="__PUBLIC__/img/resource/icon_shoucang.png" alt="" class="cang right">
			    <?php endif ; ?>
                <?php endif ; ?>
			</p>
			<p class="w50"><span class="color999">学科：</span>{$resourceDetails[0].course_name} </p>
			<?php if(strpos($resourceDetails[0]['course_name'],'传统文化') === false) : ?>
			<p class="w50"><span class="color999">作者：</span>{$resourceDetails[0].author}</p>
			<p><span class="color999">所属年级分册章节信息：</span>{$resourceDetails[0].grade}-{$resourceDetails[0].term}-<?php echo stripslashes($resourceDetails[0]['chapter']); if(!empty($resourceDetails[0]['festival'])) echo '-'.$resourceDetails[0]['festival'];  ?></p>
			<?php endif; ?>
			<!-- <p class="w50"> 年级：{$resourceDetails[0].grade}</p><p class="w50">教材分册：{$resourceDetails[0].term}</p>
			<p>所属章节：{$resourceDetails[0].chapter} {$resourceDetails[0].festival}</p> -->
			<p><span class="color999">资源概述：</span>{$resourceDetails[0].description}</p>
			<?php if(strpos($resourceDetails[0]['course_name'],'传统文化') === false) : ?>
			<p><span class="color999">知识点：</span></p>
			<?php
				$num = count($resourceDetails);
				for($i = 0;$i< $num; $i++) {
					if(!empty($resourceDetails[$i]['childknowledge'])){ ?>
			<p><?php echo $i+1 . '.' . stripslashes($resourceDetails[$i]['childknowledge']); ?></p>
			<?php }elseif(!empty($resourceDetails[$i]['firstknowledge'])){ ?>
			<p><?php echo $i+1 . '.' . stripslashes($resourceDetails[$i]['firstknowledge']); ?></p>
			<?php }elseif(!empty($resourceDetails[$i]['festival'])){ ?>
			<p><?php echo $i+1 . '.' . stripslashes($resourceDetails[$i]['festival']); ?></p>
			<?php }else{ ?>
			<p><?php echo $i+1 . '.' . stripslashes($resourceDetails[$i]['chapter']); ?></p>
			<?php }
				} ?>
			<?php endif; ?>
		</div>
	</div>
</div>
<if condition="($orderStatus['is_allowed_browse'] neq 1) AND ($resourceDetails[0]['charge_status'] eq 2) AND ($isShare eq 0)">
<div class="footer text-center">
		<div class="w50 lh24">
			<img src="__PUBLIC__/img/sinology/rmb.png" alt="" / class="w20"><span>{$resourceDetails[0]['real_price']}元/套</span><br><span class="smallfz">(原价：{$resourceDetails[0]['resource_price']}/套)</span>
		</div>
	    <?php if($orderStatus['is_allowed_browse'] == 0) :?>
		<div class="w50 green" onclick="buy()">
			马上购买
		</div>
	    <?php else : ?>
	    <div class="w50 green" orderId="{$orderStatus['noPaymentOrder_sn']}" onclick="pay(this)">
	    	去支付
	    </div>
	    <?php endif; ?>

</div>
</if>

<div class="fullscreen"></div>
<div class="notifyBox">
	<p class="notifyTitle">提示</p>
	<div class="notifyMain">请进入或下载京版云APP后观看资源 !</div>
	<div class="btnBox">
		<span class="notifyBtn">好的</span>
	</div>
</div>
</body>

<script>
	function imgSize(){
		// if($('#content').children('img').length == "1") {
		// 	$('#content').css('height','inherit')
		// }
		$('.iconbtn').css('margin-top',$('#content').height()+10)
	}

	imgSize();
</script>

<script>
	var isAppFirstVisit = true;
	var fileType = '{$resourceDetails[0].file_type}';
	function changeRightSign(vids)
	{
		if(fileType != 'video' && fileType != 'audio')
			return;
		if(isAppFirstVisit) {
			isAppFirstVisit = false;
		}
		else
			return;
		var rightTemplate = '<img src="__PUBLIC__/img/sinology/gou.png" alt="" class="cache_icon" />';
        vids = vids.split('-');
		$('.res_a').each(function(i,n){
			if(vids.indexOf($(n).attr('vid')) != -1)
			{
				$(n).html($(n).html() + rightTemplate )
			}

		})
		$($('.res_a')[0]).click();
	}

	var url = "__URL__";
	var favorStatus = "{$resourceDetails[0].iscollect}";


	function showMainInfo()
	{
		if((fileType == 'ppt' || fileType == 'pdf' || fileType == 'word') && {$isShare} == 0)
		{
			$('#content').show();
			$('.recommend_div,.introduction_div').hide();
		}
		else {
			$('.recommend_div').show();
			$('.introduction_div').hide();
		}
	}
	function showBriefInfo()
	{
		$('#content,.recommend_div').hide();
		$('.introduction_div').height('100%').show();
	}
	function showRelatedResource()
	{
		$('#content,.introduction_div').hide();
		$('.recommend_div').height('100%').show();
	}
	$('.next').click(function(){
		$('.recommend_div').hide();
		$('.introduction_div').show();
	})
	$('.pre').click(function(){
		showMainInfo();
	})
	showMainInfo();

	$('.cang').click(function () {
		var status = (favorStatus == 'yes') ? 2:1;
		$.get("__URL__/favorResource", {id: '{$id}',userId: '{$userId}',role:'{$role}',status:status}, function (res) {
			res = eval('('+res+')');
			if (res.status == 200) {
				if (status == 1) {
					$('.cang').attr('src', '__PUBLIC__/img/resource/icon_shoucang.png');
					$('.favorText').text('您已收藏');
					favorStatus = 'yes';
				}
				else {
					$('.cang').attr('src', '__PUBLIC__/img/resource/icon_shoucang_before.png');
					$('.favorText').text('值得收藏');
					favorStatus = 'no';
				}
			}
		});
	});
	var imgW = $('#content').width();
	var imgH = $('#content').height();
	function displayChange()
	{
		document.getElementById("buylink").style.display = "none";
		document.getElementById("content").style.display = "block";
	}

	function displayBuyDiv()
	{
		document.getElementById("buylink").style.display = "block";

		try{document.getElementById("content").style.display = "none";}
		catch(e){;}
		$('#buylink').find('img').css({
			'width':imgW,
			'height':imgH
		})
	}
	var isPay=1;
	var player;
	$('.res_a').click(function(){
		displayChange();
		switch (fileType) {
			case 'video':
			case 'audio':
				//poly video
				var vid = $(this).attr('vid');
				var charge = $(this).attr('charge');
				var isCached = 	$(this).children('.cache_icon').length != 0;
				var isAllowTrail = $(this).attr('trail');
				var title =  $(this).text();
				$('#polyMedia').html('')
				if({$orderStatus['is_allowed_browse']} != 1 && charge == 2) {

					 player = polyvObject('#polyMedia').previewPlayer({
						'width': '100%',
						'height': '100%',
						'vid': vid
					});
					isPay = 2;
					if(isAllowTrail != 1) {
						displayBuyDiv();
					}

				}
				else {
					 player = polyvObject('#polyMedia').videoPlayer({
						'width': '100%',
						'height': '100%',
						'vid': vid
					});
					isPay=1;
				}
				if(0 == {$isShare})
					$('#resourceMask').remove();
                if(isCached)
				{
		           // add mask to play window and bind click event
					$(document.body).append('<div id="resourceMask"></div>');
					$('#resourceMask').unbind().click(function(){
						var vidObj = {
							'vid':vid,
							'title':title
						}
						if(CheckIsIOS())
						 window.webkit.messageHandlers.iosPlay.postMessage(vidObj);
						else if(CheckIsAndroid())
						 AppFunction.playVideo(JSON.stringify(vidObj));
				    })
				}


				break;
			case 'image':
				// imgSize();
				var file_path = $(this).attr('attr_path');
				$("#videoAudioImageId").attr('src', file_path);
				break;
			case 'swf':
				break;
			case 'pdf':
			case 'word':
			case 'ppt':
				var file_path = $(this).attr('attr_path');
				if(file_path == '')
					$("#pdfViewer").html('资源转换中,请稍候刷新页面重试');
				else
					$("#pdfViewer").html('<iframe id="resourceFrame" frameborder="1" src="__PUBLIC__/pdfjs/viewer/viewer.html?f=' + file_path +'" width="100%" height="100%"/>');
				break;
		}
		imgW = $('#content').width();
		imgH = $('#content').height();
	})	;
	<?php $fileType = $resourceDetails[0]['file_type']; if (1 == $isShare || ($fileType == 'ppt' || $fileType == 'pdf' || $fileType == 'word' )):?>
	$($('.res_a')[0]).click();
	<?php endif; ?>
	<if condition="($resourceDetails[0]['file_type'] eq 'ppt') OR ($resourceDetails[0]['file_type'] eq 'word') OR ($resourceDetails[0]['file_type'] eq 'pdf') ">
	 <?php if (0 == $isShare) :?>
	 $('#content').css('height','100%');
	 <?php endif ; ?>
	function rightUI() {
		return {

		'data': ["showBriefInfo","showRelatedResource",""],
			'type': 2,
			'share': {
				"content":" <?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($resourceDetails[0]['description'])),0,40); ?>",
				"title":"{$resourceDetails[0]['resource_name']}",
				"url": "http://{$_SERVER['SERVER_NAME']}__URL__/resourceDetails?id={$id}&flag=1"
			}

		};
	}


	</if>
	function CheckIsAndroid() {
		var browser = {
			versions: function () {
				var u = navigator.userAgent,
						app = navigator.appVersion;
				return { //移动终端浏览器版本信息
					ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
					android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
					iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
					iPad: u.indexOf('iPad') > -1, //是否iPad
				};
			}(),
		}
		//if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
		//    return false;
		//}
		if (browser.versions.android)
			return true;
		return false;
	}


	function CheckIsIOS() {
		var browser = {
			versions: function () {
				var u = navigator.userAgent,
						app = navigator.appVersion;
				return { //移动终端浏览器版本信息
					ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
					android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
					iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
					iPad: u.indexOf('iPad') > -1, //是否iPad
				};
			}(),
		}
		if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
			return true;
		}
	}
	function share()
	{
		try{
			player.j2s_stopVideo();
		}
		catch(e)
		{
			;
		}
		var data = {
			"content":" <?php echo mb_substr(preg_replace("/\r|\n/",'',strip_tags($resourceDetails[0]['description'])),0,40); ?>",
			"title":"{$resourceDetails[0]['resource_name']}",
			"url": "http://{$_SERVER['SERVER_NAME']}__URL__/resourceDetails?id={$id}&flag=1"
	    };
		if(CheckIsIOS())
			window.webkit.messageHandlers.iosModel.postMessage(data);
		if(CheckIsAndroid())
			AppFunction.shareClick(JSON.stringify(data));

	}

	if(CheckIsIOS())
	window.alert = function(name){
		var iframe = document.createElement("IFRAME");
		iframe.style.display="none";
		iframe.setAttribute("src", 'data:text/plain,');
		iframe.domain = document.domain;
		document.documentElement.appendChild(iframe);
		window.frames[window.frames.length-1].window.alert(name);
		iframe.parentNode.removeChild(iframe);
	};
	var mediaInfos = {};
	if(fileType == "video" || fileType == "audio")
	{
      mediaInfos['id'] = "{$resourceDetails[0]['id']}";
	  mediaInfos['data'] =  Array();
	$('.res_a').each(function(i,n){
        var obj = {
          'title': $(n).text(),
		  'vid':$(n).attr('vid'),
		  'size':(parseFloat(($(n).attr('size'))/1024/1024)).toFixed(2) + 'MB'
	    };
		mediaInfos['data'].push(obj);
	})
	}
    function downloadClick()
	{
		if(!(fileType == "video" || fileType=="audio"))
		{
			alert('手机端暂无法下载此类型资源，请在PC端下载');
			return;
		}
		try{
			player.j2s_stopVideo();
		}
		catch(e)
		{
			;
		}
	    <?php if(($orderStatus['is_allowed_browse'] != 1) AND ($resourceDetails[0]['charge_status'] == 2)) : ?>
             alert('该资源是付费资源\r需付费后才可缓存');
		<?php else :?>
		    var obj = {
		    	'id':"{$resourceDetails[0]['id']}"
		    }
		     if(CheckIsIOS())
			   window.webkit.messageHandlers.iosDownPage.postMessage(obj);
		     if(CheckIsAndroid())
			   AppFunction.download(JSON.stringify(obj));
		<?php endif ; ?>
	}
    function buy()
	{
		try{
			player.j2s_stopVideo();
		}
		catch(e)
		{
			;
		}
		var obj = {
			'id':"{$resourceDetails[0]['id']}"
		}
		if(CheckIsIOS())
			window.webkit.messageHandlers.iosSureOrder.postMessage(obj);
		if(CheckIsAndroid())
			AppFunction.buy(JSON.stringify(obj));
	}
	function pay(obj)
	{
		try{
			player.j2s_stopVideo();
		}
		catch(e)
		{
			;
		}
		var obj = {
			'orderSN':$(obj).attr('orderId')
		}
		if(CheckIsIOS())
			window.webkit.messageHandlers.iosPayOrder.postMessage(obj);
		if(CheckIsAndroid())
			AppFunction.pay(JSON.stringify(obj));
	}



</script>
<script>

	$('.openadd').click(function(){
		var url = $(this).attr('url-data');
		window.location.href = url;//跳到生成的深度链接的url
	});
</script>

<script>
	<?php if ($isShare == 1) :?>
	var url = $('.url').val();
	console.log(url);
	linkedme.init("fd65bd508366dff5336015e5db872def", {type: "live"}, null);
	var data = {};
	data.type = "live";  //表示现在使用线上模式,如果填写"test", 表示测试模式.【可选】
	data.feature = "功能名称"; // 自定义深度链接功能，多个用逗号分隔，【可选】
	data.stage = "阶段名称"; // 自定义深度链接阶段，多个用逗号分隔，【可选】
	data.channel = "渠道名称"; // 自定义深度链接渠道，多个用逗号分隔，【可选】
	data.tags = "标签名称"; // 自定义深度链接标签，多个用逗号分隔，【可选】
	data.ios_custom_url = ""; // 自定义iOS平台下App的下载地址，如果是AppStore的下载地址可以不用填写，【可选】
	data.android_custom_url = "";// 自定义安卓平台下App的下载地址，【可选】
	// 下面是自定义深度链接参数，用户点击深度链接打开app之后，params参数将被带入app
	// 比如详情页面的参数，可以写进去，这样唤起app后可直接跳转到详情页【可选】
	var value1 = 1;
	var value2 = 2;
	data.params = '{"url":"'+url+'","key2":"'+value2+'"}'; //注意单引号和双引号的位置

	linkedme.link(data, function(err, data){
		if(err){
			// 生成深度链接失败，返回错误对象err
			alert('生成错误');
		} else {
			/*
			 生成深度链接成功，深度链接可以通过data.url得到，
			 将深度链接绑定到<a>标签，这样当用户点击这
			 个深度链接，如果是在pc上，那么跳转到深度链接二维
			 码页面，用户用手机扫描该二维码就会打开app；如果
			 在移动端，深度链接直接会根据手机设备类型打开ios
			 或者安卓app
			 */
			$('.openadd').attr('url-data',data.url);
			//document.body.innerHTML += '<a class="linkedme" href="'+data.url+'">打开app</a>'
		}
	},false);

	$('#resourceMask').click(function(){
		$('.fullscreen,.notifyBox').show();
	});
	<?php endif; ?>
	$('.notifyBtn').click(function(){
		$('.fullscreen,.notifyBox').hide();
	})


	function s2j_onPlayOver() {
		if (isPay ==2 ){
			player.j2s_stopVideo();
			exitFullscreen();
			displayBuyDiv();
			if(CheckIsIOS())
			 $('#polyMedia').html('');
			else if(CheckIsAndroid())
 			 AppFunction.hideCustomView();

		}
	}

	if({$isShare} == 1)
	{
		var modal = document.getElementById('resourceMask'); //  dom对象
		modal.addEventListener('touchmove', function(e) {
			e.preventDefault();
		}, false);

	}


</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="__PUBLIC__/js/share.js?v=20170712"></script>
<script>
	var appId = '{$signPackage.appId}';
	var timestamp = '{$signPackage.timestamp}';
	var nonceStr = '{$signPackage.nonceStr}';
	var signature = '{$signPackage.signature}';
	var title = "{$resourceDetails[0]['resource_name']}";
	var content = " <?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($resourceDetails[0]['description'])),0,40); ?>";
	var linkimgUrl = 'http://{$WEB_URL}/Public/img/sharelogo.png';

	var res_id = "{$resourceDetails[0]['id']}";
	var type = 1;

	share_weixin(appId, timestamp, nonceStr, signature, title, content, linkimgUrl,res_id,type);
	//get cacheed vids from app
	<?php if (0 == $isShare): ?>
	var vids = [];
	var obj = {
		'id':"{$resourceDetails[0]['id']}"
	};
	try{
		if(CheckIsIOS())
			vids = window.webkit.messageHandlers.iosVidArray.postMessage(obj);
		if(CheckIsAndroid())
			vids = AppFunction.getDownloadVids(JSON.stringify(obj));
		if(vids == undefined)
			vids = [];
	}
	catch(e){;}
	<?php endif; ?>
	function exitFullscreen() {
		if(document.exitFullscreen) {
			document.exitFullscreen();
		} else if(document.mozExitFullScreen) {
			document.mozExitFullScreen();
		} else if(document.webkitExitFullscreen) {
			document.webkitExitFullscreen();
		}
	}
</script>
</html>
