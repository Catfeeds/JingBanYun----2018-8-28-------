<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>作品详情</title>
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<script src="http://apps.bdimg.com/libs/jquery/1.10.1/jquery.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/rem.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		img {
			max-width: 100%
		}

		html, body {
			width: 100%;
		}

		body {
			-webkit-tap-highlight-color: rgba(0,0,0,0);
			padding: 15px;
		}
		
		#Wrapper {
			background: #fff;
			overflow: hidden;
			padding-bottom: 50px
		}
		
		h1 {
			line-height: 40px;
			font-size: 20px;
			text-align: center;
		}
		
		span {
			color: #666;
			font-size: 18px;
			line-height: 30px;
			width: 50%;
			text-align: center;
			display: inline-block;
		}
		
		h3 {
			line-height: 30px;
			text-align: center;
			font-size: 18px;
		}
		
		p {
			text-align: justify;
			font-size: 18px;
			line-height: 30px;
			color: #333;
			word-wrap: break-word;
		}
		
/*		.Basten {
			background: url(__PUBLIC__/img/app/xinxi.png) no-repeat;
			background-size: 20px;
			background-position: 4rem 7px;
			text-indent: 6rem;
			text-align: left;
		}*/

		.Basten img {
			height: 18px;
			vertical-align: middle;
			margin-right: 3px;
		    position: relative;
    		top: -1px;
		}
		
		#bastenContent {
			background: #eee;
			font-size: 16px;
			line-height: 25px;
			text-align: justify;
			padding: 10px 10px 5px;
			border-radius: 5px;
			display: none;
			overflow: hidden;
		}
/*		  .bastenactive{
			background: url(__PUBLIC__/img/app/xinxi2.png) no-repeat;
			  background-size: 20px;
			  background-position: 4rem 7px;
		}*/
		#bastenContenthide{
			text-align: right;
			font-size: 16px;
		    display: inline-block;
			float: right;
			width: 20%;
			margin-top: 10px;
			color: #6acbcb
		}
		.btnBottom {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			background: #eee;
			height: 50px;
			border-top: 1px solid #eee;
			box-sizing: border-box;
		}
		
		.signBtn {
			display: inline-block;
			text-decoration: none;
			color: #999;
			border: 1px solid #999;
			padding: 4px 16px 4px 20px;
			margin-top: 6px;
			line-height: 25px;
			border-radius: 20px;
		}
			.left {
			float: left;
		}
		
		.right {
			float: right;
		}
		.zanBtnBlack, .favorBtnBlack, .zanBtnRed, .favorBtnRed {
			width: 100%;
			height: 50px;
			border: none;
			padding: 0;
			color: #999;
			outline: none;
			text-align: left;
			text-indent: 25px;
			font-size: 14px
		}
		
			.zanBtnBlack {
			background:  url({$oss_path}public/web_img/App/zanBtnBlack.png) no-repeat 41% center;
			background-size: 20px 17px;
		}
		
		.favorBtnBlack {
			background: url({$oss_path}public/web_img/App/favorGray.png) no-repeat left 13px;
			/*background-size: 17px 17px;*/
		}
		
		.zanBtnRed {
			background: url({$oss_path}public/web_img/App/zanBtnRed.png) no-repeat 41% center;
			background-size: 20px 17px;
		}
		
		.favorBtnRed {
			background:  url({$oss_path}public/web_img/App/favorRed.png) no-repeat left 13px;
			/*background-size: 17px 17px;*/
		}

		#zanIcon, #favorIcon {
			line-height: 50px;
			text-align: center;
			display: block;
			width: 90px;
			margin: auto;
		}

		a{display: block;color: #666;word-break: break-all;font-size: 16px;line-height: 25px;text-decoration: none}
		#tanchuang{
			background:url(__PUBLIC__/img/app/quapp.png) no-repeat;
			width: 80%;height: 200px;
			background-size: 100% ;
			border: 1px solid #eee;
			border-radius: 10px;position: fixed;top: 0;bottom: 0;right: 0;left: 0;margin: auto auto;display: none;
			z-index: 2;background-color: #fff;
		}

		.text16 {
			font-size: 16px;
			line-height: 25px;
		}
		
		.greenImg {
			display: none;
		}
	</style>
</head>

<body>
    <notempty name="data"> 
	<div id="Wrapper">
		<h1>{$data.works_name}</h1>
		<span>{$data.course_name}/{$data.grade}</span><span class="Basten"><img src="__PUBLIC__/img/app/xinxi.png" alt="" class="grayImg"><img src="__PUBLIC__/img/app/xinxi2.png" alt="" class="greenImg">作者寄语</span>
		<div id="bastenContent">
                   	 <if condition="$data['author_remarks'] neq ''">
                        {$data.author_remarks}
                    <else />
                        作者未填写寄语
                    </if> 
					
			<span id="bastenContenthide">收起</span>
		</div>
		<h3>作品描述：</h3>
		<p style="margin-bottom: 15px">
                    {$data.works_description}
                </p> 
                <notempty name="works_file_list">
                    <div class="text16">
                    附件：点击可在线观看视频/音频/图片/word/pdf/ppt
                    </div>
                    <volist name="works_file_list" id="works_file_item">
                        <a class='browse_resource' attr_type="{$works_file_item.type}" attr_path="{$oss_path}<?php 
                           if($works_file_item['type']=='word' || $works_file_item['type']=='ppt'){ 
                                $path=explode('.',basename($works_file_item['works_file_path']));
                                $path=$path[0].'.pdf';
                                $path = 'Activity/Works/'.$works_file_item['id'] .'/' .$path;
                                echo $path;
                           }else{
                            echo $works_file_item['works_file_path'];
                           }
                           ;?>">{$works_file_item.works_file_name}</a>
                    </volist>
                    
                    <div class="contentBox" style="display:none;"> 
                        <switch name="works_file_list[0].type">
                            <case value="pdf|word|ppt"> 
                                <iframe id="resourceFrame" frameborder="0" src="__PUBLIC__/pdfjs/viewer/viewer.html?f={$oss_path}<?php
                                    if($works_file_list[0]['type'] == 'word' ||   $works_file_list[0]['type'] == 'ppt')
                                    {
                                    $path = explode('.',basename($works_file_list[0]['works_file_path']));
                                    $path=$path[0].'.pdf'; 
                                    $path = 'activity/activityWorks/' .$data['id'].'/'.$works_file_list[0]['id'] .'/' .$path;
                                    echo $path;
                                    }
                                    else
                                    echo $works_file_item[0]['works_file_path'];
                                    ?>" width="100%" height="500">
                                </iframe>
                            </case>
                            <case value="image">
                                <div class="browse_image">
                                    <img src="{$oss_path}{$works_file_list[0].works_file_path}" />
                                </div>
                            </case> 
                            <case value="video"> 
                                <div id='plv'>
                                    <video src="{$works_file_list[0].vid_fullpath}" width="90%" controls/>
                                </div>
                            </case>
                            <case value="audio">
                                <div id='plv'>
                                    <video src="{$works_file_list[0].vid_fullpath}" width="90%" controls/>
                                </div>
                            </case>
                            <default/>
                            <div>
                            </div>
                        </switch>
                    </div>
                </notempty>
                    
		<div id="tanchuang">
			<span style="margin-top:45%;font-size:18px;background:#6bcbca;padding:5px 20px;color:#fff;margin-left:20%;border-radius:8px">好的</span>
		</div>
	</div>
    </notempty> 
    <div {$role!=5? 'class="btnBottom"': ''}>
       <div class="favorBox" style="width: 100%; text-align: center; line-height: 50px; box-sizing: border-box;">
<!--                 <notempty name="existed_zan">
                    <if condition="$role neq 5">
                        <if condition="$existed_zan eq 'yes'">
                                <span id="zanIcon" class="left zanBtnRed">{$data.zan_count}</span>
                                <else/>
                                <span id="zanIcon" class="left zanBtnBlack">{$data.zan_count}</span>
                        </if>
                    </if>
                </notempty> -->
                <notempty name="existed_favor">
                    <if condition="$role neq 5">
                        <if condition="$existed_favor eq 'yes'">
                            <!-- <span id="favorIcon" class="favorBtnRed">{$data.favor_count}</span> -->
                            <span id="favorIcon" class="favorBtnRed">取消收藏</span>
                        <else/>
                            <!-- <span id="favorIcon" class="favorBtnBlack">{$data.favor_count}</span> -->
                            <span id="favorIcon" class="favorBtnBlack">值得收藏</span>
                        </if>
                    </if>
                </notempty>
       </div>
    </div>
    
	<script>
        //不支持资源的格式弹窗
        /*$('a').click(function(){
                $('#tanchuang').show()
        })*/
        $('#tanchuang>span').click(function(){
                $('#tanchuang').hide()
        })
	var c = 1 ;
	$('.Basten').click(function(){
		c++;
		$(this).children('.greenImg').show().siblings('.grayImg').hide();
		if(c%2 != 0){
				$(this).children('.grayImg').show().siblings('.greenImg').hide();
		}
		
		$('#bastenContent').toggle();
	})
	$('#bastenContenthide').click(function(){
		c++;
		$('#bastenContent').hide();
		$('.grayImg').show().siblings('.greenImg').hide();
	})
	</script>
	<script>
	var obj = {};
	var sp_arr = window.location.search.substr(1).split("&");
	for (var i = 0; i < sp_arr.length; i++) {
		var arr2 = sp_arr[i].split("=");
		obj[arr2[0]] = arr2[1];
	}
	if(obj.role == 2) {
		$('.teacherId').val(obj.user_id);
	}
	
	$('.submitBtn').click(function () {
		console.log($('#register_info').val())
		if($('#register_info').val() != ''){
			window.location.reload(); 
		}
	})
	
	$('.baoming').click(function() {
		$('#register_info').focus()
	})
</script>
	<!--不同角色不同功能-->
<script> 
    var user_id="{$userId}";
    var role="{$role}"; 
    var id="{$data.id}";
    var zan_count="{$data.zan_count}";
    var favor_count="{$data.favor_count}";
    
    $('#zanIcon').click(function(){
        if(user_id==false || role==false || id==false){
            return false;
        }else{ 
            $.getJSON("{:U('ApiInterface/Version1_1/activity/operationWorksZan')}",{id:id,role:role,user_id:user_id},function(msg){
                 if(msg.status==200){
                     if($('#zanIcon').hasClass('zanBtnRed')){
                         zan_count--;
                         $('#zanIcon').text(zan_count);
                         $('#zanIcon').removeClass('zanBtnRed').addClass('zanBtnBlack');
                     }else{
                         zan_count++;
                         $('#zanIcon').text(zan_count);
                         $('#zanIcon').removeClass('zanBtnBlack').addClass('zanBtnRed');
                     }
                 }else if(msg.status==402){
                    alert('不能对自己发布的作品点赞!');
                 }else{
                     alert('操作失败');
                 }
            });
        }
    });
    
    $(".favorBox").click(function(){
        if(user_id==false || role==false || id==false){
            return false;
        }else{
            $.getJSON("{:U('index.php/ApiInterface/Version1_1/Activity/operationWorksFavor')}",{id:id,role:role,user_id:user_id},function(msg){
                if(msg.status==200){ 
                    if($('#favorIcon').hasClass('favorBtnRed')){
                        favor_count--;
                        // $('#favorIcon').text(favor_count);
                        $('#favorIcon').text('值得收藏');
                        $('#favorIcon').removeClass('favorBtnRed').addClass('favorBtnBlack');
                    }else{
                        favor_count++;
                        // $('#favorIcon').text(favor_count);
                        $('#favorIcon').text('取消收藏');
                        $('#favorIcon').removeClass('favorBtnBlack').addClass('favorBtnRed');
                    }
                }else{
                    alert('操作失败');
                }
            });
        }
    });
    
    
    
    //点击查看图片
    $('.browse_resource').click(function(){
                var u = navigator.userAgent;
                var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
                var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
                console.log('是否是Android：'+isAndroid);
                console.log('是否是iOS：'+isiOS);
                //ios系统 除了image,别的都新页面打开
                var type = $(this).attr('attr_type');
                if(isiOS == true){ 
                        switch(type) {
                                case 'image':    
                                case 'video': 
                                case 'audio':
                                case 'ppt': 
                                case 'word': //ppt ios是否支持
                                case 'pdf':
                                    var attr_path = $(this).attr('attr_path'); 
                                    location.href=attr_path;

                                break;
                                case 'swf': 
                                case 'condensed':
                                    ('#tanchuang').show();
                                break;

                        }
                } else if(isAndroid == true) {
                        $(".contentBox").css('display','block');  
                        $('.contentBox').empty();   
                        switch(type) {
                                case 'video': 
                                case 'audio':
                                        var video_src = $(this).attr('attr_path');
                                        var videoBox = '<video src="'+video_src+'" width="100%" controls/>'; 
                                        var video_element="<div id='plv'></div>";
                                        $(".contentBox").append(video_element); 
                                        $("#plv").append(videoBox)

                                        break;
                                case 'image':
                                        var file_path = $(this).attr('attr_path');  
                                        var imaggBox='<img src='+file_path+' style="width:100%"/>'; 
                                        var image_element='<div class="browse_image"></div>';
                                        $(".contentBox").append(image_element);  
                                        $(".browse_image").append(imaggBox);

                                        break;
                                case 'ppt': 
                                case 'word': 
                                case 'pdf':
                                        var file_path = $(this).attr('attr_path');  
                                        var iframe_element='<iframe id="resourceFrame" frameborder="0" src="" width="100%" height="500" </iframe>'; 
                                        $(".contentBox").append(iframe_element); 

                                        $("#resourceFrame").attr('src', "__PUBLIC__/pdfjs/viewer/viewer.html?f=" + file_path);				
                                        break;
                                case 'swf':
                                case 'condensed':
                                        ('#tanchuang').show();
                                        break; 
                        }
                }

        })
</script>
</body>

</html>