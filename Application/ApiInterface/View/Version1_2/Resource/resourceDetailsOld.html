<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{$data.name}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />

	<script src="__PUBLIC__/js/rem.js"></script>
	<script src="http://apps.bdimg.com/libs/jquery/1.10.1/jquery.js" type="text/javascript"></script>
	<script src='__PUBLIC__/js/external/polyvplayer.min.js'></script>
	<script src="https://lkme.cc/js/linkedme.min.js" ></script>

	<link href="__PUBLIC__/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	<link href="__PUBLIC__/css/appCommon.css" type="text/css" rel="stylesheet">
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.config.js?v=1"></script>
	<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/umeditor/lang/zh-cn/zh-cn.js"></script>

</head>
<style>
	*{
		margin: 0;
		padding: 0;
	}
	html,body{
		width: 100%;
		font-family: "微软雅黑";
	}
	.m0{
		margin: 0 !important
	}
	.recommend .res_a{
		color: #30b753;
		display: block;
		font-size: 16px;
		line-height: 26px;

	}
	#resourceMask{
		position: fixed;
		top:0;
		left: 0;
		width:100%;
		height:40%;
		z-index:2;
		opacity: 1
	}
	.p20{
		padding: 10px 20px;
	}
	.icon{
		width: 18px;
		margin-right: 5px;
		margin-left: 15px;
		margin-top: 3px;
	}
	.book{
		width: 80px;
		height: 80px;
	}
	.textIndent0{
		text-indent: 0 !important
	}
	.left{
		float: left;
	}
	ul,li{
		list-style: none
	}
	p{
		font-size: 16px;
		line-height: 20px;
		color: #666
	}
	.left p{
		text-indent: 15px;
		line-height: 20px;
		display: block;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		color: #333;
		width: 210px;
	}
	.of{
		overflow: hidden;

	}
	.right {
		float: right;
	}
	.pl10{
		padding-left: 10px;
	}
	.res_list{
		padding:10px 0;
		border-top:1px solid #eee
	}
	.relevant,.name,.introduction{
		padding: 5px 10px;
		line-height: 26px;
	}
	.breee{
		border: 1px solid #eee;
		padding: 5px 10px
	}
	.next{
		width: 18px;
		height: 20px;
		margin-right: 10px;
		margin-top: 3px;
	}
	.cang,.xiang{
		width: 20px;
		height: 20px;

	}
	.mr10{
		margin-right: 10px;
	}
	.f14{
		font-size: 14px;
	}
	.text-center{
		text-align: center;
	}
	.iconbtn{

		border-bottom: 10px solid #ededed;
	}
	.pre{
		width: 18px;
		margin-right: 10px;
		margin-top: 4px;
	}
	.introduction_div{
		display: none;
	}
	.introduction{
		border-bottom: 1px solid #eee;

	}
	.w50{
		width: 50%;
		display: inline-block;
		float: left;
	}
	.introduction_div p{
		line-height: 26px;
		color: #666;
		word-break: break-all;
	}
	.favor{
		position: relative;
		top:3px
	}
	#resourceMask{
		position: fixed;
		top:0;
		left: 0;
		width:100%;
		height:40%;
		z-index:2;
		opacity: 1
	}
	#content,#buylink{
		position: fixed;
		top:0;
		left: 0;
		width:100%;
		height:40%;
		z-index:1;
	}

	#content {
		background: #fff;
	}

	#content img{
		width: auto;
		height: 100%;
		max-width: 100%;
		max-height: 100%;
		display: block;
		margin: 0 auto;
	}

	.footer{
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		line-height: 49px;
		background: #fff;
		font-size: 14px;
		border-top: 1px solid #ededed;
	}
	.footer img{
		vertical-align: middle;
		margin-right: 8px;
		position: relative;
		top: -1px
	}
	.green{
		background: #22c67e;
		color: #fff
	}
	.content{
		margin-bottom: 60px
	}
	.w20{
		width: 20px
	}
	.cache_icon{
		width: 1.3rem;
		margin-left: 2rem

	}
	.lh24{
		line-height: 24px
	}
	.smallfz{
		font-size: 1rem;
		color: gray
	}
	.fullscreen {
		display: none;
		width: 100%;
		height: 100%;
		background: rgba(0,0,0,0.3);
		position: fixed;
		top: 0;
		left: 0;
		z-index: 3;
	}

	.notifyBox {
		display: none;
		width: 280px;
		height: 200px;
		background: #fff;
		border-radius: 10px;
		position: fixed;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		margin: auto;
		z-index: 4;
	}

	.notifyTitle {
		text-align: center;
		font-size: 2rem;
		line-height: 70px
	}

	.btnBox {
		text-align: center;
	}

	.notifyBtn {
		display: inline-block;
		background-color: #28D0C1;
		border: 1px solid transparent;
		border-radius: 6px;
		color: white;
		font-size: 16px;
		padding: 6px 22px;
	}

	.notifyMain {

		text-align: center;
		font-size: 16px;
margin-top: 20px;
margin-bottom: 30px;
	}
	#enteredjby,
	#enteredjbytwo {

		text-align: center;
		margin-top : 5rem
	}

	#enteredjby a,
	#enteredjbytwo a {
		background: #46cfdd;
		color: #fff;
		margin: 3rem auto;
		padding: 1rem 2rem;
		border-radius: 10px;
		text-decoration: none
	}
	.border_left60,.border_left80{
		width: 60px;
		border-left: 1px solid #eee;
		margin-bottom: 10px
	}
	.border_left80{
		width: 80px
	}
	.borderLeft{
		border-left: 5px solid #30b753;
		padding: 0;
		margin: 5px 10px;
		text-indent: 10px;
	}
	.borderBottom{
		border-bottom: none
	}
	@media screen and (min-width: 370px){
		.left p{
			width: 260px
		}
	}
	@media screen and (min-width: 400px){
		.left p{
			width: 300px
		}
	}
	@media screen and (min-width: 600px){
		.w88{
			width: 88%
		}
		.left p{
			width: 100%
		}
	}
	.fz14{
		font-size: 14px
	}
	.textOverflow{
		white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
	}

	.briefP {
		color: #333;
	}

	.briefP span {
		color: #999;
	}
</style>
<body>

<?php if ($flag): ?>
<div id="resourceMask">

</div>
<?php endif ?>


<div id="content">
	<switch name="data.type">
		<case value="video">
			<div id="polyMedia" type="{$data.type}" vid="{$data[result_list][0].vid}" style="display:block;height:100%" ></div>
		</case>
		<case value="audio">
			<div id="polyMedia" type="{$data.type}" style="display:block;height:100%"></div>
		</case>
		<case value="image">
			<img src="{$oss_path}{$data.file_path}" attr_path="{$oss_path}{$data.file_path}" width="100%" id="videoAudioImageId" style="background:#fff" controls>
		</case>
		<case value="condensed">
			手机暂不支持压缩包的查看,请登录PC版京版云查看该资源
		</case>
		<case value="swf">
			手机暂不支持FLASH的查看,请登录PC版京版云查看该资源
		</case>
		<case value="pdf|word|ppt" type="{$data.type}">
			<div id="pdfViewer" style="height:100%">

			</div>
		</case>
	</switch>
</div>

<if condition="(($data['type'] neq 'ppt') AND ($data['type'] neq 'word') AND ($data['type'] neq 'pdf') && ($role neq 5)) ">
	<div class="of iconbtn">
		<div class="right text-center border_left80">
			<?php if($existedFavor == 'no') : ?>
			<img src="__PUBLIC__/img/resource/icon_shoucang_before.png" alt="" class="cang">
			<p  class="f14 favorText cang" style="width:auto;height:auto">值得收藏</p>
			<?php else : ?>
			<img src="__PUBLIC__/img/resource/icon_shoucang.png" alt="" class="cang">
			<p  class="f14 favorText cang" style="width:auto;height:auto">您已收藏</p>
			<?php endif ; ?>

		</div>

		<?php if ($data['status']==2): ?>
			<div class="right text-center border_left60 ">

				<img src="__PUBLIC__/img/resource/icon_fenxiang_before.png" alt="" class="xiang"  onclick="share()">
				<p class="f14 shareButton" onclick="share()">分享</p>
			</div>
		<?php endif ?>

	</div>
</if>
<div class="content">
	<div class="recommend_div">
		<p class="name borderLeft">
			简介
			<if condition="($data['type'] neq 'ppt') AND ($data['type'] neq 'word') AND ($data['type'] neq 'pdf') ">
			<img src="__PUBLIC__/img/resource/xiala.png" alt="" class="next right">
			<else/>
			<img src="__PUBLIC__/img/resource/shangla.png" alt="" class="pre right">
			</if>
		</p>
		<div class="recommend">
			<div class="breee borderBottom"><p class="relevant borderLeft m0">资源列表</p></div>
			<div class="breee">
				<volist name="contactInfo" id="contactInfo">
					<a href="javascript:void(0);" trail="{$contactInfo.trial_status}" charge={$contactInfo.charge_status} size="{$contactInfo.vid_fullsize}" vid="{$contactInfo.vid}" class="res_a"  attr_path="<?php
					  if( ($data['type'] == 'ppt' || $data['type'] == 'word') )
                       {
                       $path = explode('.',basename($contactInfo['resource_path']));
                       $path=$path[0].'.pdf';
                       $path = 'teacher/' .$data['id'].'/'.$contactInfo['id'] .'/' .$path;
                       echo $oss_path.$path;
                       }
                      else if($data['type'] == 'pdf' || $data['type'] == 'image')
                      {
                       echo $oss_path.$contactInfo['resource_path'];
                      }else{
                      echo $oss_path.$contactInfo['resource_path'];
                      }
					?>">查看第 {$key+1} 个资源</a>
				</volist>
			</div>
			<?php if($isShare == 0) : ?>
				<?php if(!empty($reList)) : ?>
					<!-- <p class="relevant borderLeft">相关推荐</p> -->
					<p class="relevant">相关推荐</p>
					<div >
						<ul>
							<volist name="reList" id="recommendInfo">
								<li class="res_list">
									<a href="__URL__/resourceDetails?id={$recommendInfo.id}&userId={$userId}&role={$role}" attr_id="{$recommendInfo.id}">
										<div class="of pl10">
											<div class="left">

												<img src="{$recommendInfo.img_path}" alt="" class="book">


											</div>
											<div class="left w88">
												<p class="textIndent0">
													<img src="{$recommendInfo.icon_url}" alt="" class="icon left">
													<span>{$recommendInfo.type}</span>
												</p>
												<p>{$recommendInfo.name}</p>
												<p class="fz14"><span class="left w50 textOverflow">学校：{$recommendInfo.school_name}</span> <span class="right w50 textOverflow" style="text-align:right">({$recommendInfo.textbook})</span></p>
													<p class="fz14">
														<span class="left">{$recommendInfo.tname}</span><span class="right">{$recommendInfo.create_at|date="Y/m/d",###}</span>
													</p>
											</div>
										</div>
									</a>
								</li>
							</volist>
						</ul>
					</div>
				<?php endif ; ?>
			<?php else : ?>
			<div id="enteredjby">
				<a href="javascript:" class="openadd linkedme">打开京版云</a>
				<input type="hidden" value="{$urldata}" class="url">
			</div>
			<?php endif ; ?>
		</div>
	</div>
	<div class="introduction_div">
		<p class="introduction"><b>简介</b>
			<img src="__PUBLIC__/img/resource/icon_guanbi.png" alt="" class="pre right">
		</p>
		<div class="p20">
			<p class="briefP"><span class="color999">名称：</span><b>{$data.name}</b>
				<?php if($existedFavor == 'no') : ?>
				<img src="__PUBLIC__/img/resource/icon_shoucang_before.png" alt="" class="cang right">
			    <?php else : ?>
			    <img src="__PUBLIC__/img/resource/icon_shoucang.png" alt="" class="cang right">
			    <?php endif ; ?>
			</p>
			<p class="briefP"><span>资源格式：</span><b>{$data.type}</b></p>
			<p class="briefP"><span>学科：</span>{$data.course_name} </p>
			<p class="briefP"><span>年级：</span>{$data.grade}</p>
			<p class="briefP"><span>教材分册：</span>{$data.textbook}</p>
			<p class="briefP"><span>资源概述：</span>{$data.description}</p>
		</div>
	</div>
</div>


<div class="fullscreen"></div>
<div class="notifyBox">
	<p class="notifyTitle">提示</p>
	<div class="notifyMain">请进入或下载京版云APP后观看资源 !</div>
	<div class="btnBox">
		<span class="notifyBtn">好的</span>
	</div>
</div>
</body>

<script type="text/javascript" charset="utf-8" src="__PUBLIC__/js/notify/notifyApp.js"></script>

<script>
	function imgSize(){
		// if($('#content').children('img').length == "1") {
		// 	$('#content').css('height','inherit')
		// }
		$('.iconbtn').css('margin-top',$('#content').height()+10)
	}

	imgSize();
</script>

<script>

	$('.openadd').click(function(){
		var url = $(this).attr('url-data');
		window.location.href = url;//跳到生成的深度链接的url
	});
</script>

<script>

	var userId = '{$userId}';
	var role = '{$role}';
	var fileType = '{$data.type}';
	var flag = '{$flag}';
	var res_status = '{$data.status}';

	var url = "__URL__";
	var favorStatus = "{$existedFavor}";

	if ( fileType=='pdf'||fileType=='word'||fileType=='ppt' ){
		if (res_status==2) {
			window.rightUI=function() {
				return {

					'data': ["showBriefInfo","showRelatedResource",""],
					'type': 2,
					'share': {
						"content":"<?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($data['description'])),0,40); ?>",
						"title":"{$data['name']}",
						"url": "http://{$_SERVER['SERVER_NAME']}__URL__/resourceDetails?id={$data['id']}&flag=1"
			}

			};
			}
		} else{
			window.rightUI=function() {
				return {

					'data': ["showBriefInfo","showRelatedResource",""],
					'type': 4,
					'share': {
						"content":"<?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($data['description'])),0,40); ?>",
						"title":"{$data['name']}",
						"url": "http://{$_SERVER['SERVER_NAME']}__URL__/resourceDetails?id={$data['id']}&flag=1"
			}

			};
			}
		}

	}

	function showBriefInfo()
	{
		$('#content,.recommend_div').hide();
		$('.introduction_div').height('100%').show();
	}
	function showRelatedResource()
	{
		$('#content,.introduction_div').hide();
		$('.recommend_div').height('100%').show();
		$('.borderLeft').hide();
	}
	$('.next').click(function(){
		$('.recommend_div').hide();
		$('.introduction_div').show();
	})
	$('.pre').click(function(){
		$('.introduction_div').hide()
		showMainInfo();
	})
	showMainInfo();

	// $(document).on('click touchstart','.cang',function(){
	$('.cang').click(function(){

		var sendurl = '';
		if (role==2) {
			sendurl = '/index.php/Home/Teach/favorResource';
		}
		if (role==3) {
			sendurl = '/index.php/Home/Student/favorResource';
		}
		if (role==4) {
			sendurl = '/index.php/Home/Parent/favorResource';
		}

		if (userId==0 || userId=='') {
			// alert('请登录后进行收藏');
			$.NotifyBox.NotifyPromptOne('提示','请登录后进行收藏','确定');
			return;
		}

		$.get(sendurl, {id: '{$data.id}',user_id: userId,role:role,favorStatus:favorStatus}, function (res) {
			if (res == 'success') {
				if (favorStatus == 'no') {
					$('.cang').attr('src', '__PUBLIC__/img/resource/icon_shoucang.png');
					$('.favorText').text('您已收藏');
					favorStatus = 'yes';
				} else {
					$('.cang').attr('src', '__PUBLIC__/img/resource/icon_shoucang_before.png');
					$('.favorText').text('值得收藏');
					favorStatus = 'no';
				}
			} else {
				$('.cang').attr('src', '__PUBLIC__/img/resource/icon_shoucang_before.png');
				$('.favorText').text('值得收藏');
				favorStatus = 'no';
			}
		});
	});

	var imgW = $('#content').width();
	var imgH = $('#content').height();
	function displayChange()
	{
		document.getElementById("buylink").style.display = "none";
		document.getElementById("content").style.display = "block";
	}

	function displayBuyDiv()
	{
		document.getElementById("buylink").style.display = "block";

		try{document.getElementById("content").style.display = "none";}
		catch(e){;}
		$('#buylink').find('img').css({
			'width':imgW,
			'height':imgH
		})
	}

	var player;
	$('.res_a').click(function(){
		switch (fileType) {
			case 'video':
			case 'audio':
				//poly video
				var vid = $(this).attr('vid');
				$('#polyMedia').html('');
				 player = polyvObject('#polyMedia').videoPlayer({
					'width': '100%',
					'height': '100%',
					'vid': vid
				});

				break;
			case 'image':
				// imgSize();
				var file_path = $(this).attr('attr_path');
				$("#videoAudioImageId").attr('src', file_path);
				break;
			case 'swf':
				break;
			case 'pdf':
			case 'word':
			case 'ppt':
				$('#content').show();
				var file_path = $(this).attr('attr_path');
				if(file_path == '')
					$("#pdfViewer").html('资源转换中,请稍候刷新页面重试');
				else
					$("#pdfViewer").html('<iframe id="resourceFrame" frameborder="1" src="__PUBLIC__/pdfjs/viewer/viewer.html?f=' + file_path +'" width="100%" height="100%"/>');
					if(flag!=1){
						$('#content').css('height','100%');
					} else {
						$('#enteredjby').show();
						$('#enteredjby').css('margin-top','18rem');
					}

				break;
		}
		imgW = $('#content').width();
		imgH = $('#content').height();
	});

	$($('.res_a')[0]).click();

	function showMainInfo()
	{
		if((fileType == 'ppt' || fileType == 'pdf' || fileType == 'word') )
		{
			$('#content').show();
		}
		else {
			$('.recommend_div').show();
		}
	}

	function share()
	{
		try{
			player.j2s_stopVideo();
		}
		catch(e)
		{
			;
		}
		var data = {
			"content":"<?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($data['description'])),0,40); ?>",
			"title":"{$data['name']}",
			"url": "http://{$_SERVER['SERVER_NAME']}__URL__/resourceDetails?id={$data['id']}&flag=1"
		};
		if(CheckIsIOS())
			window.webkit.messageHandlers.iosModel.postMessage(data);
		if(CheckIsAndroid())
			AppFunction.shareClick(JSON.stringify(data));

	}

	function CheckIsAndroid() {
		var browser = {
			versions: function () {
				var u = navigator.userAgent,
						app = navigator.appVersion;
				return { //移动终端浏览器版本信息
					ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
					android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
					iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
					iPad: u.indexOf('iPad') > -1, //是否iPad
				};
			}(),
		}
		//if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
		//    return false;
		//}
		if (browser.versions.android)
			return true;
		return false;
	}


	function CheckIsIOS() {
		var browser = {
			versions: function () {
				var u = navigator.userAgent,
						app = navigator.appVersion;
				return { //移动终端浏览器版本信息
					ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
					android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
					iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
					iPad: u.indexOf('iPad') > -1, //是否iPad
				};
			}(),
		}
		if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
			return true;
		}
	}
</script>

<script>
	<?php if ($isShare == 1) :?>
	var url = $('.url').val();
	console.log(url);
	linkedme.init("fd65bd508366dff5336015e5db872def", {type: "live"}, null);
	var data = {};
	data.type = "live";  //表示现在使用线上模式,如果填写"test", 表示测试模式.【可选】
	data.feature = "功能名称"; // 自定义深度链接功能，多个用逗号分隔，【可选】
	data.stage = "阶段名称"; // 自定义深度链接阶段，多个用逗号分隔，【可选】
	data.channel = "渠道名称"; // 自定义深度链接渠道，多个用逗号分隔，【可选】
	data.tags = "标签名称"; // 自定义深度链接标签，多个用逗号分隔，【可选】
	data.ios_custom_url = ""; // 自定义iOS平台下App的下载地址，如果是AppStore的下载地址可以不用填写，【可选】
	data.android_custom_url = "";// 自定义安卓平台下App的下载地址，【可选】
	// 下面是自定义深度链接参数，用户点击深度链接打开app之后，params参数将被带入app
	// 比如详情页面的参数，可以写进去，这样唤起app后可直接跳转到详情页【可选】
	var value1 = 1;
	var value2 = 2;
	data.params = '{"url":"'+url+'","key2":"'+value2+'"}'; //注意单引号和双引号的位置

	linkedme.link(data, function(err, data){
		if(err){
			// 生成深度链接失败，返回错误对象err
			// alert('生成错误');
			$.NotifyBox.NotifyPromptOne('提示','生成错误','确定');
		} else {
			/*
			 生成深度链接成功，深度链接可以通过data.url得到，
			 将深度链接绑定到<a>标签，这样当用户点击这
			 个深度链接，如果是在pc上，那么跳转到深度链接二维
			 码页面，用户用手机扫描该二维码就会打开app；如果
			 在移动端，深度链接直接会根据手机设备类型打开ios
			 或者安卓app
			 */
			$('.openadd').attr('url-data',data.url);
			//document.body.innerHTML += '<a class="linkedme" href="'+data.url+'">打开app</a>'
		}
	},false);

	$('#resourceMask').click(function(){
		$('.fullscreen,.notifyBox').show();
	});
	<?php endif; ?>
	$('.notifyBtn').click(function(){
		$('.fullscreen,.notifyBox').hide();
	})


	function s2j_onPlayOver() {
		if (isPay ==2 ){
			player.j2s_stopVideo();
			exitFullscreen();
			displayBuyDiv();
			if(CheckIsIOS())
				$('#polyMedia').html('');
			else if(CheckIsAndroid())
				AppFunction.hideCustomView();

		}
	}

	if({$isShare} == 1)
	{
		var modal = document.getElementById('resourceMask'); //  dom对象
		modal.addEventListener('touchmove', function(e) {
			e.preventDefault();
		}, false);

	}


</script>

<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js?v=2221"></script>
<script src="__PUBLIC__/js/share.js?v=20170713111"></script>
<script>
	var appId = '{$signPackage.appId}';
	var timestamp = '{$signPackage.timestamp}';
	var nonceStr = '{$signPackage.nonceStr}';
	var signature = '{$signPackage.signature}';
	var title = "{$data['name']}";
	var content = "<?php echo mb_substr(str_replace(array("\r\n", "\r", "\n"),'',strip_tags($data['description'])),0,40); ?>";
	var linkimgUrl = 'http://{$WEB_URL}/Public/img/sharelogo.png';
	var res_id = "{$data['id']}";
	var type = 1;
	share_weixin(appId, timestamp, nonceStr, signature, title, content, linkimgUrl,res_id,type);
</script>
</html>
