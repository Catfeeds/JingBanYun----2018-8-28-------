<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<link rel="stylesheet" href="__PUBLIC__/css/app/studentHomeworkElse.css?v=3">
		<link rel="stylesheet" href="__PUBLIC__/swiper/swiper-3.4.2.min.css" media="screen" title="no title" charset="utf-8">
		<script type="text/javascript" src="__PUBLIC__/js/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="__PUBLIC__/swiper/swiper-3.4.2.jquery.min.js"></script>
		<title></title>
		<style media="screen">
			*{
				margin: 0;
				padding: 0;
				-webkit-tap-highlight-color: rgba(0,0,0,0);
				-webkit-tap-highlight-color: transparent;
				-webkit-touch-callout:none;
				-webkit-user-select:none;
				-khtml-user-select:none;
				-moz-user-select:none;
				-ms-user-select:none;
				user-select:none;

			}
			html,body,.swiper-slide,.swiper-container{
				-webkit-tap-highlight-color: rgba(0,0,0,0);
			}

			.swiper-slide,.swiper-container{
				padding-bottom:20px;
			}

			body {
				background: #fff !important;
			}

			.p20{
				padding: 10px 20px
			}
			body{
				font-size: 18px;
				color: #333
			}
			.left{
				float: left;
			}
			.right{
				float: right
			}
			.yellow{
				color: #f2b718
			}
			.border-top{
				border-top: 5px solid #f4f4f4
			}
			.of{
				overflow: hidden;
			}
			.color999{
				color: #999
			}
			.audioDiv{
				width: 240px;
				overflow: hidden;
				margin: auto;
				margin: 5px auto;
			}
			.auidobtn{
				width: 60px;
				height: 60px;
				background: url(__PUBLIC__/img/Apphomework/labaquantu.png)no-repeat center;
				background-size: 60px 60px;
				margin-right:10px;
				min-height: 50px;
				margin-top: 75px
			}
			.auidobtn.active{
				background: url(__PUBLIC__/img/Apphomework/laba.gif)no-repeat center;
				background-size:60px 60px;
			}
			.audiotext{
				text-align: center;
				font-weight: bold;
				font-size: 24px;
				line-height: 36px;
				min-height:200px
			}
			.audio1btn{
				width:60px;
				height: 60px;
				margin-left:10px;
				background: url(__PUBLIC__/img/Apphomework/fang1.png)no-repeat center;
				background-size: 60px 60px;
				margin-top: 75px
			}
			.audio1btn.active{

				background: url(__PUBLIC__/img/Apphomework/fang2.png)no-repeat center;
				background-size: 60px 60px;
			}
			.fanyiIcon{
				background:#fff url(__PUBLIC__/img/Apphomework/xiajian.png)no-repeat 10px 6px ;
				padding-left: 30px;
				padding-right: 10px;
				display: inline-block;
				position: relative;
				top:10px;
				background-size: 16px 10px;
			}
			.fanyiIcon.active{
				background:#fff url(__PUBLIC__/img/Apphomework/shangjian.png)no-repeat  10px 6px;
				background-size: 16px 10px;
			}
			.fanyi{
				border-bottom: 1px solid #eee;
				margin: 5px 20px;
				text-align: center;

			}
			.text{
				padding: 0 20px;
				line-height: 28px;
				display: none
			}
			.text-center{
				text-align: center;
				line-height: 40px
			}
			a{
				text-decoration: none;
				color: #eee
			}
			.answeCard{
				padding: 0px 20px 0 10px;
				border: 1px solid  #f2b718;
				border-radius: 5px;
				background: url(__PUBLIC__/img/Apphomework/youjian1.png) no-repeat 68px 6px;
				background-size: 8px;
			}
			.lh26{
				line-height: 26px
			}
			.textName{
				margin-top: 10px
			}
			.voice{
				width: 100px;
				height: 135px;
				background: url(/Public/img/Apphomework/weiluyin.png) no-repeat 0 35px;

				background-size: 100px 100px;
			}
			.voice.active{
				background: url(__PUBLIC__/img/Apphomework/du.gif) no-repeat center;
				background-size: 100px 135px
			}
			.dn{
				visibility: hidden;
			}
			.mark{
				width: 100%;
				height: 100%;
				position: fixed;
				background: rgba(0, 0, 0, 0.3);
				top: 0;
				left: 0;
				z-index: 1;
					display: none
			}
			.mark img{
				width: 150px;
				position: absolute;
				top:0;
				left: 0;
				right: 0;
				bottom: 0;
				margin: auto;

			}
			[v-cloak] {
				display: none;
			}
			.loding img{
				width: 200px;
			}
			.loding{
				text-align: center;
				margin-top: 10px;
				height:25px
			}
			.swiper-button-next, .swiper-button-prev{
				width:auto;
				background: #f2b718;
				position: static;
				display: inline-block;
				margin-top: 0;
				height: auto;
				padding: 4px 10px;
				border: 1px solid #f2b718;
				color:#fff;
				border-radius: 7px;
				text-align: center;
			}
			.swiper-button-prev.swiper-button-disabled{
				opacity: 0.3
			}
			.next{
				width: 250px;
				margin: 20px auto 0
			}

			.successBox {
				background: url(__PUBLIC__/img/Apphomework/tanchuangwancheng.png) no-repeat center;
				background-size: 100% 100%;
			}

			.hintBox {
				background: url(__PUBLIC__/img/Apphomework/submitBox.png) no-repeat center;
				background-size: 100% 100%;
			}

			[v-cloak]{
				display: none;
			}

			#app {
				background: #f0f0f0;
				display: none;
			}
			@media screen and (min-height:500px) and (max-height:600px) {
				.audiotext{
					min-height: 100px;
					line-height: 28px
				}
			}
			.swiper-button-next.swiper-button-disabled{
				opacity: 1
			}
			@media screen and (min-width:600px){
				html,body{
					height: 100%
				}
			}
		</style>
	</head>
	<body>
	<div class="swiper-container" id="detailsDiv">
	    <div class="swiper-wrapper" id="exerciseDiv">
	        <div class="swiper-slide swiper-no-swiping"   v-for="(todo,$index) in exerciseData" v-cloak :id='todo.id'>
				<div class="p20 of">
					<p class="left lh26">
						<span class="yellow">{{todo.index}}</span>/{{todo.count}}
					</p>
					<p class="right answeCard" v-if="todo.score" id="answerCard">
						<a href="javascript:;" class="yellow">答题卡</a>
					</p>
				</div>


				<div class="border-top p20 ">
				 <div class="" v-if="todo.score">
						{{todo.exerciseName}}<span class="fen dn">{{todo.score}}</span>
					</div>
					<div class="" v-if="todo.point">
						{{todo.exerciseName}}<span class="dn">{{todo.point}}</span>
					</div>
					<div class="loding" v-if="todo.score">
						<!-- 倒计时：<span>3</span> -->
					</div>
					<div class="audiotext">
						<div class="textName">{{todo.name}}</div>
					</div>
					<div class="audioDiv">
						<div class="auidobtn left" onclick="play2(this,'.audio1btn')" v-if="todo.score">
							<audio v-bind:src="todo.url" v-bind:id="todo.id" >
							</audio>
						</div>
						<div class="auidobtn left" onclick="play2(this,'.audio1btn')" v-if="todo.point">
							<audio v-bind:src="todo.org_answer_url" v-bind:id="todo.id" >
							</audio>
						</div>
						<div class="voice left" ontouchstart="gtouchstart()" ontouchmove="gtouchmove(this)" ontouchend="gtouchend()" v-if="todo.score">

						</div>
						<div class="audio1btn right" onclick="play2(this,'.auidobtn')"  v-bind:class="{'dn':isShow}" v-if="todo.point">
							<audio v-bind:src="todo.url" v-bind:id="'student'+($index)" preload>
							</audio>
						</div>
						<div class="audio1btn right" onclick="play2(this,'.auidobtn')"  v-bind:class="{'dn':isShow}" v-if="todo.score">
							<audio  v-bind:id="'student'+($index)" preload>
							</audio>
						</div>
						<div class="text-center color999" v-if="todo.score">
							点击话筒 开始录音
						</div>
					</div>
					<div class="answerUrl" style="display:none">

					</div>
					<div class="studentPoint" style="display:none">

					</div>
				</div>
				<div class="fanyi" v-if='todo.exerciseName != "跟读-课文"'>
					<span class="fanyiIcon" onclick="toggle(this)">英文释义</span>
				</div>
				<div class="text" v-if='todo.exerciseName != "跟读-课文"'>
					<p>
						{{todo.translation}}
					</p>
				</div>
				<div class="p20 next">
					<div class="swiper-button-prev left">上一题</div>
					<div class="right" style="position:relative;display:inline-block;overflow:hidden">
						<div class="nextCard" style="display:none;width:100%;height:100%;position:absolute;top:0;left:0;z-index:5" onclick="nextDatika(this)">
						</div>
						<div class="swiper-button-next">下一题
						</div>
					</div>

				</div>
			</div>
	    </div>
	</div>

	<!-- 答题卡 -->
	<div id="app" v-cloak>
		<div class="cardTop">
			<div class="cardTitle">{{ homeworkName }}</div>
			<div class="cardNumBox">已作答&nbsp;&nbsp;<span class="cardNum">0</span>/<span class="totalNum">{{ total_e }}</span></div>
		</div>

		<div class="homeworkListTabContent">
			<div class="homeListCon homeListCon1">
				<div class="homeListConTitle">
					<img src="{$oss_path}public/web_img/APPHomework/huangseditu.png" alt="">
					<span>语音作业</span>
				</div>

				<div class="dimBox">
					<span class="dimCircle circleYes"></span>
					<span class="dimAnswer answerYes">已作答</span>
					<span class="dimCircle circleNo"></span>
					<span class="dimAnswer answerNo">未作答</span>
				</div>

				<div>
					<div class="parent_index homeCircleList" v-for="(ex,index) in exlist">
						<p class="homeCircleName">
							{{ ex.name }}({{ ex.data.length }}道题)
						</p>
						<ul class="homeCircleUl">
							<li class="homeCircleLi" v-for="(exchild,cindex) in ex.data">
								<a href="javascript:" class="qbtn">{{ cindex+1 }}</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="homeworkStart">
					<a href="javascript:;" class="btnTwo answerBtn" id="answerContinue">继续答题</a>
					<button type="button" class="btnTwo submitBtn" id="homeworkSubmit">提交作业</button>
				</div>
			</div>
		</div>
	</div>

	<div class="fullBack"></div>
	<!-- 提交作业成功 -->
	<div class="successBox" id="successNotify">
		<div class="sucTitle">提交作业成功！</div>
		<div class="sucMain">您是本班第<span class="ren"></span>个完成作业的同学</div>
		<a href="javascript:;" class="sucBtn" id="successSure">确定</a>
	</div>
	<!-- 提交作业提示 -->
	<div class="hintBox" id="submitNotify">
		<div class="hintMain">本次作业还有试题未作答，<br>确认交卷？</div>
		<button type="submit" class="hintBtn sureBtn" id="submitSure">确定</button>
		<div class="hintBtn" id="conSubBtn">继续答题</div>
	</div>
	<!-- 返回页面提示 -->
	<div class="hintBox" id="backNotify">
		<div class="hintMain">退出后您的答题结果将会被删除，<br>确认退出？</div>
		<a href="javascript:;" class="hintBtn sureBtn" id="backSure">确定</a>
		<div class="hintBtn" id="conBackBtn">继续答题</div>
	</div>


	<div class="mark">
		<img src="__PUBLIC__/img/Apphomework/yinpin.gif" alt="" />
	</div>
	<div class="" id="datika" >

	</div>

	<input type="hidden" id="subId" value="">
	<script>

	</script>
	<script type="text/javascript" src="__PUBLIC__/adminExercise/js/vue.js"></script>
	<script type="text/javascript" src="__PUBLIC__/adminExercise/js/vue-resource.min.js"></script>
	<script type="text/javascript">
	var flag = "{$flag}";
	var userId = "{$userId}";
	var role = "{$role}";
	var homeworkId = "{$homeworkId}";
	var classId = "{$classId}";
	var submitId = "{$submitId}";
	var dataurl;
	var answerList = new Array();
	var answerObj;
	var titleName;

		if(getQueryString('type') == '2'){
		var dataurl='/ApiInterface/Version1_2/HomeworkParent/getSubmitHomeworkDetail?userId={$userId}&role={$role}&id={$submitId}&isFlatten=2';

			 var show = false  //已完成
		}else{
		var dataurl='/ApiInterface/Version1_2/HomeworkParent/getHomeworkDetail?role={$role}&userId={$userId}&homeworkId={$homeworkId}&isFlatten=2';
		  var show = true //未完成
		}

		var flag = "{$flag}"

		var exercise = new Vue({
			el : '#exerciseDiv',
			 data:{
				 exerciseData:[],
				 exurl:dataurl,
				 isShow:show
			},

			created :function(){
				this.exercise();
			},
			methods:{
				exercise:function(){
				 	this.$http.get(this.exurl).then(function(response){
						if (response.data.data.data.length > 0) {
							this.exerciseData = response.data.data.data;
						}
						console.log(this.exerciseData);
					this.$nextTick(function(){
						if(getQueryString('isEnd') =='1'){
							$('#answerCard,.voice,.loding,.text-center').addClass('dn');
							$('.loding').html('')
						}
						var mySwiper = new Swiper ('.swiper-container',{
							initialSlide:flag,
							prevButton:'.swiper-button-prev',
							nextButton:'.swiper-button-next',
							onSlideChangeStart: function(swiper){
								$('.swiper-slide').find('.active').removeClass('active').find('audio').trigger('pause');
								$('.text').hide();
								clearInterval(timer123)
							},
							onSlideChangeEnd: function(swiper){
								$('.swiper-slide').find('.active').removeClass('active').find('audio').trigger('pause');
								$('.text').hide();
								clearInterval(timer123)
						    }
						});
						if(getQueryString('type') == '2' ||getQueryString('isEnd') == '1'){
							$('.swiper-button-next').eq($('.swiper-slide').length-1).css('opacity','0.3')
						}else {
							$('.swiper-button-next').eq($('.swiper-slide').length-1).siblings('.nextCard').show();
							$('.swiper-button-next').eq($('.swiper-slide').length-1).text('完 成').css('width','76px')
						}
						daojishi()
		            })
					},function(response){
				 })
				},
			},
		})


		function toggle(obj){
			if($(obj).parent().siblings('.text').is(":hidden")){
				$(obj).parent().siblings('.text').show();
				$(obj).addClass('active')
			}else {
				$(obj).parent().siblings('.text').hide();
				$(obj).removeClass('active')
			}
		}
		function play2(obj,parentSibling){
			var player = $(obj).find('audio')[0];
			if($(player).attr('src') == ''){
				alert('此题未提交语音作业')
				return false
			}
			if (player.paused){
				player.play();
					$(player).parent('div').addClass('active').siblings(parentSibling).removeClass('active').find('audio').trigger('pause').parents('.swiper-slide').siblings('div').find('.active').removeClass('active').find('audio').trigger('pause');
				player.loop = false;
				player.addEventListener('ended', function () {
					$(player).parent('div').removeClass('active')
				}, false);
			}else {
				player.pause();
				$(player).parent('div').removeClass('active')
			}
		}
		if(CheckIsAndroid()){
			window.alert = function(name){
				var iframe = document.createElement("IFRAME");
				iframe.style.display="none";
				iframe.setAttribute("src", 'data:text/plain,');
				document.documentElement.appendChild(iframe);
				window.frames[0].window.alert(name);
				iframe.parentNode.removeChild(iframe);
			};
		}
		var timeOutEvent=0;//定时器
		var timeOutEvent1 = 0;
		var t=0;
		//开始按
		function gtouchstart(){
			timeOutEvent1 = setInterval(function(){
				t++
			},100)
			timeOutEvent = setTimeout(function longPress(){
				timeOutEvent = 0;
				goUrl();
				$('body').find('.active').removeClass('active').find('audio').trigger('pause');
				$('.swiper-slide-active').find('.voice').addClass('active');


			},500);//这里设置定时器，定义长按500毫秒触发长按事件，时间可以自己改，个人感觉500毫秒非常合适
			return false;
		};
		//手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件
		function removeActive(){
			$('.swiper-slide-active').find('.voice').removeClass('active');
		}
		function gtouchend(){
			clearInterval(timeOutEvent1);
			clearTimeout(timeOutEvent);//清除定时器
			if(t<5){
				// alert('长按时间过短');

				var data = {
                   "page":"alert",
                   "message":'按键时间太短'
                }

                if (CheckIsIOS()){
					window.webkit.messageHandlers.iosModel.postMessage(data);
				}

                if (CheckIsAndroid()){
						AppFunction.showMessage(JSON.stringify(data))
				}
					t=0;


			}else {
				t =0
				endUrl();
				$('.swiper-slide-active').find('.voice').removeClass('active');


			}

			if(timeOutEvent!=0){
				//这里写要执行的内容（尤如onclick事件）
			}
		return false;
		};
		//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按
		function gtouchmove(obj){
			// cancleUrl()
			// clearTimeout(timeOutEvent);//清除定时器
			// timeOutEvent = 0;
			// $(obj).removeClass('active');
		};

		//真正长按后应该执行的内容
		function longPress(obj){
			timeOutEvent = 0;
			//执行长按要执行的内容，如弹出菜单

		}
		var timer123
		function daojishi(){

			var timer123 = setInterval(function(){
				var stime = parseInt($('.swiper-slide-active').find(".loding>span").html());
				if($('#app').css('display') == 'none') {
					stime--;
					$('.swiper-slide-active').find(".loding>span").html(stime);
					if(stime == 0){
						if($('.swiper-slide-active').find('.voice').hasClass('active')){
							$('.swiper-slide-active').find(".loding").html('');
						}else{
							$('.swiper-slide-active').find(".loding").html('');
							$('.swiper-slide-active').find('.auidobtn').click()
						}

					}
				} else {
					$('.swiper-slide-active').find(".loding").html('');
				}

			},1000);
		}
		function getQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
			var r = window.location.search.substr(1).match(reg);
			if (r != null) return unescape(r[2]); return null;
		}
		function CheckIsAndroid() {
			var browser = {
					versions: function () {
						var u = navigator.userAgent,
							app = navigator.appVersion;
						return { //移动终端浏览器版本信息
							ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
							android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
							iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
							iPad: u.indexOf('iPad') > -1, //是否iPad
						};
					}(),
				}
			if (browser.versions.android)
				return true;
			return false;
		}


		function CheckIsIOS() {
			var browser = {
				versions: function () {
					var u = navigator.userAgent,
						app = navigator.appVersion;
					return { //移动终端浏览器版本信息
						ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
						android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
						iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
						iPad: u.indexOf('iPad') > -1, //是否iPad
					};
				}(),
			}
			if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
				return true;
			}
		}
		function receiveData(data){
			var dataUrl = data.url;
			var dataScore = data.score;
			var studentPoint = data.score;
			var studentIndex = data.index;
			var index = $('.swiper-slide-active').index();
			if(dataUrl == '' || studentPoint == '') {
				alert('存储失败，请重新回答此题。')
			} else {
				if(studentIndex == undefined){
					$('.swiper-slide-active').find('.audio1btn').removeClass('dn').find('audio').attr('src',dataUrl);
					$('.swiper-slide-active').find('.answerUrl').text(dataUrl);
					$('.swiper-slide-active').find('.studentPoint').text(studentPoint);
					$('.homeCircleLi').eq(index).children('.qbtn').addClass('finishBtn')
				}else{
					$('.swiper-slide').eq(studentIndex).find('.audio1btn').removeClass('dn').find('audio').attr('src',dataUrl);
					$('.swiper-slide').eq(studentIndex).find('.answerUrl').text(dataUrl);
					$('.swiper-slide').eq(studentIndex).find('.studentPoint').text(studentPoint);
					$('.homeCircleLi').eq(studentIndex).children('.qbtn').addClass('finishBtn')
				}

			}
		}
    	function goUrl() {
			var htmlText = $('.swiper-slide-active').find('.textName').text();
			var htmlNumber = $('.swiper-slide-active').find('.fen').text();
			var index = $('.swiper-slide-active').index();
	        var data = {
				'text':htmlText,
				'number' :htmlNumber,
				'index':index
	        };
	        if (CheckIsIOS())
	            window.webkit.messageHandlers.iosStart.postMessage(data);
	        if (CheckIsAndroid())
            	AppFunction.androidStart(JSON.stringify(data));
    	}
		function endUrl() {
			var htmlText = $('.swiper-slide-active').find('.textName').text()
			var data = {
				'text':htmlText
			};
			if (CheckIsIOS())
				window.webkit.messageHandlers.iosFinish.postMessage(data);
			if (CheckIsAndroid())

				AppFunction.androidEnd();
		}
		function cancleUrl() {
			if (CheckIsIOS())
				window.webkit.messageHandlers.iosCancle.postMessage();
			if (CheckIsAndroid())
				AppFunction.androidCancle();
		}
		document.addEventListener('contextmenu', function(e){
			e.preventDefault();
		});
</script>

	<!--  答题卡-->
	<script>
	function CheckIsAndroid() {
			var browser = {
					versions: function () {
						var u = navigator.userAgent,
							app = navigator.appVersion;
						return { //移动终端浏览器版本信息
							ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
							android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
							iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
							iPad: u.indexOf('iPad') > -1, //是否iPad
						};
					}(),
				}
			if (browser.versions.android)
				return true;
			return false;
		}


		function CheckIsIOS() {
			var browser = {
				versions: function () {
					var u = navigator.userAgent,
						app = navigator.appVersion;
					return { //移动终端浏览器版本信息
						ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
						android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
						iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
						iPad: u.indexOf('iPad') > -1, //是否iPad
					};
				}(),
			}
			if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
				return true;
			}
		}



		$('.submitBtn').click(function(){
			$('.fullBack,.successBox').show();
			$('body').css('overflow-y','hidden')
		})
		$('.sucBtn').click(function(){
			$('.fullBack,.successBox').hide();
			$('body').css('overflow-y','auto')
		})
	</script>

	<script>
			var app = new Vue({
				el: '#app',
				data: {
					userId:0,
					role:0,
					homeworkId:0,
					classId:0,
					homeworkName:'',
					exlist:'',//习题列表
					total_e:0,

				},
				created: function () { //应用初始化完毕加载
					this.userId = userId;
					this.role = role;
					this.homeworkId = homeworkId;
					this.classId = classId;

					this.$http.post('/ApiInterface/Version1_2/HomeworkStudent/getHomeworkAbstract',{userId:userId,role:role,homeworkId:homeworkId},{emulateJSON:'application/x-www-form-urlencoded'}).then(function(response){ //发送http请求
						this.homeworkName = response.data.data.name;
						document.title = this.homeworkName;
						titleName = this.homeworkName;
					}, function(response){
						// 响应错误回调
						console.log('初始化作业信息错误');
					});

					this.$http.post('/ApiInterface/Version1_2/HomeworkStudent/getHomeworkDetail',{userId:userId,role:role,homeworkId:homeworkId,classId:classId,isFlatten:1},{emulateJSON:'application/x-www-form-urlencoded'}).then(function(response){ //发送http请求
						this.exlist = response.data.data.data;
						this.total_e = response.data.data.total;
						this.$nextTick(function(){
							$('.qbtn').click(function(){
								var ii =0;
								var a = 0;
								var c = 0;
								if($(this).parents('.parent_index').index() == 0){
									var ii = $(this).parent().index();
								}else{
									var a = $(this).parents('.parent_index').index();
									for(var b = 0;b<a;b++){
										c += $('.parent_index').eq(b).find('.homeCircleLi').length;
										ii = c
									}
									ii = ii + $(this).parent().index()
								}
								console.log(ii)
								$('#detailsDiv').show();//详情页面出现
								$('#app').hide();//答题卡页面隐藏
								var mySwiper = new Swiper ('.swiper-container',{
									initialSlide:ii,
									prevButton:'.swiper-button-prev',
									nextButton:'.swiper-button-next'
								});
								if(ii == 0) {
						            $('#exerciseDiv').css({
						            	'transform': 'translate3d(0px, 0px, 0px)',
						            	'-webkit-transform': 'translate3d(0px, 0px, 0px)',
						            	'-ms-transform': 'translate3d(0px, 0px, 0px)',
						            	'-o-transform': 'translate3d(0px, 0px, 0px)',
						            	'-moz-transform': 'translate3d(0px, 0px, 0px)'
					            	});//左移到0
								}
							})
							var winHeight = $(window).height();//屏幕的高度
						    var topHeight = 80;//“答题卡顶部”的高度
						    var minusHeight = winHeight*1 - topHeight*1 - 10;//相减的高度
						    $('.homeListCon').css('minHeight',minusHeight);//标签页的最小高度
						})
					}, function(response){
						// 响应错误回调
						console.log('初始化作业详情错误');
					});

				},
			})

		//点击答题卡
		$(document).on('click','#answerCard',function(){
			$('#detailsDiv').hide();//详情页面隐藏
			$('#app').show();//答题卡页面出现
			var finishLength = $('.finishBtn').length;
			$('.cardNum').text(finishLength);
			if(finishLength == $('.qbtn').length) {
				$('#answerContinue').text('重新答题')
			}
			$('body').find('.active').removeClass('active').find('audio').trigger('pause');//音频暂停
		})

		//点击答题卡中的“提交作业”
		$('#answerContinue').click(function(){
			$('#detailsDiv').show();//详情页面出现
			$('#app').hide();//答题卡页面隐藏
			var finishLength = $('.finishBtn').length;
			if(finishLength == $('.qbtn').length) {
				var mySwiper = new Swiper ('.swiper-container',{
					initialSlide:0,
					prevButton:'.swiper-button-prev',
					nextButton:'.swiper-button-next'
				});
				$('#exerciseDiv').css({
					'transform': 'translate3d(0px, 0px, 0px)',
	            	'-webkit-transform': 'translate3d(0px, 0px, 0px)',
	            	'-ms-transform': 'translate3d(0px, 0px, 0px)',
	            	'-o-transform': 'translate3d(0px, 0px, 0px)',
	            	'-moz-transform': 'translate3d(0px, 0px, 0px)'
				});//左移到0
			}
		})

		// 给APP一个方法，监听返回
		function backNotify(){
			$('.hintBox').hide();
			$('.fullBack,#backNotify').show();
			$('body').css('overflow-y','hidden')
		}

		$('#backSure').click(function(){
			// 给APP一个方法，监听返回弹窗中的“确定”
			if (CheckIsIOS()) {
				var data = {
	               "page":"exerciseDetails",
	            }
	            window.webkit.messageHandlers.iosModel.postMessage(data)
			}
	        if (CheckIsAndroid()) {
	            AppFunction.androidSurePop();
	        }
		})

		//点击返回弹窗中的“继续答题”，弹窗隐藏
		$('#conBackBtn').click(function(){
			$('.fullBack,#backNotify').hide();
			$('body').css('overflow-y','auto');
			$('#detailsDiv').show();//详情页面出现
			$('#app').hide();//答题卡页面隐藏
		})

		//点击提交弹窗中的“继续答题”，弹窗隐藏
		$('#conSubBtn').click(function(){
			$('.fullBack,#submitNotify').hide();
			$('body').css('overflow-y','auto');
			$('#detailsDiv').show();//详情页面出现
			$('#app').hide();//答题卡页面隐藏
		})

		//点击成功弹窗中的“确定”，跳转
		$('#successSure').click(function(){
			$('.fullBack,#successNotify').hide();
			$('body').css('overflow-y','auto')
			window.location.replace("/ApiInterface/Version1_2/StudentHomework/homeworkResult?isGo=1&userId={$userId}&role={$role}&id={$homeworkId}&classId={$classId}&submitId="+$('#subId').val()+"&name="+titleName)
		})

		// 提交
		function subHomework() {
			var answerList = [];
			$('.swiper-slide').each(function(){
				var answerId = $(this).attr("id");//本题的id
				var answerResult = $(this).find('.answerUrl').text();//本题的answer
				var answerScore = $(this).find('.studentPoint').text();//本题的score
				var answerTotalScore = $(this).find('.fen').text();//本题的总分
				// var answerNum = $('.totalNum').text();//题目的总数量
				// var answerScoreEnd = Math.round(answerScore/answerNum);//题目的最终得分
				answerObj = {"id": answerId, "answer": answerResult, "score": answerScore, "totalscore": answerTotalScore };
				answerList.push(answerObj)
			})


			$.ajax({
				url:'/ApiInterface/Version1_2/HomeworkStudent/submitHomework',
				type:'post',
				data:{
					'role': role,
					'userId': userId,
					'homeworkId': homeworkId,
					'classId': classId,
					'answerList': JSON.stringify(answerList)
				},
				dataType:'json',
				success:function (msg) {
		            if(msg.status == 200){
		            	$('.hintBox').hide();
		            	$('.fullBack,#successNotify').show();
		            	$('body').css('overflow-y','hidden')
		            	$('#subId').val(msg.data.id);
						$('.ren').text(msg.data.count)
		            } else {
		            	alert(msg.message);
		            	window.location.href = "/ApiInterface/Version1_2/StudentHomework/index?userId={$userId}&role={$role}"
		            }
		        }
			})

			$.ajax({
				url:'/ApiInterface/Version1_2/StudentHomework/sendMsgParent',
				type:'post',
				data:{
					'userId': userId,
					'homeworkId': homeworkId,
				},
				dataType:'json',
				success:function (msg) {

		        }
			})
		}


		$('#homeworkSubmit').click(function(event){
			event.stopPropagation();
			if(parseInt($('.cardNum').text()) < parseInt($('.totalNum').text())) {
				$('.fullBack,#submitNotify').show();
				$('body').css('overflow-y','hidden')
			} else {
				subHomework()
			}
		})

		$('#submitSure').click(function(){
			subHomework()
		})



		function nextDatika(obj){
			var alllength = $(obj).parents('.swiper-slide').index();
			if(alllength == $('.swiper-slide').length-1){
				$('#detailsDiv').hide();//详情页面隐藏
				$('#app').show();//答题卡页面出现
				var finishLength = $('.finishBtn').length;
				$('.cardNum').text(finishLength);
				if(finishLength == $('.qbtn').length) {
					$('#answerContinue').text('重新答题')
				}
				$('body').find('.active').removeClass('active').find('audio').trigger('pause');//音频暂停
			}
		}
	</script>

	</body>
</html>
