<layout name="admin_layout_back"/>
<link href="__PUBLIC_METRO__/css/app/table_list.css?v=4.0" type="text/css" rel="stylesheet">
<link href="__PUBLIC__/css/jquery.ui.datepicker.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/css/adminActivity.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/js/fine-uploader/fine-uploader-new.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css">
<script type="text/javascript" src="__PUBLIC__/new_ueditor/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/new_ueditor/ueditor/ueditor.all.js"></script>
<style media="screen">
.laydate_body .laydate_bottom, .laydate_body .laydate_top, .laydate_body .laydate_ym .laydate_yms {
  box-sizing: content-box;
}
.input_margin{
      margin: .325rem 0;
      margin-bottom: 10px
}
</style>
<div style="margin-bottom: 12px;">
    <a href="javascript:window.history.go(-1)" title="返回" class="button primary " style="box-sizing:border-box;">&lt; 返回</a>
</div>
<div class="titleBox">
	<p class="blueText fs18 underline1">
		资讯管理
		<span class="blueSpan">
			<a href="javascript:;">教学动态管理</a>>>
			<a href="javascript:;">添加教学动态</a>
		</span>
	</p>
	<div class="underline2"></div>
</div>
<form class="" action="{:U('Information/addTeachingInformation')}" method="post" onsubmit="return check()" enctype="multipart/form-data">
    <input type="hidden" name="cid" value="{$cid_add}">
    <input type="hidden" value="" name="vid" id="vid">
    <input type="hidden" value="" name="vid_file_path" id="vid_file_path">
    <input type="hidden" value="" name="playerwidth" id="playerwidth">
    <input type="hidden" value="" name="playerduration" id="playerduration">
    <input type="hidden" value="" name="vid_fullpath" id="vid_fullpath">
    <input type="hidden" value="" name="vid_image_path" id="vid_image_path">
    <input type="hidden" value="" name="is_transition" id="is_transition">
    <input type="hidden" value="" name="vid_fullsize" id="vid_fullsize">

  <div class="grid condensed cellBox">
    <div class="row cells2">
        <div class="cell">
            <label>动态来源：</label>
            <input type="text" name="urlname"  class="input-control stu_time_id w80 input-control-before "  value="" maxlength="16">
        </div>
      <div class="cell ">
          <label>动态标题：</label>
          <input type="text"  name="displaytxt" class="input-control stu_time_id input-control-before w376 " maxlength="60">
      </div>

      <div class="blueDashed upload" display="block">
            <div class="blueTitle">
                文件上传
            </div>

            <div class="sectionMain">
                <div class="newSection">
                    <span class="redStar">*</span>
                    <label for="">上传封面 <span>(PC端显示尺寸158*100)</span></label>
                    <input type="file" name="pc_cover" id="pcFile" accept=".jpg,.png">
                </div>

                <div class="newSection">
                    <span class="redStar">*</span>
                    <label for="">上传封面<span>(APP显示宽高比例为1:1)</span><span></span></label>
                    <input type="file" name="mobile_cover"  id="appFile" accept=".jpg,.png">
                </div>
            </div>
        </div>
        <div class="example" >
            <span class="exampl">资讯信息</span>
            <div style="width: 100%; margin: 10px 0">
        		<script type="text/plain" id="content" name="content" style="width:100%;height:340px;"></script>
        	</div>
        </div>

  </div>

  <div class="form-actions text-center">
      <button type="submit" class="button info" >保存</button>
  </div>
</div>
</form>
<script src="__PUBLIC__/laydate/laydate.js"></script>
<script>
    var ue = UE.getEditor('content', {
    wordCount: true,
    maximumWords:10000
});
</script>
<script>
    function notifyOnErrorInput(input) {
        var message = input.data('validateHint');
        $.Notify({
            caption: '提示',
            content: message,
            type: 'warning'
        });
    }
</script>
<script type="text/javascript">
!function(){
  laydate.skin('yalan');//切换皮肤，请查看skins下面皮肤库
}();
var actstart = {
  elem: '#activityStart',
  format: 'YYYY-MM-DD',
//		min: laydate.now(), //设定最小日期为当前日期
  max: '2099-06-16', //最大日期
  istime: true,
  istoday: false,
  choose: function(datas){
     actend.min = datas; //开始日选好后，重置结束日的最小日期
     actend.start = datas; //将结束日的初始值设定为开始日
//			 appstart.max = datas;
//			 append.max = datas;
  }
};

var actend = {
  elem: '#activityEnd',
  format: 'YYYY-MM-DD',
//		min: laydate.now(),
  max: '2099-06-16',
  istime: true,
  istoday: false,
  choose: function(datas){
    actstart.max = datas; //结束日选好后，充值开始日的最大日期
     appstart.max = datas;
     append.max = datas;
  }
};
laydate(actstart);
laydate(actend);
</script>
<script src="__PUBLIC__/js/notify/adminNotify.js" defer async="true"></script>
<script src="__PUBLIC__/js/fine-uploader/fine-uploader-v2beta.js" type="text/javascript"></script>
<script type="text/template" id="qq-template">
    <div class="qq-uploader-selector qq-uploader" qq-drop-area-text="Drop files here">
        <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
            <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
        </div>
        <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
            <span class="qq-upload-drop-area-text-selector"></span>
        </div>
        <div class="qq-upload-button-selector qq-upload-button">
            <div>上传文件</div>
        </div>
        <span class="qq-drop-processing-selector qq-drop-processing">
                <span>Processing dropped files...</span>
                <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
            </span>
        <ul class="qq-upload-list-selector qq-upload-list" aria-live="polite" aria-relevant="additions removals">
            <li>
                <div class="qq-progress-bar-container-selector">
                    <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
                </div>
                <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                <img class="qq-thumbnail-selector" qq-max-size="100" qq-server-scale>
                <span class="qq-upload-file-selector qq-upload-file"></span>
                <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
                <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
                <span class="qq-upload-size-selector qq-upload-size"></span>
                <button type="button" class="qq-btn qq-upload-cancel-selector qq-upload-cancel">Cancel</button>
                <button type="button" class="qq-btn qq-upload-retry-selector qq-upload-retry">Retry</button>

                <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
            </li>
        </ul>

        <dialog class="qq-alert-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">Close</button>
            </div>
        </dialog>

        <dialog class="qq-confirm-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">No</button>
                <button type="button" class="qq-ok-button-selector">Yes</button>
            </div>
        </dialog>

        <dialog class="qq-prompt-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <input type="text">
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">Cancel</button>
                <button type="button" class="qq-ok-button-selector">Ok</button>
            </div>
        </dialog>
    </div>
</script>

<script>
    function Trim(str)
    {
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }

    function check() {

        var urlname = $("input[name='urlname']").val();
        var displaytxt = $("input[name='displaytxt']").val();

        var pc_cover_val = $("input[name='pc_cover']").val();
        var mobile_cover_val = $("input[name='mobile_cover']").val();
        var content = $('#content').text();
        urlname = Trim(urlname);
        displaytxt = Trim(displaytxt);
        content = Trim(content);

        if (urlname == null || urlname == undefined || urlname == '') {
            $.NotifyBox.NotifyPromptOne("提示","请填写新闻来源", "确定");
            return false;
        }

        if (displaytxt == null || displaytxt == undefined || displaytxt == '') {
            $.NotifyBox.NotifyPromptOne("提示","请填写新闻标题", "确定");
            return false;
        }

        if (urlname.length > 16) {
            $.NotifyBox.NotifyPromptOne("提示","新闻来源文字过长", "确定");
            return false;
        }


        if (displaytxt.length > 60) {
            $.NotifyBox.NotifyPromptOne("提示","新闻标题文字过长", "确定");
            return false;
        }

        if (content == null || content == undefined || content == '') {
            $.NotifyBox.NotifyPromptOne("提示","内容没有文本", "确定");
            //return false;
        }

        if (pc_cover_val == null || pc_cover_val == undefined || pc_cover_val == '') {
            $.NotifyBox.NotifyPromptOne("提示","请上传PC封面", "确定");
            return false;
        }
        if (mobile_cover_val == null || mobile_cover_val == undefined || mobile_cover_val == '') {
            $.NotifyBox.NotifyPromptOne("提示","请上传APP封面", "确定");
            return false;
        }

        return true;
    }
    var uploadInfo = {};
</script>
<script>
    var uploader = new qq.FineUploader({
        debug: false,
        element: document.getElementById('fine-uploader'),
        request1Enable : true,
        multiple: false,
        request1: {
            endpointnum :1,
            endpoint: 'http://v.polyv.net/uc/services/rest?method=uploadfile',
            params:{'writetoken':'9c538d85-340c-466c-9e35-bb301734eb0d','JSONRPC':'{"title": "这里是标题", "tag": "标签", "desc": "视频文档描述"}'},
            fileFilter:Array("mov","mp4","mp3",'wmv','avi','flv'),
            inputName:'Filedata',
        },
        request: {
            endpointnum: 0,
            endpoint: '/index.php?m=Admin&c=Jbresources&a=upload_file',
            params:{},
            inputName:'file[]',
        },
        fileFilter:[".jpg",".png"],
        imageRatio:[2.26,2.27],
        deleteFile: {
            enabled: true,
            endpoint: '/uploads'
        },
        retry: {
            enableAuto: true
        },
        onCancel: function(id){
            delete uploadInfo[id];
        },
        responseCallBack: function(id,specNum,xhr){
            uploadInfo={};
            var result;
            try{
                result = JSON.parse(xhr.responseText);
            }
            catch(e){
                alert('上传失败!错误原因'+e);
                return false;
            }
            if(specNum == 0){
                if(result.code == 0){
                    if(typeof(uploadInfo[id])== 'undefined'){
                        uploadInfo[id] = {};
                    }
                    uploadInfo[id]['vid_file_path'] = result.res;
                    uploadInfo[id]['vid_image_path'] = result.message_video_image;     //这里是视频截图,如果不是视频这里就是空
                    uploadInfo[id]['is_transition'] = result.is_transition;            //这里是视频转换状态。
                    return true;
                }else{
                    alert(result.msg);
                }
            }else if(specNum == 1){
                if(result.error == 0){
                    //alert("上传成功!VID:"+result.data[0].vid);
                    //TODO: add result.res to XXX
                    if(typeof(uploadInfo[id])== 'undefined')
                    {
                        uploadInfo[id] = {};
                    }
                    uploadInfo[id]['vid_fullsize'] = result.data[0].source_filesize;
                    uploadInfo[id]['vid'] = result.data[0].vid;
                    uploadInfo[id]['playerwidth'] = result.data[0].playerwidth + '*' +result.data[0].playerheight;
                    uploadInfo[id]['duration'] = result.data[0].duration;
                    uploadInfo[id]['vid_fullpath'] = result.data[0].mp4;
                    return true;
                }else{
                    alert("上传失败!错误码:"+result.error);
                }
            }
            return false;
        }
    });

</script>

