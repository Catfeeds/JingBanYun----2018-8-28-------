<layout name="teacher_layout_2"/>
<link href="__PUBLIC__/css/activity.css" type="text/css" rel="stylesheet">

<style>
	.worksConMain {
		margin: 0 0 0 260px
	}
	
	.authorRemarks {
		margin-top: 94px
	}
	
	.worksContent {
		position: relative
	}
	
	.authorImg {
		position: absolute;
		right: 10px;
		top: -65px;
		cursor: pointer
	}
	
	.worksConRight {
		display: none;
		position: relative
	}
	
	.packUp {
		width: 40px;
		position: absolute;
		bottom: 10px;
		left: 0;
		right: 0;
		margin: auto;
		text-align: center;
		color: #999;
		cursor: pointer
	}
</style>

<div>
    <a href="{:U('Teach/activities')}" title="返回" class="btn btnReturn2">返回</a>
</div>

<div class="worksTitle">
	 我是标题我是标题
</div>

<div class="worksContent">
	<img src="__PUBLIC__/img/activity/authorRemarks.png" alt="" class="authorImg">
	<div class="left worksConLeft">
		<div class="worksConTop">
			<p>
				学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;科： 
				<if condition="$data['course_id']==-1">
					全学科
					<else /> {$data.course_name}英语
				</if>
			</p>
			<p>
				年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;级：
				<if condition="$data['grade_id']==-1">
					小学全年级
					<elseif condition="$data['grade_id']==-2" /> 初中全年级
					<elseif condition="$data['grade_id']==-3" /> 高中全年级
					<else /> {$data.grade}一年级
				</if>
			</p>
			<p>
				作品描述：<br>{$data.description}我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖
			</p>
		</div>
		<div class="worksConBo">
			<p class="worksConBoTitle">附件：<span>点击可在线观看</span></p>
			<ul class="accessoryUl">
				<li class="accessoryLi">
					<a href="javascript:;" class="left accessoryName browse_resource">
						田小胖田小胖田小胖田小胖田小胖田小胖田小胖田小胖田小胖田小胖田小胖.png
					</a>
					<a href="javascript:;" class="right accessoryDown" title="下载此附件">
						<img src="__PUBLIC__/img/activity/worksDown.png" alt="">
						下载
					</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="right worksConRight">
		<p class="authorRemarks">
			我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖我是田小胖
		</p>
		<p class="packUp">
			<img src="__PUBLIC__/img/activity/packUp.png" alt="">
			收起
		</p>
	</div>
	<div class="worksConMain" id='mediafile'>
		<div class="example" data-text="资源内容">
            <div class="listview set-border">
                <div class='padding50'>
                    <switch name="data.type">
                        <case value="pdf|word|ppt">
                            <!--<a style="float: right;ma
                            
                            
                            rgin-bottom: 4px;" target="_blank" href="__PUBLIC__/pdfjs/viewer/viewer.html?f={$data.file_path}" class="btn btn-default">在新窗口打开</a>-->
                            <iframe id="resourceFrame" frameborder="0" src="__PUBLIC__/pdfjs/viewer/viewer.html?f={$oss_path}<?php
                        if($data['type'] == 'word' ||$data['type'] == 'ppt')
                        {
                        $path = explode('.',basename($contact_data[0]['resource_path']));
                        $path=$path[0].'.pdf'; 
						$path = 'teacher/' .$data['id'].'/'.$contact_data[0]['id'] .'/' .$path;
                        echo $path;
                        }
                        else
                        echo $contact_data[0]['resource_path'];
                        ?>" width="100%" height="500">
                            </iframe>
                        </case>
                        <case value="image">
                            <div class="browse_image">
                                <img src="{$oss_path}{$data.file_path}" />
                            </div>
                        </case>
                        <case value="swf">
                            <div id="flash" class="browse_swf">
                                <object id="flashPlayer" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="500" height="500" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" id="swf">
                                    <embed id="sfw_src" width="500" height="500" name="plugin" src="{$oss_path}{$data.file_path}" type="application/x-shockwave-flash">
                                    <param name="loop" value="false">
                                    <param name="movie" value="">
                                </object>
                            </div>
                        </case>
                        <case value="video">
                            <div id='plv'></div>
                            <script>
                                var player = polyvObject('#plv').videoPlayer({
                                    'vid': '{$data.vid}'
                                });
                            </script>
                        </case>
                        <case value="audio">
                            <div id='plv'></div>
                            <script>
                                var player = polyvObject('#plv').videoPlayer({
                                    'vid': '{$data.vid}'
                                });
                            </script>
                        </case>
                        <default/>
                    </switch>
                </div>
            </div>
        </div>
	</div>
</div>

<!--弹窗-->
<div class="fullscr"></div>
<!--游客弹窗-->
<div class="toolTipBox prompt_ppt" id="prompt_ppt">
	<p class="toolTipButton">
		<a href="javascript:;" class="toolTipBtn toolTipBtnGreen1" id="">确定</a>
	</p>
</div>

<script type="text/javascript" src="__PUBLIC__/js/queryLimit.js"></script>

<!--点赞/收藏-->
<script>
    var oss_path = "<?php echo C('oss_path') ;?>";
    var zanCount = 0;
    var favorCount = 0;
    var swfVideoPlay = '<button id="fullScreen">全屏</button><object id="flashPlayer" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="500" height="500" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" id="swf">\n\
                        <param name="allowFullScreen" value="true"/><embed id="ebd" width="{1}" height="{2}" name="plugin" src="{0}" type="application/x-shockwave-flash"><param name="loop" value="false"><param name="movie" value="images/zf03320.swf"></object>';
 
	
    $(function () {
        var type = "{$data.type}"; 
        $(".browse_resource").click(function () {
            switch (type) {
            case 'video':
            case 'audio':
                var vid = $(this).attr('attr_id');
                var player = polyvObject('#plv').videoPlayer({
                    'vid': vid
                });
                break;
            case 'image':
                var file_path = $(this).attr('attr_path');  
                $(".browse_image").children('img').attr('src', file_path);
                break;
            case 'swf':
                var file_path = $(this).attr('attr_path');
                var videoEle = swfVideoPlay.format(file_path, 500, 500);
                $('.padding50').html(videoEle);
				$('#fullScreen').click(function(){      
				 if($('#fullScreen').text() == '全屏')
				  {
                    $('#ebd').attr('width',document.body.clientWidth);
                    $('#ebd').attr('height',$(window).height());
				    $('#mediafile').attr('style','position:fixed;left:0px;top:0px;z-index=9999');
				    $('#fullScreen').attr('style','z-index:10000');
				    $('.header,.cloud1,.cloud_left,.cloud_right,.topbar,.fullscreen_ctrl,.nav,#slide_title').hide();
					$('#fullScreen').text('返回');
				  }
				  else
				  {
				    $('#ebd').attr('width',500);
                    $('#ebd').attr('height',500);
				    $('#mediafile').attr('style','');
					if(!store.get('fullscreen'))
					$('.header,.cloud1,.cloud_left,.cloud_right,.topbar,#fullscreen_ctrl').show();
					else
					$('#escfullscreen_ctrl').show();
					$('.nav,#slide_title').show();
					$('#fullScreen').text('全屏');
				  }
                });
                break;
            case 'pdf':
            case 'word':
            case 'ppt':
                var file_path = $(this).attr('attr_path');
                $("#resourceFrame").attr('src', "__PUBLIC__/pdfjs/viewer/viewer.html?f=" + file_path);
                break;
            }
        });


var o_status="{$operation_status}";
var zan= "{$data.zan_count}";
var favor= "{$data.favorite_count}";
		
        $('#zanIcon').click(function () {    
            if(o_status==1){
                $.notify({
                    title: '提示',
                    message: '不能对自己发布的资源进行操作'
                }, {
                    type: 'success',
                    placement: {
                        from: "top",
                        align: "center"
                    }
                });
                return false;
            }
            if (!canQuery()) {
                $.notify({
                    title: '提示',
                    message: '请求过于频繁'
                }, {
                    type: 'success',
                    placement: {
                        from: "top",
                        align: "center"
                    }
                });
                return false;
            }

            $.get('__URL__/zanActivity', { id: '{$data.id}'}, function (res) {
                if (res == 'success') {
					zan++;
					$('#zanIcon').children('span').html(zan);
                    $('#zanIcon').children('img').attr('src', '__PUBLIC__/img/icon/zaned.png');
                    $.notify({
                        title: '提示',
                        message: '点赞成功'
                    }, {
                        type: 'success',
                        placement: {
                            from: "top",
                            align: "center"
                        }
                    });
                } else {
					zan--;
					$('#zanIcon').children('span').html(zan);
                    $('#zanIcon').children('img').attr('src', '__PUBLIC__/img/icon/zan.png');
                    $.notify({
                        title: '提示',
                        message: res
                    }, {
                        type: 'warning',
                        placement: {
                            from: "top",
                            align: "center"
                        }
                    });
                }
            });
        });

        $('#favorIcon').click(function () {
            if(o_status==1){
                $.notify({
                    title: '提示',
                    message: '不能对自己发布的资源进行操作'
                }, {
                    type: 'success',
                    placement: {
                        from: "top",
                        align: "center"
                    }
                });
                return false;
            }
            if (!canQuery()) {
                $.notify({
                    title: '提示',
                    message: '请求过于频繁'
                }, {
                    type: 'success',
                    placement: {
                        from: "top",
                        align: "center"
                    }
                });
                return false;
            }

            $.get('__URL__/favorActivity',  {id: '{$data.id}'}, function (res) {
                if (res == 'success') {
					favor++;
					$('#favorIcon').children('span').html(favor);
                    $('#favorIcon').attr('src', '__PUBLIC__/img/icon/favored.png');
                    $.notify({
                        title: '提示',
                        message: '收藏成功'
                    }, {
                        type: 'success',
                        placement: {
                            from: "top",
                            align: "center"
                        }
                    });
                } else {
					favor--;
					$('#favorIcon').children('span').html(favor);
                    $('#favorIcon').attr('src', '__PUBLIC__/img/icon/favor.png');
                    $.notify({
                        title: '提示',
                        message: res
                    }, {
                        type: 'warning',
                        placement: {
                            from: "top",
                            align: "center"
                        }
                    });
                }
            });
        })
        try{
			$('.browse_resource')[0].click();
		}catch(e){;} 
    });
</script>

<!--作者寄语为空时-->
<script>
	var aut = $.trim($('.authorRemarks').html());
	if(aut == ''){
		$('.authorRemarks').html('作者没有写寄语哦！').css('color','#999')
	}
</script>

<!--如果点击ppt，出现提示框-->
<script>
	$('').click(function(){
		$('.fullscr,#prompt_ppt').show();
	})
	
	$('.toolTipBtnGreen1').click(function(){
		$('.fullscr,#prompt_ppt').hide();
	})
</script>

<script>
	$('.authorImg').click(function(){
		$('.worksConRight').slideDown()
	})
	$('.packUp').click(function(){
		$('.worksConRight').slideUp()
	})
</script>

