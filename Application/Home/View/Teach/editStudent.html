<layout name="teacher_layout_3" />
<link href="__PUBLIC__/css/rotate.css" type="text/css" rel="stylesheet">
<link rel="stylesheet" href="__PUBLIC__/css/external/jquery-ui-1.10.4.min.css">
<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<link href="__PUBLIC__/cropperUpload/head/cropper.min.css" rel="stylesheet">
<link href="__PUBLIC__/cropperUpload/head/sitelogo.css" rel="stylesheet">
<script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
<script src="__PUBLIC__/cropperUpload/head/cropper.js"></script>
<script src="__PUBLIC__/cropperUpload/head/sitelogo.js"></script>

<style>
    #addChildren {
        width: 30%;
        float: left;
    }
    
    #addChildren .form-control {
        display: inline;
        width: 75%;
    }
    
    #addChildren label {
        width: 20%;
        text-align: right;
    }
    
    #addChildren .form-actions {
        width: 100%;
        background: #fff;
        text-align: right;
    }
    
    #addChildren .form_section {
        margin: 10px 0;
    }
    
    .exist {
        z-index: 1002;
        display: none;
        width: 400px;
        height: 300px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;       
		 margin: auto  auto;
		 background: url(/Public/img/home/30.png) no-repeat center;
        background-size: 100% 100%;
    }
    
    .exist p {
        width: 100%;
        text-align: center;
        font-size: 26px;
        color: #666;
    }
    
    .exist p:nth-child(1) {
        margin-top: 80px;
    }
    
    .exist p:nth-child(2) {
        margin-top: 30px;
    }
    
    .exist button {
        width: 80px;
        height: 40px;
        border: none;
        background: url(__PUBLIC__/img/home/15.png) no-repeat left top;
        background-size: 100% 100%;
        color: #fff;
        font-size: 20px;
        margin: 10px 5px;
    }
    
    #bg {
        z-index: 1001;
        display: none;
        position: fixed;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index: 1001;
        -moz-opacity: 0.7;
        opacity: .70;
        filter: alpha(opacity=70);
    }
    
    #show {
        display: none;
        position: absolute;
        top: 25%;
        left: 22%;
        width: 53%;
        height: 55%;
        padding: 8px;
        border: 8px solid #E8E9F7;
        background-color: white;
        z-index: 1002;
        overflow: auto;
    }
    /*================选择学校=======================*/
    
    .show_top {
        width: 100%;
        height: 80%;
    }
    
    .show_bottom {
        width: 100%;
        height: 20%;
    }
    
    .school_select {
        float: left;
        margin-right: 10px;
    }
    
    .school_select select {
        background-color: #DCE7EB;
        border: none;
        margin: 0 auto;
    }
    
    #queding {
        display: block;
        margin: 0 auto;
        width: 96px;
        height: 30px;
        background: url(__PUBLIC__/img/home/15.png) no-repeat left top;
        background-size: 100% 100%;
        color: #fff;
        font: 18px/30px "微软雅黑";
        text-align: center;
        text-decoration: none;
    }
    
    .close_btn {
        position: absolute;
        top: 0;
        right: 1px;
        cursor: pointer;
    }
    
    .close_btn img {
        width: 20px;
    }
    
    .ui-datepicker-trigger {
        width: 20px;
        display: inline;
        cursor: pointer;
        margin-left: 6px;
		height: 20px;
    }
</style>
<div style="margin-bottom: 12px;">
    <a href="{:U('Teach/classStudentMgmt')}&classId={$classId}" title="返回" class="btn btnReturn3">返回</a>
</div>
<div id="addChildren">
    <form id="mainForm" action="{:U('Teach/editStudent')}<?php if($data['id'] != null) echo '&id='.$data['id']; ?>" method="post" onsubmit="$('#saveButton').attr('disabled',true);">

        <div class="example" data-text="基本信息">
            <div class="form_section">
                <label for="student_name">姓名</label>
                <input type="text" name="student_name" id="student_name" class="form-control" placeholder="必填" autocomplete="off" value="{$data.student_name}" maxlength="20" required>
            </div>
            <div class="form_section">
                <label for="">性别</label>
                <label for="man" style="font-weight:normal;">
                    <input name="sex" type="radio" id="man" value="男" <?php if($data[ 'sex']=='男' ) echo 'checked' ?> >男</label>
                <img style="width:7%; display:inline;" src="/Public/img/man.png">
                <label for="woman" style="font-weight:normal;">
                    <input name="sex" type="radio" id="woman" value="女" <?php if($data[ 'sex']=='女' ) echo 'checked' ?> >女</label>
                <img style="width:6%; display:inline;" src="/Public/img/woman.png">
            </div>
            <div class="form_section">
                <label for="">出生年月</label>
                <input style="width:68%" type="text" name="birthday" id="datepicker" placeholder="必填" class="form-control" autocomplete="off" required value="{$data.birth_date}">
            </div>
            <div class="form_section">
                <label for="">邮箱</label>
                <input type="text" name="email" id="email" class="form-control" placeholder="选填" autocomplete="off" value="{$data.email}">
            </div>
            <div class="form_section">
                <label for="student_id">学生编号</label>
                <input type="text" name="student_id" id="student_id" class="form-control" value="{$data.student_id}" placeholder="选填" autocomplete="off" maxlength="20" value="{$data.student_id}">
            </div>
            <div class="form_section">
                <label for="student_id">身份证号</label>
                <input type="text" name="id_card" id="id_card" class="form-control" value="{$data.id_card}" placeholder="选填" autocomplete="off" maxlength="18">
                <div id="prompt2" style="color:#ff0000;"></div>
            </div>
            <div class="form_section">
                <label for="telephone">家长手机号</label>
                <input type="text" name="telephone" id="telephone" class="form-control" placeholder="必填" value="{$data.parent_tel}" autocomplete="off" maxlength="11" required>
            </div>
        </div>
        <div class="form-actions">
            <input type="hidden" class="os_upload_src" name="os_avatar">
            <button type="submit" class="btn btn-primary" id="saveButton" onclick="return check();">确定</button>
        </div>
    </form>
</div>
<?php if (preg_match('/Resources/', $data['avatar'])): ?>
    <input type="hidden" class="oss_path_img" value=<?=C('oss_path').$data['avatar']?> >
<?php endif ?>
<!----------更改头像-------------->
<div id="mycontent" style="width:60%;float:right;">
    <h3>更换头像：</h3>
    <div id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1" style="width: 800px;">
		<div>
			<div>
				<!--<form class="avatar-form" action="upload-logo.php" enctype="multipart/form-data" method="post">-->
				<form class="avatar-form" action="/index.php/Home/Student/ossUploadAvatar?id={$student.id}" method="post">
					<div class="modal-body">
						<div class="avatar-body">
							<div class="avatar-upload">
								<input class="avatar-src" name="avatar_src" type="hidden">
								<input class="avatar-data" name="avatar_data" type="hidden">
								<label for="avatarInput" style="line-height: 35px;">图片上传</label>
								<button class="btn btn-danger"  type="button" style="height: 35px;" onclick="$('input[id=avatarInput]').click();">请选择图片</button>
								<span id="avatar-name"></span>
								<input class="avatar-input hide" id="avatarInput" name="file" type="file"></div>
							<div class="row">
								<div class="col-md-8">
									<div class="avatar-wrapper"></div>
								</div>
								<div class="col-md-1">&nbsp;</div>
								<div class="col-md-3">
									<div class="avatar-preview preview-lg" id="imageHead"></div>
									<!--<div class="avatar-preview preview-md"></div>
							<div class="avatar-preview preview-sm"></div>-->
								</div>
							</div>
							<div class="row avatar-btns">
								<div class="col-md-4">
									<div class="btn-group">
										<button class="btn btn-danger fa fa-undo" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"> 向左旋转</button>
									</div>
									<div class="btn-group">
										<button class="btn  btn-danger fa fa-repeat" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"> 向右旋转</button>
									</div>
								</div>
								<div class="col-md-5" style="text-align: right;">								
<!--
									<button class="btn btn-danger fa fa-arrows" data-method="setDragMode" data-option="move" type="button" title="移动">
									<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;setDragMode&quot;, &quot;move&quot;)">
									</span>
								  </button>
-->
								  <button type="button" class="btn btn-danger fa fa-search-plus" data-method="zoom" data-option="0.1" title="放大图片">
									<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, 0.1)">
									  <!--<span class="fa fa-search-plus"></span>-->
									</span>
								  </button>
								  <button type="button" class="btn btn-danger fa fa-search-minus" data-method="zoom" data-option="-0.1" title="缩小图片">
									<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, -0.1)">
									  <!--<span class="fa fa-search-minus"></span>-->
									</span>
								  </button>
								  <button type="button" class="btn btn-danger fa fa-refresh" data-method="reset" title="重置图片">
										<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;reset&quot;)" aria-describedby="tooltip866214">
								   </button>
								</div>
								<div class="col-md-3">
									<button class="btn btn-danger btn-block avatar-save fa fa-save" type="button" data-dismiss="modal" style="display:none"> 保存修改</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	
</div>

<!-----------弹出框------------>
<div class="exist">
    <p id="errormsg">该学生已存在</p>
    <p>
        <button onclick="closeModal()">确定</button>
    </p>
</div>

<!--------------选择学校-------------->
<div id="bg"></div>
<div id="show">
    <div class="show_top">
        <div id="province" class="school_select">
            <select name="" id="pro_select">
                <option value="">请选择省市区</option>
            </select>
        </div>
        <div id="city" class="school_select">
            <select name="" id="city_select">
                <option value="">请选择市区</option>
            </select>
        </div>
        <div id="country" class="school_select">
            <select name="" id="coun_select">
                <option value="">请选择区县</option>
            </select>
        </div>
        <div id="school" class="school_select">
            <select name="" id="sch_select">
                <option value="">请选择学校</option>
            </select>
        </div>
        <div class="close_btn">
            <img src="__ROOT__/Uploads/Avatars/close.png" alt="">
        </div>
    </div>
    <div class="show_bottom">
        <a id="queding" href="javascript:;">确定</a>
    </div>
</div>

<script src="__PUBLIC__/js/DistrictQuery.js" type="text/javascript"></script>
<!--<script src="__PUBLIC__/js/external/jquery.form.js"></script>-->
<script src="__PUBLIC__/js/jquery.form.js"></script>
<script src="__PUBLIC__/js/external/xiuxiu.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/notify/notifyBox.js"></script>

<script src="__PUBLIC__/cropperUpload/head/html2canvas.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
//做个下简易的验证  大小 格式 
	$('#avatarInput').on('change', function(e) {
		var filemaxsize = 1024 * 5;//5M
		var target = $(e.target);
		var Size = target[0].files[0].size / 1024;
		if(Size > filemaxsize) {
			alert('图片过大，请重新选择!');
			$(".avatar-wrapper").childre().remove;
			return false;
		}
		if(!this.files[0].type.match(/image.*/)) {
			alert('请选择正确的图片!')
		} else {
			var filename = document.querySelector("#avatar-name");
			var texts = document.querySelector("#avatarInput").value;
			var teststr = texts; //你这里的路径写错了
			testend = teststr.match(/[^\\]+\.[^\(]+/i); //直接完整文件名的
			filename.innerHTML = testend;
		}

	});

	$(".avatar-save").on("click", function() {
		var img_lg = document.getElementById('imageHead');
		// 截图小的显示框内的内容
		html2canvas(img_lg, {
			allowTaint: true,
			taintTest: false,
			onrendered: function(canvas) {
				canvas.id = "mycanvas";
				var imgUri = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
				//生成base64图片数据
				var dataUrl = canvas.toDataURL("image/jpeg");
				var newImg = document.createElement("img");
				newImg.src = dataUrl;
				imagesAjax(dataUrl);
			}
		});
	})

	var a ;
	function imagesAjax(src) {
		var data = {};
		data.img = src;
		var orginUrl = window.location.protocol + '//' + window.location.host;
		data.jid = $('#jid').val();
		$.ajax({
			url: orginUrl +"/index.php/Home/Student/ossUploadAvatar?id={$data.id}",
			data: data,
			type: "POST",
			dataType: 'json',
			success: function(re) {
				if(re.status == '1') {
					$.NotifyBox.NotifyPromptOne("提示","学生编辑成功！", "确定",30000);
					$('.user_pic img').attr('src',src );
					$('.navListImg').attr('src', src);
				}
			}
		});
	}
</script>
<script>
    var vcity = {
        11: "北京",
        12: "天津",
        13: "河北",
        14: "山西",
        15: "内蒙古",
        21: "辽宁",
        22: "吉林",
        23: "黑龙江",
        31: "上海",
        32: "江苏",
        33: "浙江",
        34: "安徽",
        35: "福建",
        36: "江西",
        37: "山东",
        41: "河南",
        42: "湖北",
        43: "湖南",
        44: "广东",
        45: "广西",
        46: "海南",
        50: "重庆",
        51: "四川",
        52: "贵州",
        53: "云南",
        54: "西藏",
        61: "陕西",
        62: "甘肃",
        63: "青海",
        64: "宁夏",
        65: "新疆",
        71: "台湾",
        81: "香港",
        82: "澳门",
        91: "国外"
    };

    var checkCard = function () {
        var card = document.getElementById('id_card').value;
        //是否为空
        if (card === '') {
            return true;
        }
        //校验长度，类型
        if (isCardNo(card) === false) {
            alert('您输入的身份证号码不正确，请重新输入');
            document.getElementById('id_card').focus;
            return false;
        }
        //检查省份
        if (checkProvince(card) === false) {
            alert('您输入的身份证号码不正确,请重新输入');
            document.getElementById('id_card').focus;
            return false;
        }
        //校验生日
        if (checkBirthday(card) === false) {
            alert('您输入的身份证号码生日不正确,请重新输入');
            document.getElementById('id_card').focus();
            return false;
        }
        //检验位的检测
        if (checkParity(card) === false) {
            alert('您的身份证校验位不正确,请重新输入');
            document.getElementById('id_card').focus();
            return false;
        }
        return true;
    };


    //检查号码是否符合规范，包括长度，类型
    isCardNo = function (card) {
        //身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X
        var reg = /(^\d{15}$)|(^\d{17}(\d|X)$)/;
        if (reg.test(card) === false) {
            return false;
        }

        return true;
    };

    //取身份证前两位,校验省份
    checkProvince = function (card) {
        var province = card.substr(0, 2);
        if (vcity[province] == undefined) {
            return false;
        }
        return true;
    };

    //检查生日是否正确
    checkBirthday = function (card) {
        var len = card.length;
        //身份证15位时，次序为省（3位）市（3位）年（2位）月（2位）日（2位）校验位（3位），皆为数字
        if (len == '15') {
            var re_fifteen = /^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;
            var arr_data = card.match(re_fifteen);
            var year = arr_data[2];
            var month = arr_data[3];
            var day = arr_data[4];
            var birthday = new Date('19' + year + '/' + month + '/' + day);
            return verifyBirthday('19' + year, month, day, birthday);
        }
        //身份证18位时，次序为省（3位）市（3位）年（4位）月（2位）日（2位）校验位（4位），校验位末尾可能为X
        if (len == '18') {
            var re_eighteen = /^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;
            var arr_data = card.match(re_eighteen);
            var year = arr_data[2];
            var month = arr_data[3];
            var day = arr_data[4];
            var birthday = new Date(year + '/' + month + '/' + day);
            return verifyBirthday(year, month, day, birthday);
        }
        return false;
    };

    //校验日期
    verifyBirthday = function (year, month, day, birthday) {
        var now = new Date();
        var now_year = now.getFullYear();
        //年月日是否合理
        if (birthday.getFullYear() == year && (birthday.getMonth() + 1) == month && birthday.getDate() == day) {
            //判断年份的范围（3岁到100岁之间)
            var time = now_year - year;
            if (time >= 3 && time <= 100) {
                return true;
            }
            return false;
        }
        return false;
    };

    //校验位的检测
    checkParity = function (card) {
        //15位转18位
        card = changeFivteenToEighteen(card);
        var len = card.length;
        if (len == '18') {
            var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
            var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
            var cardTemp = 0,
                i, valnum;
            for (i = 0; i < 17; i++) {
                cardTemp += card.substr(i, 1) * arrInt[i];
            }
            valnum = arrCh[cardTemp % 11];
            if (valnum == card.substr(17, 1)) {
                return true;
            }
            return false;
        }
        return false;
    };

    //15位转18位身份证号
    changeFivteenToEighteen = function (card) {
        if (card.length == '15') {
            var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
            var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
            var cardTemp = 0,
                i;
            card = card.substr(0, 6) + '19' + card.substr(6, card.length - 6);
            for (i = 0; i < 17; i++) {
                cardTemp += card.substr(i, 1) * arrInt[i];
            }
            card += arrCh[cardTemp % 11];
            return card;
        }
        return card;
    };
</script>
<script>
    bindQueryDistrictEvent("/index.php/Home/Teach/", 'pro_select', 'city_select', 'coun_select', 'sch_select');

    function showModal(msg) {
        $('#errormsg').text(msg);
        $('.exist').css('display', 'block');
        document.getElementById("bg").style.display = 'block';
        $('#mycontent').css('margin-right', '-2000px');
    }

    function closeModal() {
        $('.exist').css('display', 'none');
        document.getElementById("bg").style.display = 'none';
        $('#mycontent').css('margin-right', '0');
    }
    $(function () {
        var options = {
            // target:        '#output',   // target element(s) to be updated with server response
            //beforeSubmit:  showRequest,  // pre-submit callback
            success: showResponse, // post-submit callback
            resetForm: false,
            dataType: 'json'

            // other available options:
            //url:       url         // override for form's 'action' attribute
            //type:      type        // 'get' or 'post', override for form's 'method' attribute
            //dataType:  null        // 'xml', 'script', or 'json' (expected server response type)
            //clearForm: true        // clear all form fields after successful submit
            //resetForm: true        // reset the form after successful submit

            // $.ajax options can be used here too, for example:
            //timeout:   3000
        };

        // bind to the form's submit event
        $('#mainForm').submit(function () {
            // inside event callbacks 'this' is the DOM element so we first
            // wrap it in a jQuery object and then invoke ajaxSubmit
            $(this).ajaxSubmit(options);

            // !!! Important !!!
            // always return false to prevent standard browser submit and page navigation
            return false;
        });
    });

    function uploadAvatar(id) {
        $(".avatar-save").click();
    }

    function showResponse(responseText, statusText) {
        switch (responseText.code) {
        case 1: //edit success
//            showModal(responseText.msg);
            uploadAvatar(responseText.id);
            break;
        case -1: //add failed
            showModal(responseText.msg);
            break;
        case 0: // add success
//            showModal(responseText.msg);
            document.getElementById("mainForm").reset();
            uploadAvatar(responseText.id);
            break;
        default:
            showModal(responseText.msg);
            break;
        }
        $('#saveButton').attr('disabled', false);
    }
</script>

<script>
    var isexistedUserName = '{$isexisted_username}'
    var isexistedIdCard = '{$isexisted_idcard}'
    $(function () {
        if (isexistedUserName == 'true') {
            $('#prompt').html('该账号名已经存在，请重新填写一个');
            window.setTimeout(function () {
                $('#password').val('0').val('');
            }, 800);
        }

        //        if (isexistedIdCard == 'true') {
        //            $('#prompt2').html('该身份证号已经存在，请重新填写一个');
        //        }

        if (isexistedUserName != 'true' && isexistedIdCard != 'true') {
            window.setTimeout(function () {

                $('#password').val('0');
            }, 800);
        }
        window.setTimeout(function () {
            $('#password').val('');
        }, 1000);

    });

    function check() {

        var telephone = $('#telephone').val();
        var regTel = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!regTel.test(telephone)) {
            alert('手机号格式不正确');
            return false;
        }
		
		if (!checkCard()) {
            return false;
        }
		
        var email = $('#email').val();
        if (email != '') {
            var emailReg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            if (!emailReg.test(email)) {
                alert('请输入有效的Email地址');
                return false;
            }
        }
    }
</script>
<script src="__PUBLIC__/js/external/xiuxiu.js" type="text/javascript"></script>



<!-----------------------更改头像------------------------>
<script type="text/javascript">

    var oss_path_img = $('.oss_path_img').val();
    if(getQueryString('id') != null)
        setTimeout("initAvatar()",200);
    function initAvatar()
    {
        if (typeof (cropAvatar) == "undefined")
            setTimeout("initAvatar()",200);
        else
        {
            if (typeof(oss_path_img) != 'undefined') {
                cropAvatar.initAvatar(oss_path_img+'?v=' + Date.parse(new Date()));
            } else {
                cropAvatar.initAvatar( '__ROOT__/Uploads/StudentAvatars/{$data.avatar}?v=' + Date.parse(new Date()));
            }
        }
    }
    if ( typeof(oss_path_img) != 'undefined' ) {

        var orginUrl = window.location.protocol + '//' + window.location.host;
        window.onload = function () {
            xiuxiu.embedSWF("altContent", 5, "800px", "400px");
            xiuxiu.setUploadDataFieldName("file");
            /*第1个参数是加载编辑器div容器，第2个参数是编辑器类型，第3个参数是div容器宽，第4个参数是div容器高*/
            xiuxiu.setUploadURL(orginUrl + "/index.php/Home/Student/ossUploadAvatar?id={$data.id}"); //修改为您自己的上传接收图片程序
            xiuxiu.setUploadType('2'); //上传类型：1 流上传 2 表单上传
            //xiuxiu.setUploadDataFieldName("face_pic");//图片上传元素名称（只针对与表单上传类型）
            xiuxiu.onInit = function () {
                //console.log(oss_path_img + "?v=" + Date.parse(new Date()));
                xiuxiu.loadPhoto(oss_path_img + "?v=" + Date.parse(new Date()));
            };
            xiuxiu.onUploadResponse = function (data) {
                var obj = JSON.parse(data);
                updateNavTitleImg(obj.src);
            }
        }
    } else {
        var orginUrl = window.location.protocol + '//' + window.location.host;
        window.onload = function () {
            xiuxiu.embedSWF("altContent", 5, "800px", "400px");
            xiuxiu.setUploadDataFieldName("file");
            /*第1个参数是加载编辑器div容器，第2个参数是编辑器类型，第3个参数是div容器宽，第4个参数是div容器高*/
            xiuxiu.setUploadURL(orginUrl + "/index.php/Home/Student/ossUploadData?id={$data.id}"); //修改为您自己的上传接收图片程序
            xiuxiu.setUploadType('2'); //上传类型：1 流上传 2 表单上传
            //xiuxiu.setUploadDataFieldName("face_pic");//图片上传元素名称（只针对与表单上传类型）
            xiuxiu.onInit = function () {
                xiuxiu.loadPhoto(orginUrl + "/Uploads/StudentAvatars/{$student.avatar}?v=" + Date.parse(new Date()));
            };
            xiuxiu.onUploadResponse = function (data) {
                var obj = JSON.parse(data);

                updateNavTitleImgtwo(obj.src);
            }
        }
    }

</script>

<script type="text/javascript">
    //<img id="childAvatar" width="90" src="__ROOT__/Uploads/StudentAvatars/{$student.avatar}">
    

    var oss_path_img = $('.oss_path_img').val();

    if (typeof(oss_path_img) != 'undefined') {
        $('#childAvatar').attr('src', oss_path_img+'?v=' + Date.parse(new Date()));
    } else {
        $('#childAvatar').attr('src', '__ROOT__/Uploads/StudentAvatars/{$student.avatar}?v=' + Date.parse(new Date()));
    }

    function updateNavTitleImg( oss_path_data ) {
       // $('#childAvatar').attr('src', '__ROOT__/Uploads/StudentAvatars/{$student.avatar}?v=' + Date.parse(new Date()));
        //setTimeout('alert("头像更改成功");location.href = location.href;',1000);//延时3秒
        var oss_path_img = $('.oss_path_img').val();
        if (typeof(oss_path_img) != 'undefined') {
            $('#childAvatar').attr('src', oss_path_data+'?v=' + Date.parse(new Date()));
        } else {
            $('#childAvatar').attr('src', oss_path_data+'?v=' + Date.parse(new Date()));
            //$('.navListImg').attr('src', '__ROOT__/Uploads/Avatars/{$data.id}_t.jpg?v=' + Date.parse(new Date()));
        }
    }

    function updateNavTitleImgtwo( oss_path_data ) {
       // $('#childAvatar').attr('src', '__ROOT__/Uploads/StudentAvatars/{$student.avatar}?v=' + Date.parse(new Date()));
        //setTimeout('alert("头像更改成功");location.href = location.href;',1000);//延时3秒
        var oss_path_img = $('.oss_path_img').val();
        if (typeof(oss_path_img) != 'undefined') {
            $('#childAvatar').attr('src', oss_path_data+'?v=' + Date.parse(new Date()));
        } else {
            $('#childAvatar').attr('src', oss_path_data+'?v=' + Date.parse(new Date()));
            //$('.navListImg').attr('src', '__ROOT__/Uploads/Avatars/{$data.id}_t.jpg?v=' + Date.parse(new Date()));
        }

        $('.os_upload_src').val(oss_path_data);
    }
    
</script>


<script>
    String.prototype.format = function (args) {
        var result = this;
        if (arguments.length > 0) {
            if (arguments.length == 1 && typeof (args) == "object") {
                for (var key in args) {
                    if (args[key] != undefined) {
                        var reg = new RegExp("({" + key + "})", "g");
                        result = result.replace(reg, args[key]);
                    }
                }
            } else {
                for (var i = 0; i < arguments.length; i++) {
                    if (arguments[i] != undefined) {
                        var reg = new RegExp("({)" + i + "(})", "g");
                        result = result.replace(reg, arguments[i]);
                    }
                }
            }
        }
        return result;
    }

    function hideChooseSchoolDlg() {
        document.getElementById("bg").style.display = 'none';
        document.getElementById("show").style.display = 'none';

    }


    function showChooseSchoolDlg() {

        document.getElementById("bg").style.display = "block";
        document.getElementById("show").style.display = "block";
        $('#schoolWrapper').height($('#show').height() - 130);
        $('#mycontent').css('margin-right', '-2000px');

    }
    bindQueryDistrictEvent("__URL__", 'pro_select', 'city_select', 'coun_select', 'sch_select');
</script>

<!-------------------选择学校---------------------->
<script>
    $('#queding').on('click', function () {
        $('#bg').css('display', 'none');
        $('#show').css('display', 'none');
        $('#school_input').val($('#sch_select option:selected').text());
        $('#school_id').val($('#sch_select option:selected').attr('data-id'));
        $('#mycontent').css('margin-right', '0');
    })
</script>
<script>
    $('.close_btn').on('click', function () {
        $('#bg').css('display', 'none');
        $('#show').css('display', 'none');
        $('#mycontent').css('margin-right', '0');
    });
</script>

<!--------------日历----------------->
<script>
    $(function () {
        $("#datepicker").datepicker({
            dateFormat: "yy-mm-dd",
            showOn: "both",
            buttonImage: "/Public/img/birthday.png",
            buttonImageOnly: true,
            showButtonPanel: true,
            changeMonth: true,
            maxDate: '0',
            changeYear: true,
            yearRange: "1950:2050"
        });
    });
</script>


<script>
    jQuery(function ($) {
        $.datepicker.regional['zh-CN'] = {
            clearText: '清除',
            clearStatus: '清除已选日期',
            closeText: '关闭',
            closeStatus: '不改变当前选择',
            prevText: '<上月',
            prevStatus: '显示上月',
            prevBigText: '<<',
            prevBigStatus: '显示上一年',
            nextText: '下月>',
            nextStatus: '显示下月',
            nextBigText: '>>',
            nextBigStatus: '显示下一年',
            currentText: '今天',
            currentStatus: '显示本月',
            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            monthNamesShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            monthStatus: '选择月份',
            yearStatus: '选择年份',
            weekHeader: '周',
            weekStatus: '年内周次',
            dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
            dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],
            dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],
            dayStatus: '设置 DD 为一周起始',
            dateStatus: '选择 m月 d日, DD',
            dateFormat: 'yy-mm-dd',
            firstDay: 1,
            initStatus: '请选择日期',
            isRTL: false
        };
        $.datepicker.setDefaults($.datepicker.regional['zh-CN']);
    });
</script>