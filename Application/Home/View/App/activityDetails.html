<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>活动详情</title>
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<script src="http://apps.bdimg.com/libs/jquery/1.10.1/jquery.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/rem.js"></script>
	<style>
		*{margin: 0;padding: 0;}
		html,body{width: 100%;height: 100%;}
		body{
			background: #eee;

		}
		#content{
			width: 90%;margin:2rem  auto;background: #fff;border-radius: 10px;padding-top: 0.5rem;min-height: 100%;padding-bottom: 60px;
		}
		h1{text-align: center;margin: 1rem 0;color: #333;font-size: 2rem;word-break:break-all}
		p{    color: #666;
           line-height: 2rem;
    		font-size: 1.1rem;
   			 margin: 0 1rem;
    		word-break: break-word;}
		.blod {
	    color: #333;font-size: 1.3rem;line-height:2.2rem
        }
		a{text-decoration:underline;color: #333}
		h3{text-align: center;font-size: 1.3rem;line-height: 2.2rem}
		.active_ct {
	    width: 90%;margin: 0 5%;word-wrap: break-word;text-indent: 0;line-height: 2rem;font-size: 1.1rem;text-align:justify ;
		}
		.btnBottom {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			background: #fff;
			height: 50px;
			border-top: 1px solid #eee;
		}

		.signBtn {
			display: inline-block;
			text-decoration: none;
			color: #999;
			border: 1px solid #999;
			padding: 4px 16px 4px 20px;
			margin-top: 6px;
			line-height: 25px;
			border-radius: 20px;
		}
			.left {
			float: left;
		}

		.right {
			float: right;
		}
		.zanBtnBlack, .favorBtnBlack, .zanBtnRed, .favorBtnRed {
			width: 30%;
			height: 50px;
			border: none;
			padding: 0;
			color: #999;
			outline: none;
			text-align: left;
			text-indent: 25px;
			font-size: 14px
		}

			.zanBtnBlack {
			background: #fff url({$oss_path}public/web_img/App/zanBtnBlack.png) no-repeat left center;
			background-size: 20px 17px;
		}

		.favorBtnBlack {
			background: #fff url({$oss_path}public/web_img/App/favorBtnBlack.png) no-repeat left center;
			background-size: 17px 17px;
		}

		.zanBtnRed {
			background: #fff url({$oss_path}public/web_img/App/zanBtnRed.png) no-repeat left center;
			background-size: 20px 17px;
		}

		.favorBtnRed {
			background: #fff url({$oss_path}public/web_img/App/favirBtnRed.png) no-repeat left center;
			background-size: 17px 17px;
		}
		.share{
			width: 40%;
			height: 50px;
			background: url(__PUBLIC__/img/app/activefenxiang.png) no-repeat;
			background-size: 17px 17px;
			background-position: 5px 16px;
			text-indent: 8px;
		    color: #999;
			font-size: 1.2rem;
		}
		 .btn {
            position: relative;
            display: inline-block;
            padding: 4px 12px 4px 16px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            background-color: #6bcbca;
            white-space: nowrap;
            vertical-align: middle;
            -ms-touch-action: manipulation;
            touch-action: manipulation;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            border: 1px solid #ecf0f1;
            border-radius: 6px;
            color: white;
			word-spacing: 4px;
			letter-spacing: 4px;
        }

        textarea {
            width: 90%;
			max-width: 90%;
			margin: 0 5%;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            border: 1px solid #999;
            border-radius: 6px;
            display: inline-block;
        }
		
		p img {
			max-width: 100%;
			height: auto !important; 
		}
	</style>

</head>
<body>
	<div id="content">
		<h1>{$data.title}</h1>
                <p >
                <volist name="activity_course_info" id="course_item">
                    <if condition="$course_item['course'] eq 0">
                        全学科/
                    <else />
                        {$course_item.course_name}/
                    </if>
                    
                    <if condition="$course_item['grade'] eq 0">
                        全年级
                    <else />
                        {$course_item.grade_name}
                    </if>
                </volist>
                </p>
                <p >{$data.publisher}/{$data.approve_at|date="Y-m-d H:i",###}</p>
		<p>活动时间:<span>
                        <if condition="$data['activitystart'] neq 0">
                            {$data.activitystart|date="Y-m-d H:i",###}
                        </if>
                        至
                        <if condition="$data['activityend'] neq 0">
                            {$data.activityend|date="Y-m-d H:i",###}
                        </if>
                        </span>
                </p>
		<p>报名时间:<span>
                        <if condition="$data['applystart'] neq 0">
                            {$data.applystart|date="Y-m-d H:i",###}
                        </if>
                        至
                        <if condition="$data['applyend'] neq 0">
                            {$data.applyend|date="Y-m-d H:i",###}
                        </if>
                    </span>
                </p>
		<p>限制人数:<span>
                        <if condition="$data['apply_people_number'] eq 0">
                            无
                        <else />
                            {$data.apply_people_number}
                        </if>
                    </span></p>
		<p>备&nbsp;&nbsp;注:<span>{$data.remark}</span></p>
		<p>已报名:<span>{$data.register_numbers}人</p>
		<p>面向人群:<span>{$data.stakeholder}</span></p>
                <notempty name="activity_contact_file">
                    <p class="blod">活动资料：</p>
                    <volist name="activity_contact_file"  id="activity_contact_file_item">
                        <p class="blod"><a class='browse_resource' attr_type="{$activity_contact_file_item.type}" attr_path="{$oss_path}<?php
                                        if($activity_contact_file_item['type']=='word' || $activity_contact_file_item['type']=='ppt'){
                                            $path=explode('.',basename($activity_contact_file_item['activity_file_path']));
                                            $path=$path[0].'.pdf';
                                            $path = 'Activity/' .$data['id'].'/'.$path;
                                            echo $path;
                                        }else{
                                            echo $activity_contact_file_item['activity_file_path'];
                                        }
                                        ?>">{$activity_contact_file_item.activity_file_name}</a></p>
                    </volist>

                    <div class="contentBox" style="display:none;">
                        <switch name="activity_contact_file[0].type">
                            <case value="pdf|word|ppt">
                                <iframe id="resourceFrame" frameborder="0" src="__PUBLIC__/pdfjs/viewer/viewer.html?f={$oss_path}<?php
                                    if($activity_contact_file[0]['type'] == 'word' ||   $activity_contact_file[0]['type'] == 'ppt')
                                    {
                                    $path = explode('.',basename($activity_contact_file[0]['activity_file_path']));
                                    $path=$path[0].'.pdf';
                                    $path = 'teacher/' .$data['id'].'/'.$activity_contact_file[0]['id'] .'/' .$path;
                                    echo $path;
                                    }
                                    else
                                    echo $activity_contact_file[0]['activity_file_path'];
                                    ?>" width="100%" height="500">
                                </iframe>
                            </case>
                            <case value="image">
                                <div class="browse_image">
                                    <img src="{$oss_path}{$activity_contact_file[0].activity_file_path}" />
                                </div>
                            </case>
                            <case value="video">
                                <div id='plv'>
                                    <video src="{$activity_contact_file[0].vid_fullpath}" controls/>
                                </div>
                            </case>
                            <case value="audio">
                                <div id='plv'>
                                    <video src="{$activity_contact_file[0].vid_fullpath}" controls/>
                                </div>
                            </case>
                            <default/>
                            <div>
                            </div>
                        </switch>
                    </div>
                </notempty>

		<h3>活动详情</h4>
		<p class="blod active_ct" >
                    {$data.content}
                </p>
                <notempty name='registered'>
                <if condition="$role eq 2">
                    <?php if($data['class_parent_id']==0){?>
                        <if condition="$registered eq 'no'">
                            <div style="margin-top: 20px;" class="formSubmit">
                                <form id="info-list" action="/Home/App/registerActivity" method="post">   
                                    <input type='hidden' name='unique' value='unique'/>
                                    <input class="teacherId" type="hidden" value="{$user_id}" name="teacher_id">
                                    <input type="hidden" value="{$data.id}" name="id">

                                    <textarea id="register_info" name="register_info" rows="5" placeholder="请输入您的姓名、电话、邮箱"></textarea>

                                    <div style="text-align: center;margin-top: 12px;">
                                        <button type="submit" tapmode class="btn submitBtn">提交</button>
                                    </div>
                                </form>
                            </div>
                        <else/>
                            <div style="margin-top: 20px;" class="formSubmit">
                                <textarea name="register_info" rows="5" disabled>{$register_info}</textarea>
                                <div style="text-align: center;margin-top: 12px;">
                                    <button tapmode class="btn" style="background-color: #C6C6C6; outline: none;">已提交</button>
                                </div>
                            </div>
                        </if> 
                    <?php };?>
                </if>
            </notempty>
	</div>
    </notempty>
    
    
	<div {$role!=5? 'class="btnBottom"': ''}>
            <notempty name='registered'>
                
                <?php if($role==2){?>
                    <if condition="$data['class_parent_id'] eq 0">
                        <div class="left" style="width: 40%; text-align: center; line-height: 50px;">
                            <if condition="$registered eq 'no'"> 
                                <?php if($activity_status=='2'){;?>
                                    <a attr="/U('ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">活动报名未开始</a>
                                <?php }elseif($activity_status=='3'){;?>
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">活动报名已结束</a>
                                <?php }elseif($register_people_number_status=='2'){;?>
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">报名人数已满</a>
v                                <?php }else{;?> 
                                    <a href="##" class="signBtn baoming">我要报名</a>
                                <?php };?>
                           <else/>
                                <a href="##" class="signBtn" style="font-size:0.5rem;line-height:14px">已 报 名</a>
                           </if>
                        </div>
                    <else />
                      <div class="left" style="width: 40%; text-align: center; line-height: 50px;"> 
                            <?php if($registered=='no'){?>
                                <if condition="$activity_status eq '2'">
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">活动报名未开始</a>
                                <elseif condition="$activity_status eq '3'" />
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">活动报名已结束</a>
                                <elseif condition="$register_people_number_status eq '2'" />
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}" style="background:Silver;" class="cancel signBtn baoming new_activity">报名人数已满</a>
                                <else />
                                    <a attr="/ApiInterface/Version1_1/Activity/signupInformation?activity_id={$data.id}&user_id={$user_id}"  class="signBtn baoming new_activity">我要报名</a>
                                </if>
                            <?php } ;?>
                            <if condition="$registered eq 'yes'">
                                   <a href="/ApiInterface/Version1_1/Activity/registrationinformation?id={$data.id}&user_id={$user_id}" class="signBtn" style="font-size:0.5rem;line-height:14px">已 报 名<br>查看报名信息</a>
                            </if>
                        </div>
                    </if>
                <?php }?>
            <notempty name='registered'>
 
                <div class="right" style="width: 60%; text-align: center; line-height: 50px;">
                    <notempty name='existedZan'>
                        <if condition="$role neq 5">
                             <if condition="$existedZan eq 'yes'">
                                     <span id="zanIcon" class="left zanBtnRed">{$data.zan_count}</span>
                                     <else/>
                                     <span id="zanIcon" class="left zanBtnBlack">{$data.zan_count}</span>
                             </if>
                        </if>
                    </notempty>
                    <notempty name='existedFavor'>
                        <if condition="$role neq 5">
                             <if condition="$existedFavor eq 'yes'">
                                     <span id="favorIcon" class="left favorBtnRed">{$data.favor_count}</span>
                                     <else/>
                                     <span id="favorIcon" class="left favorBtnBlack">{$data.favor_count}</span>
                             </if> 
                            <span id="share" class="left share">分享</span>
                        </if>
                    </notempty>
                </div> 
            </notempty>
    </div> 

    
<script>
$('#share').click(function(){
	window.location.href ='https://www.baidu.com'
})
</script>
<script>
        var activity_status="{$activity_status}";
        var register_people_satus="{$register_people_number_status}";
	var obj = {};
	var sp_arr = window.location.search.substr(1).split("&");
	for (var i = 0; i < sp_arr.length; i++) {
		var arr2 = sp_arr[i].split("=");
		obj[arr2[0]] = arr2[1];
	}
	if(obj.role == 2) {
		$('.teacherId').val(obj.user_id);
	}

	$('.submitBtn').click(function () {
            if(activity_status==2){ //活动未开始
                alert('活动未开始');
                return false;
            }else if(activity_status==3){   //活动已结束
                alert('活动已结束');
                return false;
            }else if(register_people_satus==2){ //报名人数已满
                alert('报名人数已满');
                return false;
            }
            
            console.log($('#register_info').val())
            if($('#register_info').val() != ''){
                    window.location.reload();
            }
	})

        
	$('.baoming').click(function() {
            if(activity_status==2){ //活动未开始
                alert('活动未开始');
                return false;
            }else if(activity_status==3){   //活动已结束
                alert('活动已结束');
                return false;
            }else if(register_people_satus==2){ //报名人数已满
                alert('报名人数已满');
                return false;
            }else{
                if($(this).hasClass('new_activity')){
                    var path=$(this).attr('attr');
                    location.href=path;
                }else{a
                    $('#register_info').focus()
                }
            }
	})
</script>
<!--不同角色不同功能-->
<script>
    var user_id="{$user_id}";
    var role="{$role}";
    var id="{$data.id}";
    var zan_count="{$data.zan_count}";
    var favor_count="{$data.favor_count}";

    $('#zanIcon').click(function(){
        if(user_id==false || role==false || id==false){
            return false;
        }else{
            $.getJSON("/ApiInterface/Version1_1/activity/operationActivityZan",{id:id,role:role,user_id:user_id},function(msg){
                 if(msg.status==200){
                     if($('#zanIcon').hasClass('zanBtnRed')){
                         zan_count--;
                         $('#zanIcon').text(zan_count);
                         $('#zanIcon').removeClass('zanBtnRed').addClass('zanBtnBlack');
                     }else{
                         zan_count++;
                         $('#zanIcon').text(zan_count);
                         $('#zanIcon').removeClass('zanBtnBlack').addClass('zanBtnRed');
                     }
                 }else{
                     alert('操作失败');
                 }
            });
        }
    });

    $("#favorIcon").click(function(){
        if(user_id==false || role==false || id==false){
            return false;
        }else{
            $.getJSON("/ApiInterface/Version1_1/activity/operationActivityFavor",{id:id,role:role,user_id:user_id},function(msg){
                if(msg.status==200){
                    if($('#favorIcon').hasClass('favorBtnRed')){
                        favor_count--;
                        $('#favorIcon').text(favor_count);
                        $('#favorIcon').removeClass('favorBtnRed').addClass('favorBtnBlack');
                    }else{
                        favor_count++;
                        $('#favorIcon').text(favor_count);
                        $('#favorIcon').removeClass('favorBtnBlack').addClass('favorBtnRed');
                    }
                }else{
                    alert('操作失败');
                }
            });
        }
    });
</script>
<script>
		$('.browse_resource').click(function(){
			var u = navigator.userAgent;
			var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
			var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
			console.log('是否是Android：'+isAndroid);
			console.log('是否是iOS：'+isiOS);
			//ios系统 除了image,别的都新页面打开
                        var type = $(this).attr('attr_type');
			if(isiOS == true){
				switch(type) {
					case 'image':
					case 'video':
					case 'audio':
					case 'ppt':
					case 'word': //ppt ios是否支持
					case 'pdf':
                                            var attr_path = $(this).attr('attr_path');
                                            location.href=attr_path;

                                        break;
					case 'swf':
					case 'condensed':
                                            var swfBox = '<span>暂时不支持该格式</span>';
                                            $('.contentBox').append(swfBox);
                                        break;

				}
			} else if(isAndroid == true) {
				$(".contentBox").css('display','block');
                                $('.contentBox').empty();
				switch(type) {
					case 'video':
					case 'audio':
						var video_src = $(this).attr('attr_path');
						var videoBox = '<video src="'+video_src+'" controls/>';
                                                var video_element="<div id='plv'></div>";
                                                $(".contentBox").append(video_element);
                                                $("#plv").append(videoBox)

                                                break;
					case 'image':
						var file_path = $(this).attr('attr_path');
                                                var imaggBox='<img src='+file_path+' />';
                                                var image_element='<div class="browse_image"></div>';
                                                $(".contentBox").append(image_element);
                                                $(".browse_image").append(imaggBox);

						break;
					case 'ppt':
					case 'word':
					case 'pdf':
						var file_path = $(this).attr('attr_path');
                                                var iframe_element='<iframe id="resourceFrame" frameborder="0" src="" width="100%" height="500" </iframe>';
                                                $(".contentBox").append(iframe_element);

                                                $("#resourceFrame").attr('src', "__PUBLIC__/pdfjs/viewer/viewer.html?f=" + file_path);
						break;
					case 'swf':
                                        case 'condensed':
						var swfBox = '<span>暂时不支持该格式</span>';
						$('.contentBox').append(swfBox);
						break;
				}
			}

		})
	</script>
</body>
</html>