<!DOCTYPE html>
<html class='no-js'>

<head>
	<meta charset='utf-8'>
	<meta name="renderer" content="webkit">
	<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
	<title>学生注册 :: 京版云教育平台</title>
	<meta content='' name='description'>
	<meta content='' name='keywords'>
	<link href="__PUBLIC_THEME__/stylesheets/application-a07755f5.css" rel="stylesheet" type="text/css" />
	<link href="__PUBLIC_THEME__/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="__PUBLIC__/css/layout.css?v=7" rel="stylesheet" type="text/css" />
	<!--    <link href="__PUBLIC_THEME__/font-awesome/css/laydate.css" rel="stylesheet" type="text/css" />-->
	<link rel="stylesheet" href="__PUBLIC__/css/external/jquery-ui-1.10.4.min.css">
	<link href="__PUBLIC__/css/register.css" rel="stylesheet" type="text/css" />
	<script src="__PUBLIC__/js/external/jquery.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/common.js?v=4.0" type="text/javascript"></script>
	<script src="__PUBLIC__/js/external/jquery.validate.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/jquery.validate.msg.js" type="text/javascript"></script>
</head>

<body>
	<div class="regMain">
		<img src="__PUBLIC__/img/register/regLeft.png" alt="" class="left regLeft">
		<div class="right regRight">
			<form id="info-list" action="__URL__/register" method="post">
				<table class="form_table" style="width: 100%">
					<tr>
						<td width="130"></td>
						<td width="300" align="left" style="font-size: 22px;">
							<div class="p10">学生注册<span style="color:red; font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;为必填选项</span></div>
						</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td class="f_title">真实姓名</td>
						<td class="f_input">
							<input type="text" name="name" id="student_name" placeholder="请输入姓名" maxlength="11" autocomplete="off" onblur="return sname()" required>
							<span class="red">*</span></td>
						<td>
							<div class="warning" id="register_error_name">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">请输入您的姓名</span>
							</div>
						</td>
					</tr>
					<tr>
						<td class="f_title">所在学校</td>
						<td class="f_input">
							<a id="school_input" style="cursor:pointer;" onclick="return showChooseSchoolDlg()">选择学校</a>
							<span class="red">*</span>

							<div id="choosed_school_name" style="box-sizing:content-box; margin: 8px 0;"></div>
							<input type="hidden" name="school_id" id="school_id" data-validate-func="required" data-validate-hint="学校不能为空">
						</td>
						<td>
							<div class="warning" id="register_error_school">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">请选择学校</span>
							</div>
						</td>
					</tr>
					<tr>
						<td class="f_title">家长手机号</td>
						<td class="f_input">
							<input type="text" name="telephone" id="telephone" onblur="return tel()" placeholder="请输入家长手机号" maxlength="11" autocomplete="off" required>

							<span class="red">*</span></td>
						<td>
							<div class="warning" id="register_error_phone">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">手机号码输入错误</span>
							</div>
						</td>
					</tr>
					<tr>
						<td class="f_title">手机验证码</td>
						<td class="f_input">
							<input style="width: 162px;" type="text" name="valid_code" id="valid_code" placeholder="验证码" maxlength="6" onblur="return code();" required>
							<span class="red">*</span>
							<a href="javascript:void(0);return false;" onclick="sendPhoneCode();" id="sendcodebutton">发送验证码</a>
						</td>
						<td>
							<div class="warning" id="register_error_code">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">请输入验证码</span>
							</div>
						</td>
					</tr>

					<tr>
						<td class="f_title">登录密码</td>
						<td class="f_input">
							<input onfocus="this.type='password'" type="text" name="password" id="password" onblur="return pas1()" placeholder="请输入6-16位密码" maxlength="16" required autocomplete="off" min="6">
							<span class="red">*</span></td>
						<td>
							<div class="warning" id="register_error_pwd1">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">密码长度不少于6位</span>
							</div>
						</td>
					</tr>
					<tr>
						<td class="f_title">密码确认</td>
						<td class="f_input">
							<input onfocus="this.type='password'" type="text" name="confirm_password" id="confirm_password" placeholder="请输入6-16位密码" maxlength="16" required autocomplete="off" onblur="return pas2()" min="6">
							<span class="red">*</span></td>
						<td>
							<div class="warning" id="register_error_pwd2">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">两次密码输入不一致</span>
							</div>
						</td>
					</tr>
					<tr>
						<td></td>
						<td>
							<input type="checkbox" id="yes" onclick="ckbox_clone()" checked="checked">我已阅读并同意<a target="_blank" href="{:U('Index/ServiceAgreement')}">《京版云服务协议》</a>
						</td>
						<td>
							<div class="warning" id="register_error_yes">
								<img style="width:15%" src="/Public/img/home/warning.png">
								<span style="color:red; font-size:12px;">请勾选京版云服务协议</span>
							</div>
						</td>
					</tr>
					<tr>
						<td></td>
						<td class="text-center">
							<button class="btn" type="submit" onclick="return check();" id="loginbtn"></button>
						</td>
						</td>
						<td></td>
					</tr>
				</table>
			</form>
		</div>
	</div>

	<div id="bg"></div>
	<div id="bg2"></div>
	<!--【弹窗】选择学校-->
   <div class="regNotify" id="show">
   		<div class="regTop">
   			<img src="__PUBLIC__/img/register/notify1.png" alt="" class="regTopImg">
   			<span class="regTopTitle">选择学校</span>
   			<span class="schoolSpan"></span>
   			<img src="__PUBLIC__/img/register/regTopClose.png" alt="" class="right regTopClose close_img">
   		</div>
   		<div class="regMiddle">
   			<div id="province" class="school_select">
                省份：
                <select name="" id="pro_select" class="notifySelect" onchange="pro()">
                    <option value="">请选择省市区</option>
                </select>
            </div>
            <div id="city" class="school_select">
                市区：
                <select name="" id="city_select" class="notifySelect" onchange="city()">
                    <option value="">请选择市区</option>
                </select>
            </div>
            <div id="country" class="school_select">
                区县：
                <select name="" id="coun_select" class="notifySelect" onchange="coun()">
                    <option value="">请选择区县</option>
                </select>
            </div>
            <div id="school" class="school_select">
                学校：
                <select name="" id="sch_select" class="notifySelect" onchange="sch()">
                    <option value="">请选择学校</option>
                </select>
            </div>
   		</div>
   		<div class="regBottom">
   			 <a id="queding" class="regSureBtn" href="javascript:;">确定</a>
   		</div>
   </div>
   
    <!--【弹窗】加入学校错误-->
   <div class="regNotify" id="addSchoolError">
   		<div class="regTop">
   			<img src="__PUBLIC__/img/register/notify2.png" alt="" class="regTopImg">
   			<span class="regTopTitle">信息审核提醒</span>
   			<img src="__PUBLIC__/img/register/regTopClose.png" alt="" class="right regTopClose close_img">
   		</div>
   		<div class="regMiddle">
           <div class="middleCon">
           		老师您好！
           		<div>您所选择的学校已经开通了认证，学校管理员将会审核您的身份信息。</div>
<!--           		<div>您可以选择<a href="javascript:;" class="school_qita" onclick = "other_school()">其他</a>学校进行体验。</div>-->
           </div>
   		</div>
   		<div class="regBottom">
   			 <a id="addSchoolSure" class="regSureBtn" href="javascript:;">确定</a>
   		</div>
   </div>
   
    <!--【弹窗】服务器繁忙-->
   <div class="regNotify" id="serverBusy">
   		<div class="regTop">
   			<img src="__PUBLIC__/img/register/notify2.png" alt="" class="regTopImg">
   			<span class="regTopTitle">提示！</span>
   			<img src="__PUBLIC__/img/register/regTopClose.png" alt="" class="right regTopClose close_img">
   		</div>
   		<div class="regMiddle">
           <div class="serverCon">
           		<img src="__PUBLIC__/img/register/serverBusy.png" alt="" class="serverImg">
           		<h3>服务器繁忙，请稍候再试！</h3>
           </div>
   		</div>
   		<div class="regBottom">
   			 <a id="serverSure" class="regSureBtn" href="javascript:;" onclick="$(this).hide();">确定</a>
   		</div>
   </div>
   
    <!--【弹窗】注册成功-->
   <div class="regNotify" id="regSuccess">
   		<div class="regTop">
   			<img src="__PUBLIC__/img/register/notify3.png" alt="" class="regTopImg" style="height: 32px">
   			<img src="__PUBLIC__/img/register/regTopClose.png" alt="" class="right regTopClose close_img">
   		</div>
   		<div class="regMiddle">
           <div class="regCon">
           		<img src="__PUBLIC__/img/register/regSuccess.png" alt="" class="serverImg">
           		<h3>恭喜您已注册成功！</h3>
           		<div>
           			您登录的手机号码是：<span class="loginPhone">15912345678</span><br>（如果忘记密码或是丢失账号，可以通过此手机找回）<br>系统将在<span class="time">5</span>秒后返回首页页面，如果没有请<a href="{:U('Index/index')}">点击手动跳转</a>。
           		</div>
           </div>
   		</div>
   		<div class="regBottom">
   			 <a id="regSucSure" class="regSureBtn" href="{:U('Index/index')}">登录</a>
   		</div>
   </div>
	
	<script src="__PUBLIC__/js/external/jquery-ui-1.10.1.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/external/modernizr.min.js" type="text/javascript"></script>
	<script src="__PUBLIC_THEME__/javascripts/application-985b892b.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/DistrictQuery.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/bootstrap-notify.js" type="text/javascript"></script>
	<!--    <script src="__PUBLIC__/js/laydate.dev.js" type="text/javascript"></script>-->
	<script src="__PUBLIC__/js/external/jquery-1.10.2.min.js"></script>
	<script src="__PUBLIC__/js/external/jquery-ui-1.10.4.min.js"></script>
	<script>
		function isValidPhone(str) {
			var re = /^1\d{10}$/
			if (re.test(str)) {
				return true;
			} else {
				return false;
			}
		}
		var hasSentPhoneCode = false;
		var isinerval, times;

		function sendPhoneCode() {

			if (hasSentPhoneCode == true) {
				return;
			}
			hasSentPhoneCode = true;
			var telephone = $('#telephone').val();
			if (!isValidPhone(telephone)) {
				//            alert('手机号格式不正确');
				$('#register_error_phone').css('display', 'block');
				return false;
			}

			$.ajax({
				url: "__URL__/sendRegisterPhoneCode", //请求的url地址
				dataType: "json", //返回格式为json
				//async: true, //请求是否异步，默认为异步，这也是ajax重要特性
				data: {
					'telephone': telephone
				}, //参数值
				type: "GET", //请求方式
				beforeSend: function () {
					//请求前的处理
				},
				success: function (req) {
					var res = eval(req);
					if (res.status < 0) {
						$.NotifyBox.NotifyRegisterOne("提示！", res.msg, "确定");
						hasSentPhoneCode = false;
					} else {
						
						$("#sendcodebutton").html('<span id="GetVerify">60</span>秒后重发');
						times = 59;
						isinerval = setInterval(CountDown, 1000);
					}
				},
				complete: function () {
					//请求完成的处理
				},
				error: function () {
					//请求出错处理
				}
			});
		}

		function tel() {
			var regTel = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
			var tel = $("#telephone").val()
			if (regTel.test(tel) == true) {
				$('#register_error_phone').hide();
				return true
			} else if (tel == '') {
				$('#register_error_phone').show();
				return false;
			} else {
				$('#register_error_phone').show();
				return false;
			}
		}
		
		function code() {
            if ($('#valid_code').val() != '') {
                $('#register_error_code').hide();
                return true;
            }
        }

		function sname() {
			var regName = /^(([\u4E00-\u9FA5]{2,7})|([a-zA-Z]{3,10}))$/;
			var name = $('#student_name').val()
			if (regName.test(name) == true) {
				$('#register_error_name').hide();
				return true
			} else if (name == '') {
				$('#register_error_name').show();
				return false;
			} else {
				$('#register_error_name').show();
				return false;
			}
		}

		function pas1() {
			var pas1 = $('#password').val();

			if (pas1 == '') {
				$('#register_error_pwd1').show();
				return false;
			} else if (pas1.length < 6) {
				$('#register_error_pwd1').show();
				return false;
			} else {
				$('#register_error_pwd1').hide();
				return true;
			}
		}

		function pas2() {
			var pas1 = $('#password').val();
			var pas2 = $('#confirm_password').val();
			if (pas2 == '') {
				$('#register_error_pwd2').show();
				return false;
			} else if (pas1 != pas2) {
				$('#register_error_pwd2').show();
				return false;
			} else {
				$('#register_error_pwd2').hide();
				return true;
			}
		}

		function ckbox_clone() {
			$('#register_error_yes').hide();
		}

		function ckbox() {
			var ck = $("#yes").prop("checked");
			if (ck == true) {
				return true
			} else {
				return false
			}
		}


		function check() {
			$('.warning').hide();
			var identity = $('#identity').val();
			if (sname() == false) {
//				$('#register_error_name').show();
				return false
			} else if ($('#school_input').text() == '选择学校' || $('#school_input').text() == '') {
				$('#register_error_school').show();
				return false
			} else if (tel() == false) {
//				$('#register_error_phone').show();
				return false
			} else if ($('#valid_code').val() == '') {
			    $('#register_error_code').show();
                return false
            }  else if (pas1() == false) {
//				$('#register_error_pwd1').show();
				return false
			} else if (pas2() == false) {
//				$('#register_error_pwd2').show();
				return false
			} else if (ckbox() == false) {
//				$('#register_error_yes').show();
				return false
			} else {
				return true
			}

		}
	</script>
	<script>
		bindQueryDistrictEvent('/index.php/Home/Teach/', 'pro_select', 'city_select', 'coun_select', 'sch_select');
		$('#pro_select').val('');
		$('#city_select').val('');
		$('#coun_select').val('');
		$('#sch_select').val('');
		String.prototype.format = function (args) {
			var result = this;
			if (arguments.length > 0) {
				if (arguments.length == 1 && typeof (args) == "object") {
					for (var key in args) {
						if (args[key] != undefined) {
							var reg = new RegExp("({" + key + "})", "g");
							result = result.replace(reg, args[key]);
						}
					}
				} else {
					for (var i = 0; i < arguments.length; i++) {
						if (arguments[i] != undefined) {
							var reg = new RegExp("({)" + i + "(})", "g");
							result = result.replace(reg, arguments[i]);
						}
					}
				}
			}
			return result;
		}

		function hideChooseSchoolDlg() {
			document.getElementById("bg").style.display = 'none';
			document.getElementById("show").style.display = 'none';
		}


		function showChooseSchoolDlg() {

			document.getElementById("bg").style.display = "block";
			document.getElementById("show").style.display = "block";
			$('#schoolWrapper').height($('#show').height() - 130);
		}
		//    function getSchools(obj) {
		//        var name = $('#school_name').val();
		//        if (name == '') return;
		//
		//        $.get('__URL__/getSchoolByName', {name: name}, function (res) {
		//            var schools = res;
		//            var html = [];
		//            var tpl = '<label class="school_item" data-id="{1}" data-name="{0}">[{2}]{0}</label>';
		//            $.each(schools, function (i, n) {
		//                html.push(tpl.format(n.school_name, n.id, n.stage));
		//            });
		//
		//            $('#schoolWrapper').html(html.join(''));
		//            $('.school_item').click(function () {
		//                $('.school_item').removeClass('selected');
		//                $(this).addClass('selected');
		//            }).dblclick(function () {
		//                var school_id = $(this).attr('data-id');
		//                var school_name = $(this).attr('data-name');
		//                $('#school_id').val(school_id);
		//                $('#choosed_school_name').html(school_name);
		//                hideChooseSchoolDlg();
		//            });
		//        });
		//    }
	</script>

	<script>
		function CountDown() {
			if (times < 1) {
				hasSentPhoneCode = false;
				clearInterval(isinerval);
				$('#sendcodebutton').html('重新发送');
				return;
			}
			$('#GetVerify').html(times);
			times--;
		}
	</script>
	<!-------------------选择学校---------------------->
	<script>
		function pro() {
			if($('#pro_select option:selected').text() != '-请选择-') {
				$('#show').find('.regTopTitle').html('学校加入');
				$('.schoolSpan').html($('#pro_select option:selected').text());
			}
		}
		function city() {
			if($('#pro_select option:selected').text() != '-请选择-' && $('#city_select option:selected').text() != '-请选择-') {
				$('.schoolSpan').html($('#pro_select option:selected').text()+'/'+$('#city_select option:selected').text())
			}
		}
		function coun() {
			if($('#pro_select option:selected').text() != '-请选择-' && $('#city_select option:selected').text() != '-请选择-' && $('#coun_select option:selected').text() != '-请选择-') {
				$('.schoolSpan').html($('#pro_select option:selected').text()+'/'+$('#city_select option:selected').text()+'/'+$('#coun_select option:selected').text())
			}
		}
		function sch() {
			if($('#pro_select option:selected').text() != '-请选择-' && $('#city_select option:selected').text() != '-请选择-' && $('#coun_select option:selected').text() != '-请选择-' && $('#sch_select option:selected').text() != '-请选择-') {
				$('.schoolSpan').html($('#pro_select option:selected').text()+'/'+$('#city_select option:selected').text()+'/'+$('#coun_select option:selected').text()+'/'+$('#sch_select option:selected').text())
			}
		}
		
		$('#queding').on('click', function () {
			if (1 == $('#sch_select option:selected').attr('hasadmin')) {
				$('#bg2,#addSchoolError').show();
//				return;
			}
			$('#bg').css('display', 'none');
			$('#show').css('display', 'none');
			if($('#sch_select').val() != '' ) {
				$('#school_input').html($('#sch_select option:selected').text());
				$('#school_id').val($('#sch_select option:selected').attr('data-id'));
			}
		})
		
		$('.close_img').on('click', function () {
            $('#bg2,#bg').css('display', 'none');
            $('.regNotify').css('display', 'none');
        })
		
		$('#addSchoolSure, #serverSure').click(function(){
			$('#bg2,#bg').css('display', 'none');
            $('.regNotify').css('display', 'none');
		})

		function other_school() {
			$('.fullscr').remove()
			$('#school_input').html('其他');
			$('#pro_select').val('36');
			$('#city_select option:selected').text('其他');
			$('#coun_select option:selected').text('其他');
			$('#sch_select  option:selected').text('其他学校').attr('value', '2000');
			$('#sch_select  option:selected').text('其他学校').attr('data-id', '2000');
			$('#sch_select  option:selected').text('其他学校').attr('hasadmin', '0');
		}
	</script>
	
	<script>
		function time() {
			var s = 5;
			var timer = setInterval(function () {
				s--;
				$('.time').html(s);
				if (s <= 0) {
					clearInterval(timer);
					location.href = "{:U('Index/index')}"
				}
			}, 1000);
		}
    </script>
	<script src="__PUBLIC__/js/jquery.form.js"></script>
	<script src="__PUBLIC__/js/notify/notifyRegister.js"></script>
	<script>
		$(function(){
			var options = {
				success:    showResponse,  // post-submit callback
				resetForm:  false,
				dataType:  'json'
			};

			// bind to the form's submit event
			$('#info-list').submit(function() {
				$(this).ajaxSubmit(options);
				$('#loginbtn').attr('disabled',true);
				return false;
			});
		});
		function showResponse(responseText, statusText) {
			$('#loginbtn').attr('disabled',false);
			switch(responseText.status)
			{
				case 200: //success
					$('.loginPhone').text($("#telephone").val());
					$('#bg,#regSuccess').show();
					time();
					break;
				case 500:
					$.NotifyBox.NotifyRegisterOne("提示！", responseText.message, "确定");
					break;
				default: $('#bg2,#serverBusy').show();
					break;
			}
		}

	</script>
</body>

</html>