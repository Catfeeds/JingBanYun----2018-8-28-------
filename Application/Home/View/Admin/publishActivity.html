<layout name="admin_layout"/>
<link href="__PUBLIC__/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
<link href="__PUBLIC__/css/jquery.ui.datepicker.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/js/fine-uploader/fine-uploader-new.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css">
<link href="__PUBLIC__/css/adminActivity.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/umeditor/umeditor.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/umeditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" src="__PUBLIC__/uploadify/jquery.uploadify.min.js"></script>

<style>
	.laydate_body .laydate_bottom, .laydate_body .laydate_top, .laydate_body .laydate_ym .laydate_yms {
		box-sizing: content-box;
	}
	
	.qq-uploader {
		max-height: 540px
	}
</style>

<div style="margin-bottom: 12px;">
    <a href="javascript:window.history.go(-1)" title="返回" class="button {:session('btntheme')}" style="box-sizing:border-box;">&lt; 返回</a>
</div>
<div class="" style="padding-right: 100px;">
    <form action="__URL__/publishActivity" enctype="multipart/form-data" method="post" data-role="validator" data-on-error-input="notifyOnErrorInput" data-show-error-hint="true" >
        <div class="example" >
            <span class="exampl">基本信息</span>
            <div class="form_section">
                <label for="title">活动主题</label>
                <div class="input-control text full-size">
                    <input type="text" name="title" id="title" data-validate-func="required" maxlength="50" placeholder="必填，不超过50字" data-validate-hint="活动主题不能为空">
                </div>
            </div>
            
            <div class="form_section">
                <label for="">是否限制人数</label>&nbsp;&nbsp;
				<input type="radio" name="number" value="1" id="yesNum"/>是
				<input type="radio" name="number" value="2" id="noNum" checked />否
            </div>
            
            <div class="form_section limitBox">
                <label for="limitNums">限制人数</label>
                <div class="input-control text full-size">
                    <input type="text" name="limitNums" id="limitNums"  placeholder="请输入限制人数" >
                </div>
            </div>
            
            <div class="form_section">
                <label for="">备注</label>
                <div class="input-control text full-size">
                    <input type="text" name="remark" id="remark" placeholder="请输入备注">
                </div>
            </div>

           <div class="form_section codeBox">
                <label for="">是否需要生成邀请码</label>&nbsp;&nbsp;
				<input type="radio" name="code" value="2" id="yesCode"/>是
				<input type="radio" name="code" value="1" id="noCode"/>否
           		<button type="button" class="button info codeBtn">生成邀请码</button>
           		<a href="javascript:;" class="codeCheck">查看</a>
            </div>
            
            <div class="form_section">
                <label for="">活动开始时间</label>
                <input type="text" name="activityStart" id="activityStart" data-validate-func="required" class="input_control_short" value="" data-validate-hint="活动开始时间不能为空" placeholder="活动开始时间" readonly>
                <label for="">活动结束时间</label>
                <input type="text" name="activityEnd" id="activityEnd" data-validate-func="required" class="input_control_short" value="" data-validate-hint="活动结束时间不能为空" placeholder="活动结束时间" readonly>
            </div>
            
            <div class="form_section">
                <label for="">报名开始时间</label>
                <input type="text" name="applyStart" id="applyStart" data-validate-func="required" class="input_control_short" value="" data-validate-hint="报名开始时间不能为空" placeholder="报名开始时间" readonly>
                <label for="">报名结束时间</label>
                <input type="text" name="applyEnd" id="applyEnd" data-validate-func="required" class="input_control_short" value="" data-validate-hint="报名结束时间不能为空" placeholder="报名结束时间" readonly>
            </div>
            
            <div class="form_section">
                <label for="title">所属版块</label>
                <div class="input-control text full-size">
                    <select id="class_id" name="class_id" data-validate-func="required" data-validate-hint="所属版块不能为空">
                        <option value="">-请选择-</option>
                        <volist name="classes" id="dataClass" empty="暂时没有信息">
                            <option value="{$dataClass.id}" <if condition="($dataClass.id eq $data.class_id)">selected</if>>{$dataClass.class}
                            </option>
                        </volist>
                    </select>
                </div>
            </div>

            <div class="child_data_display form_section">
                <label for="title">所属类型</label>
                <div class="input-control text full-size">
                    <select id="child_class_name" name="class_type_id" style="margin-right: 50px">
                        <option value="0">-请选择-</option>
                    </select>
                </div>
            </div>

            <div class="form_section">
                <label for="title">活动分类</label>
                <div class="input-control text full-size">
                    <input type="text" name="category" id="category" placeholder="培训、大赛，节假日、特殊日、信息发布（必填，不超过50字）" data-validate-func="required" data-validate-hint="活动分类不能为空">
                </div>
            </div>

            <div class="form_section">
                <label for="stakeholder">活动面向人群</label>

                <div class="input-control text full-size">
                    <input type="text" name="stakeholder" id="stakeholder" data-validate-func="required"
                           data-validate-hint="活动面向人群不能为空" maxlength="100" placeholder="必填，不超过100字">
                </div>
            </div>

            <div class="form_section">
                <label for="title">图像(显示在移动端的图像,格式jpg或png)</label>
                <div class="input-control text full-size">
                    <input type="file" name="filepic" id="file" data-validate-func="required" data-validate-hint="图像不能为空">
                </div>
            </div>
            
            <div class="form_section" id="accessorySupport" style="display:none">
                <label for="title">是否支持上传附件</label>
                <div class="input-control text full-size">
                    <select id="is_upload" name="is_upload" data-validate-func="required" data-validate-hint="请选择是否支持上传">
                        <option value="0">-请选择-</option> 
                        <option value="1">支持</option> 
                        <option value="0">不支持</option> 
                    </select>
                </div>
            </div>
        </div>
        <br>

        <div class="example courseGradeGroup" >
            <span class="exampl">是否选择全年级或者全学科</span>
            <p class="infoP"><input type="checkbox" name="allgradeorcourse[]" value="1" class="infoCheckbox allgrade">全年级</label></p>
            <p class="infoP"><input type="checkbox" name="allgradeorcourse[]" value="2" class="infoCheckbox allcourse">全学科</label></p>
        </div>


        <div class="example courseGradeGroup" >
            <div class="form_section">
                <label for="childrens">已选择</label><br/><br/>
                <div>
                    <div class="select_class_grade" >
                        <div class="select_span">
                            <volist name="grade_class_select" id="grade_class_i" empty="">
                                    <span style="border: 1px solid gray;margin-left:20px;">
                                        <span attr="{$grade_class_i.course_id}" class="select_course">{$grade_class_i.course_name}</span>
                                        <span attr="{$grade_class_i.grade_id}" class="select_grade">{$grade_class_i.grade}</span>
                                        <!--<span attr="{$grade_class_i.class_id}" class="select_class">{$grade_class_i.class_name}</span>-->
                                        <a class="delete_info"> x</a>&nbsp;
                                    </span>
                            </volist>
                        </div>
                        <div class="child_input">
                            <volist name="grade_class_select" id="grade_class_i" empty="">
                                <div class="child_div">
                                    <input type="hidden" name="grade[]" class="hidden_grade" value="{$grade_class_i.grade_id}"/>
                                    <!--<input type="hidden" name="class[]" class="hidden_class" value="{$grade_class_i.class_id}"/> -->
                                    <input type="hidden" name="course[]" class="hidden_course" value="{$grade_class_i.course_id}"/>
                                </div>
                            </volist>
                        </div>
                    </div>
                </div>
            </div>


            <div class="form_section grade_is_show courseGradeGroup">
                <label for="school_id">任教年级</label>

                <div class="input-control text full-size">
                    <select id="grade_id" name="grade_id">
                        <option value="">-请选择-</option>
                        <volist name="grades" id="dataGrade">
                            <option value="{$dataGrade.id}">{$dataGrade.grade}</option>
                        </volist>
                    </select>
                </div>
            </div>

            <!--<div class="form_section">
                <label for="school_id">任教班级</label>

                <div class="input-control text full-size">
                    <select id="class_id" name="class_id" data-validate-func="required" data-validate-hint="任教班级不能为空">
                        <option value="">-请选择-</option>
                        <volist name="class" id="class_item">
                            <option value="{$class_item.id}">{$class_item.name}</option>
                        </volist>
                    </select>
                </div>
            </div>-->

            <div class="form_section course_is_show courseGradeGroup">
                <label for="school_id">任教学科</label>

                <div class="input-control text full-size">
                    <select id="course_id" name="course_id">
                        <option value="">-请选择-</option>
                        <volist name="courses" id="dataCourse">
                            <option value="{$dataCourse.id}">{$dataCourse.course_name}</option>
                        </volist>
                    </select>
                </div>
            </div>
        </div>

        <div class="example" >
            <span class="exampl">活动信息</span>
            <div>
                <script type="text/plain" id="content" name="content" style="width:100%;height:340px;">
                <p>活动信息</p>
                </script>
            </div>
        </div>
        
        <div class="example" >
            <span class="exampl">上传活动资料</span>
			<div id="fine-uploader">

			</div>
		</div>
        <input type="hidden" name="codename" class="codename">
        <div class="form_section">
            <div id="attachmentWrapper" style="display: none;">
            </div>
            <div id="videoWrapper" style="display: none;">
                <!--<input type="file" id="uploadToBLWS" accept=".jpg,.png">-->
                <input type="button" onclick="javascript:$('#uploadToBLWS').uploadify('upload','*')" value="上传视频">
                <input type="hidden" value="" name="vid" id="vid">
                <input type="hidden" value="" name="vid_file_path" id="vid_file_path">
                <input type="hidden" value="" name="playerwidth" id="playerwidth">
                <input type="hidden" value="" name="playerduration" id="playerduration">
                <input type="hidden" value="" name="vid_fullpath" id="vid_fullpath">
                <input type="hidden" value="" name="vid_image_path" id="vid_image_path">
                <input type="hidden" value="" name="is_transition" id="is_transition">
                <!--<input type="hidden" value="" name="mp4Source" id="mp4Source">-->
                <input type='hidden' name='real_type' id='real_type' />
            </div>
        </div>

        <div class="info_show">
            <p>

            </p>
        </div>

        <div class="form-actions" style="text-align: left; ">
            <button type="submit" class="button info" onclick="return check();">发布</button>
        </div>
    </form>
</div>

<!--邀请码弹窗-->
<div class="fullBlack"></div>
<div class="codeOutter">
	<span class="codeClose"></span>
	<div class="codeInner">
		<table id="listWrapper" class="table striped hovered border">
			<thead>
				<tr>
					<th class="text-center">序号</th>
					<th class="text-center">邀请码</th>
					<th class="text-center">是否使用</th>
					<th class="text-center">状态</th>
				</tr>
			</thead>
			<tbody class="codecentent">

			</tbody>
		</table>
	</div>
	
</div>

<script src="__PUBLIC__/laydate/laydate.js"></script>

<script>
    var um = UM.getEditor('content');

</script>
<script>
    function notifyOnErrorInput(input) {
        var message = input.data('validateHint');
        $.Notify({
            caption: '提示',
            content: message,
            type: 'warning'
        });
    }

    $('#class_id').change(function(){
        var pid = $(this).val();
        if(pid!=5) {
            $('#accessorySupport').show();
            $('.courseGradeGroup').show();
        }
        else {
            $('#accessorySupport').hide();
            $('.courseGradeGroup').hide();

        }
        $.get('index.php?m=Home&c=Admin&a=childPid', {"pid": pid}, function (res) {
            var htmltmp = res.info;

            var str = '';
            str += '<option value="0">请选择</option>';
            for (var i=0;i<htmltmp.length;i++) {
                str += '<option value="'+htmltmp[i].id+'">'+htmltmp[i].class+'</option>';
            }
            $("#child_class_name").find("option").remove();
            $('#child_class_name').append(str);


        });
    });
    $('#class_id').change(function () {
        if($(this).val() == 5) //活动评比
        {
            $('#accessorySupport').hide();
        }
        else
        {
            $('#accessorySupport').show();
        }
    })
</script>

<script type="text/javascript">
	!function(){
		laydate.skin('yalan');//切换皮肤，请查看skins下面皮肤库
	}();

	//活动起始时间
	var actstart = {
		elem: '#activityStart',
		format: 'YYYY-MM-DD hh:mm:ss',
		min: laydate.now(), //设定最小日期为当前日期
		max: '2099-06-16', //最大日期
		istime: true,
		istoday: false,
		choose: function(datas){
			 actend.min = datas; //开始日选好后，重置结束日的最小日期
			 actend.start = datas; //将结束日的初始值设定为开始日
//			 appstart.max = datas;
//			 append.max = datas;
		}
	};

	var actend = {
		elem: '#activityEnd',
		format: 'YYYY-MM-DD hh:mm:ss',
		min: laydate.now(),
		max: '2099-06-16',
		istime: true,
		istoday: false,
		choose: function(datas){
			actstart.max = datas; //结束日选好后，充值开始日的最大日期
			 appstart.max = datas;
			 append.max = datas;
		}
	};
	laydate(actstart);
	laydate(actend);
	
	//报名起始时间
	var appstart = {
		elem: '#applyStart',
		format: 'YYYY-MM-DD hh:mm:ss',
		min: laydate.now(), //设定最小日期为当前日期
		max: '2099-06-16', //最大日期
		istime: true,
		istoday: false,
		choose: function(datas){
//			 actstart.min = datas;
//			 actend.min = datas;
			 append.min = datas; //开始日选好后，重置结束日的最小日期
			 append.start = datas //将结束日的初始值设定为开始日
		}
	};

	var append = {
		elem: '#applyEnd',
		format: 'YYYY-MM-DD hh:mm:ss',
		min: laydate.now(),
		max: '2099-06-16',
		istime: true,
		istoday: false,
		choose: function(datas){
			appstart.max = datas; //结束日选好后，重置开始日的最大日期
//			actstart.min = datas;
//			actend.min = datas;
		}
	};
	laydate(appstart);
	laydate(append);

</script>

<script>
	//点击是否限制人数的 ‘是’
	$('#yesNum').click(function(){
		$(this).attr('checked',true);
		$('#noNum,#yesCode,#noCode').prop("checked",false);
		$('.codeCheck').hide();
		if($(this).is(':checked')){
			$('.limitBox,.codeBox').show();
			$('.codeBtn').addClass('codeBtnGray').attr('disabled',false);
			//点击是否生成邀请码的 ‘是’
			$('#yesCode').unbind('click').click(function(){
				$(this).attr('checked',true);
				$('#noCode').prop("checked",false);
				$('.codeBtn').removeClass('codeBtnGray').prop("disabled",false);
				if($(this).is(':checked')){

					$('.codeBtn').unbind('click').click(function(){
						var con;
						con = confirm('确定生成邀请码');
						if(con == true) {
                            var nums = $('#limitNums').val();
                            var g=/^-?\d+$/;
                            var gr = g.test(nums);
                            if(gr == false || gr<0) {
                                alert('请填写正确的限制人数');
                                return false;
                            }
                            $('.codeBtn').addClass('codeBtnGray').prop('disabled',false);
                            $('.codeCheck').show();
                            $.get('/index.php?m=Home&c=InvitationCode&a=getCodeView', {"codenum":nums}, function (res) {
                                var viewstr = '';
                                var codeids = '';

                                for (var i=0; i<res.length;i++) {
                                    var j = 1;
                                    j = j+i;
                                    viewstr+='<tr>';
                                        viewstr+='<td class="text-center">'+j+'</td>';
                                        viewstr+='<td class="text-center">'+res[i]+'</td>';
                                        viewstr+='<td class="text-center">未使用</td>';
                                        viewstr+='<td class="text-center">正常</td>';
                                    viewstr+='</tr>';
                                    if (i==0) {
                                        codeids+=res[i];
                                    } else {
                                        codeids+=','+res[i];
                                    }

                                }
                                $('.codename').val(codeids);
                                $('.codecentent').html(viewstr);

                            })
						} else {

						}
					})
				}
			})
			//点击是否生成邀请码的 ‘否’
			$('#noCode').unbind('click').click(function(){
				$(this).attr('checked',true);
				$('#yesCode').prop("checked",false);
				$('.codeBtn').addClass('codeBtnGray').attr('disabled',true);
				$('.codeCheck').hide();
			})
		}
	})
	//点击是否限制人数的 ‘否’
	$('#noNum').click(function(){
		$(this).attr('checked',true);
		$('#yesNum,#yesCode,#noCode').prop("checked",false);
		$('.codeCheck').hide();
		if($(this).is(':checked')){
			$('.limitBox,.codeBox').hide();
			$('.codeBtn').removeClass('codeBtnGray');
		}
	})


</script>

<script type="text/javascript">
    function timeCheck()
    {
      var activityStart = $('#activityStart').val();
      var activityEnd   = $('#activityEnd').val();
      var applyStart    = $('#applyStart').val();
      var applyEnd      = $('#applyEnd').val();
        if(activityStart == '' || activityEnd == '' ||applyStart == '' ||applyEnd == '')
        {
            $.Notify({
                caption: '提示',
                content: '活动/报名起止时间不能为空',
                type: 'warning'
            });
            return false;
        }
        if(activityStart == activityEnd)
        {
            $.Notify({
                caption: '提示',
                content: '活动起止时间不能相同',
                type: 'warning'
            });
            return false;
        }
        return true;
    }

    function check() {
        if(!timeCheck())
            return false;
        //资源名称
        if(!onFileCheck()){
            return false;
        }
        if('checked' == $('#yesCode').attr('checked'))
        {
            if(0 == $('.codename').val().length)
            {
                alert('请生成邀请码');
                return false;
            }
        }
        //TODO: PROECESS uploadInfo
        $('#vid').val('');
        $('#vid_file_path').val('');
        $('#playerwidth').val('');
        $('#playerduration').val('');
        $('#vid_fullpath').val('');
        $('#vid_image_path').val('');//is_transition
        $('#is_transition').val('');

        for(var key in uploadInfo){
            $('#vid_file_path').val($('#vid_file_path').val() + uploadInfo[key].vid_file_path +',#');
            var width = typeof(uploadInfo[key].playerwidth) != 'undefined' ? uploadInfo[key].playerwidth : '0*0';

            $('#playerwidth').val($('#playerwidth').val() + width +',');
            var duration = typeof(uploadInfo[key].playerduration) != 'undefined' ? uploadInfo[key].playerduration : '00:00:00';

            $('#playerduration').val($('#playerduration').val() + duration +',');
            var vid = typeof(uploadInfo[key].vid) != 'undefined' ? uploadInfo[key].vid : '0';
            $('#vid').val($('#vid').val() + vid +',');

            var vid_fullpath= typeof(uploadInfo[key].vid_fullpath) != 'undefined' ? uploadInfo[key].vid_fullpath : '0';
            $('#vid_fullpath').val($('#vid_fullpath').val()+vid_fullpath+',');

            var vid_image_path= typeof(uploadInfo[key].vid_image_path) != 'undefined' ? uploadInfo[key].vid_image_path : '0';
            $('#vid_image_path').val($('#vid_image_path').val()+vid_image_path+',');

            var vid_transition= typeof(uploadInfo[key].is_transition) != 'undefined' ? uploadInfo[key].is_transition : '0';
            $('#is_transition').val($('#is_transition').val()+vid_transition+',');
        }
        var lengtype = $("#child_class_name option").length;
        if (lengtype > 1) {
            var typeid = $('#child_class_name').val();
            if (typeid=='' || typeid<=0) {
                alert('请选择所属类型');
                return false;
            }
        }
        return true;
    }
    var uploadInfo = {};
</script>

<script src="__PUBLIC__/js/fine-uploader/fine-uploader.js" type="text/javascript"></script>
<script type="text/template" id="qq-template">
    <div class="qq-uploader-selector qq-uploader" qq-drop-area-text="Drop files here">
        <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
            <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
        </div>
        <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
            <span class="qq-upload-drop-area-text-selector"></span>
        </div>
        <div class="qq-upload-button-selector qq-upload-button">
            <div>上传文件</div>
        </div>
        <span class="qq-drop-processing-selector qq-drop-processing">
                <span>Processing dropped files...</span>
                <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
            </span>
        <ul class="qq-upload-list-selector qq-upload-list" aria-live="polite" aria-relevant="additions removals">
            <li>
                <div class="qq-progress-bar-container-selector">
                    <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
                </div>
                <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                <img class="qq-thumbnail-selector" qq-max-size="100" qq-server-scale>
                <span class="qq-upload-file-selector qq-upload-file"></span>
                <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
                <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
                <span class="qq-upload-size-selector qq-upload-size"></span>
                <button type="button" class="qq-btn qq-upload-cancel-selector qq-upload-cancel">Cancel</button>
                <button type="button" class="qq-btn qq-upload-retry-selector qq-upload-retry">Retry</button>

                <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
            </li>
        </ul>

        <dialog class="qq-alert-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">Close</button>
            </div>
        </dialog>

        <dialog class="qq-confirm-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">No</button>
                <button type="button" class="qq-ok-button-selector">Yes</button>
            </div>
        </dialog>

        <dialog class="qq-prompt-dialog-selector">
            <div class="qq-dialog-message-selector"></div>
            <input type="text">
            <div class="qq-dialog-buttons">
                <button type="button" class="qq-cancel-button-selector">Cancel</button>
                <button type="button" class="qq-ok-button-selector">Ok</button>
            </div>
        </dialog>
    </div>
</script>
<script>
    function changeInputFilter(){
        var acceptStr = $('#type').find("option:selected").attr('extval');
        $(':file').attr('accept',acceptStr);
    }
    changeInputFilter();

    function onFileCheck(){
        if($('li').hasClass('qq-upload-fail')){
            alert('有文件上传错误');
            return false;
        }
        return true;
    }
    var uploader = new qq.FineUploader({
        debug: false,
        element: document.getElementById('fine-uploader'),
        request1Enable : true,
        request1: {
            endpointnum :1,
            endpoint: 'http://v.polyv.net/uc/services/rest?method=uploadfile',
            params:{'writetoken':'9c538d85-340c-466c-9e35-bb301734eb0d','JSONRPC':'{"title": "这里是标题", "tag": "标签", "desc": "视频文档描述"}'},
            fileFilter:Array("mov","mp4","mp3"),
            inputName:'Filedata',
        },
        request: {
            endpointnum: 0,
            endpoint: '/index.php?m=Home&c=Admin&a=upload_file_jb',
            params:{},
            inputName:'file[]',
        },
        validation:{
            allowedExtensions: ['jpeg', 'jpg', 'gif', 'png','mp4','mov','mp3','doc','docx','ppt','pptx','pdf','swf'],
        },
        deleteFile: {
            enabled: true,
            endpoint: '/uploads'
        },
        retry: {
            enableAuto: true
        },
        onCancel: function(id){
            delete uploadInfo[id];
        },
        responseCallBack: function(id,specNum,xhr){
            var result;
            try{
                result = JSON.parse(xhr.responseText);
            }
            catch(e){
                alert('上传失败!错误原因'+e);
                return false;
            }
            if(specNum == 0){
                if(result.code == 0){
                    if(typeof(uploadInfo[id])== 'undefined'){
                        uploadInfo[id] = {};
                    }
                    uploadInfo[id]['vid_file_path'] = result.res+':'+result.name;
                    uploadInfo[id]['vid_image_path'] = result.message_video_image;     //这里是视频截图,如果不是视频这里就是空
                    uploadInfo[id]['is_transition'] = result.is_transition;            //这里是视频转换状态。
                    return true;
                }else{
                    alert(result.msg);
                }
            }else if(specNum == 1){
                    if(result.error == 0){
                        //alert("上传成功!VID:"+result.data[0].vid);
                        //TODO: add result.res to XXX
                        if(typeof(uploadInfo[id])== 'undefined')
                        {
                            uploadInfo[id] = {};
                        }
                        uploadInfo[id]['vid'] = result.data[0].vid;
                        uploadInfo[id]['playerwidth'] = result.data[0].playerwidth + '*' +result.data[0].playerheight;
                        uploadInfo[id]['duration'] = result.data[0].duration;
                        uploadInfo[id]['vid_fullpath'] = result.data[0].mp4;
                        return true;
                    }else{
                        alert("上传失败!错误码:"+result.error);
                    }
            }
            return false;
        }
    });

</script>


<!--查看邀请码-->
<script>
	$('.codeCheck').click(function(){
		$('.fullBlack,.codeOutter').show();
		$(document.body).css('overflow-y','hidden');
	})
	
	$('.codeClose').click(function(){
		$('.fullBlack,.codeOutter').hide();
		$(document.body).css('overflow-y','auto');
	})
</script>


<script>


    function showChooseSchoolDlg() {
        document.getElementById("bg").style.display = "block";
        document.getElementById("show").style.display = "block";
        $('#schoolWrapper').height($('#show').height() - 130);

    }

    function checkSelect(){
        var is_grade_show = $('.allgrade').is(':checked');
        var is_course_show = $('.allcourse').is(':checked');
        console.log(is_grade_show);
        console.log(is_course_show);
        if (is_grade_show==true) {
            var grade_val=0;
            var course_val=$("#course_id").val();
            if(course_val){
                return true;
            }else{
                return false;
            }
        } else if (is_course_show==true) {
            var grade_val=$("#grade_id").val();
            var course_val=0;
            if(grade_val){
                return true;
            }else{
                return false;
            }
        } else if (is_course_show==true &&is_grade_show==true ) {
            var grade_val=0;
            var course_val=0;
            return true;
        } else {
            var grade_val=$("#grade_id").val();
            var course_val=$("#course_id").val();
            if(grade_val && course_val){
                return true;
            }else{
                return false;
            }
        }

    }

    var temp_div="<div class='child_div'>"+
            "<input type='hidden' name='grade[]' class='hidden_grade' value=''/>"+
            "<input type='hidden' name='course[]' class='hidden_course' value=''/>"+
            "</div>";
    var temp_span="<span style='border: 1px solid gray;margin-left:20px;'>"+
            "<span attr='' class='select_course'></span>&nbsp;"+
            "<span attr='' class='select_grade'></span>&nbsp;"+
            "<a class='delete_info'>x</a>&nbsp;"+
            "</span>";

    //创建元素并判断该span是否存在
    function createElement(){
        var course_id=$("#course_id").val();
        var course_text=$("#course_id option:selected").text();
        var grade_id=$("#grade_id").val();
        var grade_text=$("#grade_id option:selected").text();

        var is_grade_show = $('.allgrade').is(':checked');
        var appendname='';
        if(is_grade_show) {
            appendname = '全年级';
        }
        var is_course_show = $('.allcourse').is(':checked');
        if(is_course_show) {
            appendname = '全学科';
        }

        if(is_grade_show==true && is_course_show==true) {
            appendname='全年级-全学科';
        }

        //这里拿span进行比对的
        var check_course=$(".select_course[attr="+course_id+"]");
        var check_grade=$(".select_grade[attr="+grade_id+"]");
        if(check_course.length && check_grade.length){
            alert('您已经选择过该信息');
            return false;
        }

        //return false;
        if(is_grade_show==true) {

            var inner_span=$(temp_span).clone(true);
            $(inner_span).find(".select_course").attr("attr",course_id).text(course_text);
            $(inner_span).find(".select_grade").attr("attr",grade_id).text(appendname);

            var inner_div=$(temp_div).clone(true);
            $(inner_div).find('.hidden_grade').val(0);
            $(inner_div).find('.hidden_course').val(course_id);

            $(".select_span").append(inner_span);
            $(".child_input").append(inner_div);
        } else if(is_course_show==true) {

            var inner_span=$(temp_span).clone(true);
            $(inner_span).find(".select_course").attr("attr",course_id).text(appendname);
            $(inner_span).find(".select_grade").attr("attr",grade_id).text(grade_text);

            var inner_div=$(temp_div).clone(true);
            $(inner_div).find('.hidden_grade').val(grade_id);
            $(inner_div).find('.hidden_course').val(0);

            $(".select_span").append(inner_span);
            $(".child_input").append(inner_div);

        }else if(is_grade_show==true && is_course_show==true){
            var inner_span=$(temp_span).clone(true);
            $(inner_span).find(".select_course").attr("attr",course_id).text(course_text);
            $(inner_span).find(".select_grade").attr("attr",grade_id).text(appendname);

            var inner_div=$(temp_div).clone(true);
            $(inner_div).find('.hidden_grade').val(0);
            $(inner_div).find('.hidden_course').val(0);

            $(".select_span").append(inner_span);
            $(".child_input").append(inner_div);
        } else {

            var inner_span=$(temp_span).clone(true);
            $(inner_span).find(".select_course").attr("attr",course_id).text(course_text);
            $(inner_span).find(".select_grade").attr("attr",grade_id).text(grade_text);

            var inner_div=$(temp_div).clone(true);
            $(inner_div).find('.hidden_grade').val(grade_id);
            $(inner_div).find('.hidden_course').val(course_id);

            $(".select_span").append(inner_span);
            $(".child_input").append(inner_div);
        }


    }

    //年级等发生改变的时候,都要判断下拉是否都选中
    $("#course_id,#grade_id").change(function(){
        if(checkSelect()==false){
            return false;
        }
        //判断是否有过去选择过得元素
        createElement();
    });

    //点击已选择的删除
    $(".delete_info").live('click',function(){
        var current_index=$(this).parent().index();
        $(".child_input").find(".child_div").eq(current_index).remove();
        $(this).parent().remove();
    });

    function notifyOnErrorInput(input) {
        var message = input.data('validateHint');
        $.Notify({
            caption: '提示',
            content: message,
            type: 'warning'
        });
    }

    //筛选全年级和全学科
    $(".allgrade").live('click',function(){
        $(".select_span").html('');//先清空数据
        $(".child_input").html('');


        var is_grade_show = $(this).is(':checked');
        var is_course_show = $('.allcourse').is(':checked');

        if (is_grade_show==true && is_course_show==true) {

            $('.grade_is_show').hide();
            $('.course_is_show').hide();
        } else {
            if (is_grade_show==false && is_course_show==false) {
                $('.grade_is_show').show();
                $('.course_is_show').show();
            } else {
                if (is_grade_show==true) {
                    $('.grade_is_show').css('display','none');
                }else {
                    $('.course_is_show').css('display','none');
                    $('.grade_is_show').css('display','block');
                }
            }

        }

    });

    $(".allcourse").live('click',function(){
        $(".select_span").html('');//先清空数据
        $(".child_input").html('');

        var is_course_show = $(this).is(':checked');
        var is_grade_show = $('.allgrade').is(':checked');
        if (is_grade_show==true && is_course_show==true) {
            $('.grade_is_show').hide();
            $('.course_is_show').hide();
        } else {
            if (is_grade_show==false && is_course_show==false) {
                $('.grade_is_show').show();
                $('.course_is_show').show();
            } else {
                if (is_course_show == true) {
                    $('.course_is_show').css('display', 'none');
                } else {
                    $('.grade_is_show').css('display', 'none');
                    $('.course_is_show').css('display', 'block');
                }
            }
        }


    });

</script>